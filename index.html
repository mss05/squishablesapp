<!-- 
    √ñNEMLƒ∞: FOTOƒûRAF KURULUMU
    Bu uygulamanƒ±n tam d√ºzg√ºn g√∂r√ºnmesi i√ßin, index.html dosyasƒ±nƒ±n olduƒüu yere
    "images" adƒ±nda bir klas√∂r a√ßƒ±n ve i√ßine ≈üu isimlerde resimlerinizi koyun:

    1. √úr√ºn G√∂rseli: Product1.jpg (index.html ile aynƒ± yerde olabilir veya images i√ßinde)
    2. Logo: logo.png (images klas√∂r√ºnde)
    3. Avatarlar: avatar1.png, avatar2.png, avatar3.png (images klas√∂r√ºnde)
    4. Rehber √ñrnekleri (√ái√ßek): 
       cicek_adim1.jpg, cicek_adim2.jpg, cicek_adim3.jpg, cicek_adim4.jpg, cicek_adim5.jpg
-->

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Squishables - Aile Baƒülarƒ± Kiti</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#DCD6F7">
    <link rel="apple-touch-icon" href="images/logo.png">

    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- 1. CSS AYARLARI --- */
        :root {
            --theme-color: #C4DFD9;
            --mint: #C4DFD9; --dark-mint: #2e5c4d;
            --peach: #FFD1BA; --dark-peach: #d68c6d;
            --purple: #DCD6F7; --dark-purple: #424874;
            --bg-color: #f4f7f6; --white: #ffffff;
            --gold: #FFD700;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { margin: 0; padding: 0; font-family: 'Nunito', sans-serif; background-color: var(--bg-color); display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }

        /* TELEFON √áER√áEVESƒ∞ */
        #app-frame {
            width: 375px; height: 812px; background-color: var(--white);
            border-radius: 40px; position: relative; overflow: hidden;
            box-shadow: 0 30px 60px rgba(0,0,0,0.3); border: 8px solid #222;
        }
        .notch { position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 150px; height: 30px; background: #222; border-radius: 0 0 20px 20px; z-index: 999; }

        /* --- 2. Bƒ∞LDƒ∞Rƒ∞MLER (TOAST) --- */
        #toast-container { position: absolute; top: 50px; left: 50%; transform: translateX(-50%); z-index: 3000; width: 90%; pointer-events: none; display: flex; flex-direction: column; gap: 10px; }
        .toast {
            background: rgba(50, 50, 50, 0.95); color: white; padding: 12px 20px; border-radius: 30px;
            text-align: center; opacity: 0; transform: translateY(-20px); transition: 0.4s; font-size: 0.9rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center; gap: 10px; backdrop-filter: blur(5px);
        }
        .toast.show { opacity: 1; transform: translateY(0); }
        .toast.success { background: var(--dark-mint); }

        /* --- 3. MODALLER --- */
        .modal-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2500; display: none; align-items: center; justify-content: center; animation: fadeIn 0.3s; backdrop-filter: blur(2px); }
        .modal-box { background: white; width: 85%; padding: 25px; border-radius: 25px; text-align: center; animation: popIn 0.3s; position: relative; box-shadow: 0 20px 40px rgba(0,0,0,0.2); }
        .close-modal { position: absolute; top: 15px; right: 15px; font-size: 1.5rem; cursor: pointer; color: #888; transition: 0.2s; }
        .close-modal:hover { color: #333; }

        /* --- 4. EKRANLAR --- */
        .screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: white; display: none; flex-direction: column; padding-top: 40px; animation: fadeIn 0.3s ease; z-index: 10; }
        .screen.active { display: flex; }
        .scroll-content { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; }
        .scroll-content::-webkit-scrollbar { display: none; }

        /* --- 5. UI Bƒ∞LE≈ûENLERƒ∞ --- */
        h1, h2, h3 { font-family: 'Fredoka', sans-serif; color: #333; margin: 10px 0; }
        p { color: #888; font-size: 0.9rem; line-height: 1.5; margin-top: 0; }

        .btn-primary { background: var(--theme-color); color: #333; border: none; padding: 15px; width: 100%; border-radius: 25px; font-size: 1.1rem; font-weight: bold; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-top: auto; transition: 0.2s; }
        .btn-primary:active { transform: scale(0.98); }
        
        .btn-secondary { background: #eee; color: #555; border: none; padding: 15px; width: 100%; border-radius: 25px; font-weight: bold; cursor: pointer; }

        .card { background: white; border-radius: 20px; padding: 15px; margin-bottom: 15px; display: flex; align-items: center; gap: 15px; border: 1px solid #f0f0f0; box-shadow: 0 3px 8px rgba(0,0,0,0.03); cursor: pointer; transition: 0.2s; position: relative; overflow: hidden; }
        .card:active { transform: scale(0.98); background: #fafafa; }
        
        .icon-box { width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: white; flex-shrink: 0; }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background:white; border-bottom: 1px solid #f9f9f9; z-index: 20; }

        /* --- 6. SAYFA STƒ∞LLERƒ∞ --- */
        
        /* Product Hero */
        .product-hero { width: 100%; height: 200px; border-radius: 20px; overflow: hidden; margin-bottom: 20px; position: relative; border: 1px solid #eee; }
        .product-hero img { width: 100%; height: 100%; object-fit: cover; }
        .product-tag { position: absolute; bottom: 10px; left: 10px; background: rgba(255,255,255,0.9); padding: 5px 15px; border-radius: 15px; font-size: 0.8rem; font-weight: bold; color: var(--dark-purple); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        /* Profil */
        .avatar-grid { display: flex; gap: 15px; justify-content: center; margin-bottom: 20px; }
        .avatar-opt { width: 70px; height: 70px; border-radius: 50%; border: 4px solid transparent; cursor: pointer; object-fit: cover; transition: 0.2s; background: #eee; }
        .avatar-opt.selected { border-color: var(--theme-color); transform: scale(1.1); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .custom-input { width: 100%; padding: 15px; background: #f9f9f9; border: 1px solid #eee; border-radius: 15px; margin-bottom: 15px; font-family: 'Nunito'; }

        /* Dashboard */
        .dash-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        
        /* Build Guide - Fotoƒüraf Alanlarƒ± */
        .progress-bar { width: 100%; height: 8px; background: #eee; border-radius: 4px; margin-bottom: 20px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--theme-color); width: 0%; transition: width 0.3s ease; }
        
        .step-image-box { 
            width: 100%; height: 220px; background: #fafafa; border-radius: 20px; margin-bottom: 15px; 
            display: flex; align-items: center; justify-content: center; border: 2px dashed #ddd; 
            overflow: hidden; position: relative; transition: all 0.3s ease;
        }
        .step-image-box img { width: 100%; height: 100%; object-fit: cover; }
        .guide-overlay { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.6); color: white; padding: 5px 12px; border-radius: 12px; font-size: 0.8rem; z-index: 2; }

        /* Lessons */
        .lesson-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        .lesson-card { background: white; border-radius: 20px; padding: 20px; text-align: center; border: 1px solid #f0f0f0; cursor: pointer; box-shadow: 0 3px 8px rgba(0,0,0,0.03); display: flex; flex-direction: column; align-items: center; gap: 10px; transition: 0.2s; }
        .lesson-card:active { transform: scale(0.95); background: #fcfcfc; }
        
        /* Rewards & Profile */
        .profile-header { background: linear-gradient(135deg, #A18CD1 0%, #FBC2EB 100%); padding: 30px; border-radius: 0 0 30px 30px; text-align: center; color: white; margin: -20px -20px 20px -20px; padding-top: 40px; }
        .badge-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .badge-item { background: white; padding: 15px 5px; border-radius: 15px; text-align: center; border: 2px solid transparent; transition: 0.3s; opacity: 0.5; cursor: pointer; filter: grayscale(100%); }
        .badge-item.unlocked { opacity: 1; border-color: gold; box-shadow: 0 5px 15px rgba(255, 215, 0, 0.1); filter: grayscale(0%); }
        
        .lb-item { display: flex; align-items: center; padding: 15px; border-bottom: 1px solid #eee; cursor: pointer; transition: 0.2s; }
        .lb-item:hover { background: #f9f9f9; }
        .lb-rank { font-weight: bold; width: 30px; font-size: 1.1rem; }
        .lb-avatar { width: 40px; height: 40px; border-radius: 50%; margin-right: 15px; object-fit: cover; border: 2px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        /* Upload Area Style */
        .step-upload-btn {
            background: white; border: 2px dashed #ccc; padding: 15px; border-radius: 15px;
            cursor: pointer; margin-bottom: 20px; text-align: center; transition: 0.2s; display: flex;
            align-items: center; justify-content: center; gap: 10px; font-weight: bold; color: #666;
        }
        .step-upload-btn:active { background: #f0f0f0; border-color: var(--dark-purple); }

        /* Bottom Nav */
        .bottom-nav { position: absolute; bottom: 0; width: 100%; height: 85px; background: white; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #f0f0f0; padding-bottom: 15px; z-index: 100; box-shadow: 0 -5px 20px rgba(0,0,0,0.03); }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 5px; color: #ccc; font-size: 0.75rem; cursor: pointer; width: 20%; transition: 0.2s; }
        .nav-item.active { color: var(--dark-purple); font-weight: bold; transform: translateY(-2px); }
        .nav-item i { font-size: 1.4rem; }

        @keyframes popIn { from {transform: scale(0.8); opacity: 0;} to {transform: scale(1); opacity: 1;} }
        @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
        @keyframes pulse { 0% {transform: scale(1);} 50% {transform: scale(1.2);} 100% {transform: scale(1);} }
    </style>
</head>
<body>

<div id="app-frame">
    <div class="notch"></div>
    <div id="toast-container"></div>
    <canvas id="confetti-canvas" style="position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:1500;"></canvas>

    <!-- MODAL: ROZET DETAYI -->
    <div id="badge-modal" class="modal-overlay" onclick="closeModal('badge-modal')">
        <div class="modal-box" onclick="event.stopPropagation()">
            <i class="fa-solid fa-xmark close-modal" onclick="closeModal('badge-modal')"></i>
            <div style="font-size:4rem; margin-bottom:10px;" id="m-badge-icon">ü•á</div>
            <h2 id="m-badge-title">Ba≈ülƒ±k</h2>
            <p id="m-badge-desc">A√ßƒ±klama</p>
            <div style="margin-top:20px; background:#f9f9f9; padding:10px; border-radius:10px; border:1px solid #eee;">
                <small>Durum: <span id="m-badge-status" style="font-weight:bold;">Kilitli</span></small>
            </div>
        </div>
    </div>

    <!-- MODAL: ARKADA≈û PROFƒ∞Lƒ∞ -->
    <div id="friend-modal" class="modal-overlay" onclick="closeModal('friend-modal')">
        <div class="modal-box" onclick="event.stopPropagation()">
            <i class="fa-solid fa-xmark close-modal" onclick="closeModal('friend-modal')"></i>
            <img id="m-friend-img" src="" style="width:90px; height:90px; border-radius:50%; margin-bottom:15px; border:4px solid var(--purple);">
            <h2 id="m-friend-name">ƒ∞sim</h2>
            <p id="m-friend-level">Seviye 5 ‚Ä¢ Usta Tasarƒ±mcƒ±</p>
            <div style="margin-top:20px; display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                <div style="background:#f4f7f6; padding:15px; border-radius:15px;"><b>Favori</b><br>üé® Sanat</div>
                <div style="background:#f4f7f6; padding:15px; border-radius:15px;"><b>Puan</b><br>1500</div>
            </div>
        </div>
    </div>

    <!-- 1. SPLASH -->
    <div id="s-splash" class="screen active" style="align-items:center; justify-content:center; background:var(--bg-color);">
        <img src="images/logo.png" alt="Logo" style="width:140px; animation:popIn 0.8s;">
        <h1 style="margin-top:20px; color:var(--dark-purple);">Squishables</h1>
    </div>

    <!-- 2. ONBOARDING -->
    <div id="s-on1" class="screen" style="padding:30px; text-align:center;">
        <div class="product-hero" style="height:300px; border:none; box-shadow:none;">
            <img src="Product1.jpg" style="object-fit:contain;">
        </div>
        <h1>Kutunu A√ß, D√ºnyanƒ± Yarat</h1>
        <p>Squishables kitiyle ailecek hem √∂ƒürenin hem eƒülenin.</p>
        <button class="btn-primary" onclick="nav('s-on2')">ƒ∞leri</button>
    </div>
    <div id="s-on2" class="screen" style="padding:30px; text-align:center;">
        <div style="font-size:5rem; margin:40px 0;">üèÜ</div>
        <h1>√ñƒüren & Profilini Geli≈ütir</h1>
        <p>Aktiviteleri tamamla, puan topla, profilini √∂zelle≈ütir!</p>
        <button class="btn-primary" onclick="nav('s-profile')">Ba≈üla</button>
    </div>

    <!-- 3. PROFIL KURULUMU -->
    <div id="s-profile" class="screen">
        <div class="header"><i class="fa-solid fa-arrow-left" onclick="nav('s-on2')"></i><h3>Profilini Olu≈ütur</h3><div></div></div>
        <div class="scroll-content">
            <p style="text-align:center; font-weight:bold; margin-bottom:15px;">Bir Avatar Se√ß:</p>
            <div class="avatar-grid">
                <img src="images/avatar1.png" class="avatar-opt selected" onclick="pickAvatar(this)">
                <img src="images/avatar2.png" class="avatar-opt" onclick="pickAvatar(this)">
                <img src="images/avatar3.png" class="avatar-opt" onclick="pickAvatar(this)">
            </div>

            <div class="input-group">
                <label>ƒ∞smin Nedir?</label>
                <input type="text" id="inp-name" class="custom-input" placeholder="√ñrn: Deniz">
            </div>
            <div class="input-group">
                <label>Favori Rengin</label>
                <div style="display:flex; gap:10px; margin-top:5px;">
                    <div style="width:40px; height:40px; background:#C4DFD9; border-radius:50%; cursor:pointer; border:2px solid #333;" onclick="pickColor('#C4DFD9')"></div>
                    <div style="width:40px; height:40px; background:#FFD1BA; border-radius:50%; cursor:pointer;" onclick="pickColor('#FFD1BA')"></div>
                    <div style="width:40px; height:40px; background:#DCD6F7; border-radius:50%; cursor:pointer;" onclick="pickColor('#DCD6F7')"></div>
                </div>
            </div>
        </div>
        <div style="padding:20px;"><button class="btn-primary" onclick="saveProfile()">Kaydet</button></div>
    </div>

    <!-- 4. ANA SAYFA -->
    <div id="s-home" class="screen">
        <div class="header">
            <div><p style="margin:0;">Ho≈ü geldin,</p><h2 style="margin:0;" id="home-name">Yaratƒ±cƒ±</h2></div>
            <div style="background:#FFF3E0; color:#FF9800; padding:6px 15px; border-radius:20px; font-weight:bold; font-size:0.9rem;" onclick="nav('s-rewards')">
                <i class="fa-solid fa-star"></i> <span id="home-lvl">1</span>
            </div>
        </div>
        <div class="scroll-content">
            <!-- √úr√ºn Kartƒ± -->
            <div class="product-hero" onclick="nav('s-challenges')">
                <img src="Product1.jpg" alt="√úr√ºn">
                <div class="product-tag">Kutumun ƒ∞√ßindekiler</div>
            </div>

            <!-- Dashboard -->
            <div class="dash-grid">
                <div class="card" style="flex-direction:column; background:#E8F5E9; border:none; padding:20px;" onclick="nav('s-build')">
                    <i class="fa-solid fa-graduation-cap" style="font-size:2rem; color:var(--dark-mint); margin-bottom:10px;"></i>
                    <b>Dersler</b>
                    <small>√ñƒürenmeye Ba≈üla</small>
                </div>
                <div class="card" style="flex-direction:column; background:#FFF8E1; border:none; padding:20px;" onclick="nav('s-challenges')">
                    <i class="fa-solid fa-shapes" style="font-size:2rem; color:#FFB300; margin-bottom:10px;"></i>
                    <b>Rehberler</b>
                    <small>Yeni ≈ûeyler Yap</small>
                </div>
            </div>

            <h3 style="margin-top:25px;">Son Aktiviteler</h3>
            <div style="display:flex; gap:10px; overflow-x:auto; padding-bottom:10px;">
                <div class="card" style="min-width:110px; flex-direction:column; padding:15px;" onclick="setupGuide('flower')">
                    <span style="font-size:1.5rem;">üå∏</span><small style="margin-top:5px;">√ái√ßek</small>
                </div>
                <div class="card" style="min-width:110px; flex-direction:column; padding:15px;" onclick="nav('s-build')">
                    <span style="font-size:1.5rem;">‚ûï</span><small style="margin-top:5px;">Matematik</small>
                </div>
                <div class="card" style="min-width:110px; flex-direction:column; padding:15px;" onclick="nav('s-rewards')">
                    <span style="font-size:1.5rem;">üèÜ</span><small style="margin-top:5px;">Profil</small>
                </div>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item active" onclick="nav('s-home')"><i class="fa-solid fa-house"></i><span>Ana Sayfa</span></div>
            <div class="nav-item" onclick="nav('s-challenges')"><i class="fa-solid fa-hammer"></i><span>Yap</span></div>
            <div class="nav-item" onclick="nav('s-build')"><i class="fa-solid fa-book-open"></i><span>√ñƒüren</span></div>
            <div class="nav-item" onclick="nav('s-rewards')"><i class="fa-solid fa-user"></i><span>Profil</span></div>
        </div>
    </div>

    <!-- 5. CHALLENGES (YAP) -->
    <div id="s-challenges" class="screen">
        <div class="header"><h3>Neler Yapabilirsin?</h3></div>
        <div class="scroll-content">
            <p style="margin-bottom:15px;">Kutundaki malzemeleri kullanarak ≈üunlarƒ± yap:</p>
            
            <div class="card" onclick="setupGuide('flower')">
                <div class="icon-box" style="background:var(--mint);">üå∏</div>
                <div style="flex:1;"><h3>√ái√ßek Bah√ßesi</h3><p>Hamur ile renkli √ßi√ßekler.</p></div>
                <i class="fa-solid fa-chevron-right" style="color:#ccc;"></i>
            </div>
            
            <div class="card" onclick="setupGuide('castle')">
                <div class="icon-box" style="background:var(--peach);">üè∞</div>
                <div style="flex:1;"><h3>B√ºy√ºl√º Kale</h3><p>Kendi kaleni in≈üa et.</p></div>
                <i class="fa-solid fa-chevron-right" style="color:#ccc;"></i>
            </div>

            <div class="card" onclick="setupGuide('animal')">
                <div class="icon-box" style="background:var(--purple);">ü¶Å</div>
                <div style="flex:1;"><h3>Sevimli Hayvanlar</h3><p>Orman arkada≈ülarƒ± yap.</p></div>
                <i class="fa-solid fa-chevron-right" style="color:#ccc;"></i>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item" onclick="nav('s-home')"><i class="fa-solid fa-house"></i><span>Ana Sayfa</span></div>
            <div class="nav-item active" onclick="nav('s-challenges')"><i class="fa-solid fa-hammer"></i><span>Yap</span></div>
            <div class="nav-item" onclick="nav('s-build')"><i class="fa-solid fa-book-open"></i><span>√ñƒüren</span></div>
            <div class="nav-item" onclick="nav('s-rewards')"><i class="fa-solid fa-user"></i><span>Profil</span></div>
        </div>
    </div>

    <!-- 6. GUIDE (FOTOƒûRAFLI REHBER) -->
    <div id="s-guide-intro" class="screen">
        <div class="header"><i class="fa-solid fa-arrow-left" onclick="nav('s-challenges')"></i><h3>Aktivite</h3><div></div></div>
        <div class="scroll-content" style="text-align:center; padding-top:40px;">
            <div style="font-size:6rem; margin-bottom:20px;" id="intro-icon">üå∏</div>
            <h1 id="intro-title">√ái√ßek Yapƒ±mƒ±</h1>
            <p>Bu aktivite i√ßin hamurlarƒ±nƒ± hazƒ±rla!</p>
            <div style="margin:30px 0; background:#f9f9f9; padding:15px; border-radius:15px; text-align:left;">
                <b>Gerekenler:</b>
                <ul style="margin-bottom:0; color:#555;">
                    <li>Kƒ±rmƒ±zƒ± ve Ye≈üil Hamur</li>
                    <li>≈ûekillendirme √áubuƒüu</li>
                </ul>
            </div>
            <button class="btn-primary" onclick="startActualGuide()">Adƒ±mlarƒ± Ba≈ülat</button>
        </div>
    </div>

    <div id="s-guide-steps" class="screen">
        <div class="header">
            <i class="fa-solid fa-xmark" onclick="nav('s-challenges')" style="font-size:1.5rem; cursor:pointer;"></i>
            <h3 id="step-header">Adƒ±m 1/4</h3>
            <div></div>
        </div>
        <div class="scroll-content" style="text-align:center;">
            <div class="progress-bar"><div class="progress-fill" id="p-fill"></div></div>
            
            <!-- 1. Kutu: √ñrnek Fotoƒüraf -->
            <div class="step-image-box">
                <div class="guide-overlay">√ñrnek G√∂r√ºn√ºm</div>
                <img id="step-img-example" src="" style="width:100%; height:100%; object-fit:cover;">
            </div>

            <!-- 2. Kutu: Kullanƒ±cƒ± Fotoƒürafƒ± (Y√ºklenince G√∂r√ºn√ºr) -->
            <div class="step-image-box" id="user-upload-container" style="display:none; border-color:var(--purple);">
                <div class="guide-overlay" style="background:var(--purple);">Senin Yaptƒ±ƒüƒ±n</div>
                <img id="step-uploaded-img" style="width:100%; height:100%; object-fit:cover;">
            </div>

            <h2 id="step-title-text">Ba≈ülƒ±k</h2>
            <p id="step-desc-text">A√ßƒ±klama</p>

            <div class="step-upload-btn" onclick="document.getElementById('step-file').click()">
                <i class="fa-solid fa-camera" style="font-size:1.5rem; margin-bottom:5px;"></i>
                <div>Yaptƒ±ƒüƒ±nƒ± √áek ve Y√ºkle</div>
            </div>
            <input type="file" id="step-file" style="display:none;" accept="image/*" onchange="handleStepUpload(this)">

            <div style="margin-top:20px; display:flex; gap:10px;">
                <button class="btn-secondary" style="flex:1;" onclick="prevGuideStep()">Geri</button>
                <button class="btn-primary" style="flex:2;" onclick="nextGuideStep()">ƒ∞leri</button>
            </div>
        </div>
    </div>

    <!-- 7. √ñƒûREN (DERSLER) -->
    <div id="s-build" class="screen">
        <div class="header"><h3>Dersler</h3></div>
        <div class="scroll-content">
            <div class="lesson-grid">
                <div class="lesson-card" onclick="startLesson('Matematik')">
                    <i class="fa-solid fa-calculator lesson-icon-lg" style="color:var(--purple);"></i>
                    <b>Matematik</b>
                </div>
                <div class="lesson-card" onclick="startLesson('Renkler')">
                    <i class="fa-solid fa-palette lesson-icon-lg" style="color:var(--peach);"></i>
                    <b>Renkler</b>
                </div>
                <div class="lesson-card" onclick="startLesson('≈ûekiller')">
                    <i class="fa-solid fa-shapes lesson-icon-lg" style="color:var(--mint);"></i>
                    <b>≈ûekiller</b>
                </div>
                <div class="lesson-card" onclick="startLesson('Uzay')">
                    <i class="fa-solid fa-rocket lesson-icon-lg" style="color:#4FC3F7;"></i>
                    <b>Uzay</b>
                </div>
                <div class="lesson-card" onclick="startLesson('M√ºzik')">
                    <i class="fa-solid fa-music lesson-icon-lg" style="color:#FF6B6B;"></i>
                    <b>M√ºzik</b>
                </div>
                <div class="lesson-card" onclick="startLesson('Hayvanlar')">
                    <i class="fa-solid fa-paw lesson-icon-lg" style="color:#FFD54F;"></i>
                    <b>Hayvanlar</b>
                </div>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item" onclick="nav('s-home')"><i class="fa-solid fa-house"></i><span>Ana Sayfa</span></div>
            <div class="nav-item" onclick="nav('s-challenges')"><i class="fa-solid fa-hammer"></i><span>Yap</span></div>
            <div class="nav-item active" onclick="nav('s-build')"><i class="fa-solid fa-book-open"></i><span>√ñƒüren</span></div>
            <div class="nav-item" onclick="nav('s-rewards')"><i class="fa-solid fa-user"></i><span>Profil</span></div>
        </div>
    </div>

    <!-- 8. PROFIL & REWARDS -->
    <div id="s-rewards" class="screen">
        <div class="scroll-content" style="padding:0;">
            <div class="profile-header">
                <img id="profile-avatar-display" src="images/avatar1.png" style="width:90px; height:90px; border-radius:50%; border:4px solid white; margin-bottom:10px; background:#fff;">
                <h2 style="margin:0; color:white;" id="profile-name-display">ƒ∞simsiz</h2>
                <p style="color:rgba(255,255,255,0.9); margin-top:5px;">Seviye <span id="p-lvl">1</span> ‚Ä¢ √áƒ±rak</p>
                
                <div style="margin-top:20px; display:flex; justify-content:center; gap:20px;">
                    <div style="background:rgba(255,255,255,0.2); padding:10px 20px; border-radius:15px;">
                        <b style="font-size:1.2rem;" id="p-xp">0</b><br><small>XP Puan</small>
                    </div>
                    <div style="background:rgba(255,255,255,0.2); padding:10px 20px; border-radius:15px;">
                        <b style="font-size:1.2rem;">1</b><br><small>Sƒ±ralama</small>
                    </div>
                </div>
            </div>

            <div style="padding:20px;">
                <h3 style="margin-top:0;">Rozetlerin</h3>
                <div class="badge-grid">
                    <div class="badge-item unlocked" onclick="openBadgeModal('ƒ∞lk Adƒ±m', 'Uygulamaya giri≈ü yaparak ilk adƒ±mƒ±nƒ± attƒ±n!', 'ü•á', 'Kazanƒ±ldƒ±')">
                        <span class="badge-icon">ü•á</span><small>Ba≈ülangƒ±√ß</small>
                    </div>
                    <div class="badge-item" onclick="openBadgeModal('Usta Yapƒ±cƒ±', '3 farklƒ± rehberi tamamla.', 'üõ†Ô∏è', 'Kilitli')">
                        <span class="badge-icon">üõ†Ô∏è</span><small>Usta</small>
                    </div>
                    <div class="badge-item" onclick="openBadgeModal('Sanat√ßƒ±', 'Kendi √∂zg√ºn tasarƒ±mƒ±nƒ± y√ºkle.', 'üé®', 'Kilitli')">
                        <span class="badge-icon">üé®</span><small>Sanat√ßƒ±</small>
                    </div>
                </div>

                <h3>Arkada≈ülarƒ±n (Liderlik)</h3>
                <div class="card" style="flex-direction:column; align-items:stretch; gap:0; padding:0;">
                    <div class="lb-item" onclick="openFriendModal('Ay≈üe', 'Seviye 5', 'images/avatar2.png')">
                        <div class="lb-rank" style="color:gold;">1</div>
                        <img src="images/avatar2.png" class="lb-avatar">
                        <div class="lb-info"><span class="lb-name">Ay≈üe</span></div>
                        <div class="lb-score">1500</div>
                    </div>
                    <div class="lb-item" onclick="openFriendModal('Ali', 'Seviye 4', 'images/avatar3.png')">
                        <div class="lb-rank" style="color:silver;">2</div>
                        <img src="images/avatar3.png" class="lb-avatar">
                        <div class="lb-info"><span class="lb-name">Ali</span></div>
                        <div class="lb-score">1250</div>
                    </div>
                    <div class="lb-item" style="background:#f0f0f0;">
                        <div class="lb-rank">3</div>
                        <img id="lb-my-avatar" src="images/avatar1.png" class="lb-avatar">
                        <div class="lb-info"><span class="lb-name">Sen</span></div>
                        <div class="lb-score" id="lb-score">0</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item" onclick="nav('s-home')"><i class="fa-solid fa-house"></i><span>Ana Sayfa</span></div>
            <div class="nav-item" onclick="nav('s-challenges')"><i class="fa-solid fa-hammer"></i><span>Yap</span></div>
            <div class="nav-item" onclick="nav('s-build')"><i class="fa-solid fa-book-open"></i><span>√ñƒüren</span></div>
            <div class="nav-item active" onclick="nav('s-rewards')"><i class="fa-solid fa-user"></i><span>Profil</span></div>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
    /* --- VERƒ∞LER --- */
    const guideData = {
        flower: { 
            title: "√ái√ßek Yapƒ±mƒ±", icon: "üå∏",
            steps: [
                { t: "Merkezi Yap", d: "Turuncu hamuru yuvarla.", img: "images/cicek_adim1.jpg" },
                { t: "Yapraklarƒ± Hazƒ±rla", d: "Pembe toplar yap.", img: "images/cicek_adim2.jpg" },
                { t: "Birle≈ütir", d: "Yapraklarƒ± merkeze ekle.", img: "images/cicek_adim3.jpg" },
                { t: "Sapƒ± Ekle", d: "Ye≈üil hamurdan sap yap.", img: "images/cicek_adim4.jpg" },
                { t: "Yapraklarƒ± Ekle", d: "Sapa k√º√ß√ºk ye≈üil yapraklar ekle.", img: "images/cicek_adim5.jpg" } // New Step
            ]
        },
        castle: { 
            title: "Kale Yapƒ±mƒ±", icon: "üè∞",
            steps: [
                { t: "Taban", d: "Kare bir taban yap.", img: "images/kale_adim1.jpg" },
                { t: "Kuleler", d: "4 silindir kule ekle.", img: "images/kale_adim2.jpg" }
            ]
        },
        animal: { title: "Hayvan", icon: "ü¶Å", steps: [{ t: "G√∂vde", d: "Oval g√∂vde yap.", img: "images/hayvan_adim1.jpg" }] }
    };

    /* --- DEƒûƒ∞≈ûKENLER --- */
    let xp = 0;
    let level = 1;
    let activeGuideKey = null;
    let guideStepIndex = 0;
    let guidePhotos = []; // Kullanƒ±cƒ±nƒ±n y√ºklediƒüi fotoƒüraflar

    /* --- BA≈ûLATMA --- */
    // Test i√ßin splash 1.5 sn sonra onboarding'e ge√ßer
    setTimeout(() => nav('s-on1'), 1500);

    /* --- NAVƒ∞GASYON --- */
    function nav(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        if(id.includes('home')) document.querySelectorAll('.nav-item')[0].classList.add('active');
        if(id.includes('challenges') || id.includes('guide')) document.querySelectorAll('.nav-item')[1].classList.add('active');
        if(id.includes('build')) document.querySelectorAll('.nav-item')[2].classList.add('active');
        if(id.includes('rewards')) document.querySelectorAll('.nav-item')[3].classList.add('active');
    }

    function showToast(msg, type='neutral') {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.innerHTML = msg;
        container.appendChild(toast);
        setTimeout(() => toast.classList.add('show'), 10);
        setTimeout(() => { toast.classList.remove('show'); setTimeout(() => toast.remove(), 300); }, 3000);
    }

    /* --- PROFƒ∞L --- */
    function pickColor(color) {
        document.documentElement.style.setProperty('--theme-color', color);
    }
    function pickAvatar(el) {
        document.querySelectorAll('.avatar-opt').forEach(a => a.classList.remove('selected'));
        el.classList.add('selected');
        document.getElementById('profile-avatar-display').src = el.src;
        document.getElementById('lb-my-avatar').src = el.src;
    }
    function saveProfile() {
        const name = document.getElementById('inp-name').value;
        if(name) {
            document.getElementById('home-name').innerText = name;
            document.getElementById('profile-name-display').innerText = name;
        }
        showToast('Profil Hazƒ±r!', 'success');
        nav('s-home');
    }

    /* --- GUIDE (REHBER) --- */
    function setupGuide(key) {
        activeGuideKey = key;
        const g = guideData[key];
        document.getElementById('intro-title').innerText = g.title;
        document.getElementById('intro-icon').innerText = g.icon;
        nav('s-guide-intro');
    }

    function startActualGuide() {
        guideStepIndex = 0;
        guidePhotos = new Array(guideData[activeGuideKey].steps.length).fill(null);
        renderStep();
        nav('s-guide-steps');
    }

    function renderStep() {
        const g = guideData[activeGuideKey];
        const step = g.steps[guideStepIndex];
        
        document.getElementById('step-header').innerText = `Adƒ±m ${guideStepIndex + 1}`;
        document.getElementById('step-title-text').innerText = step.t;
        document.getElementById('step-desc-text').innerText = step.d;
        
        // √ñrnek fotoƒürafƒ± yerel dosyadan √ßek
        document.getElementById('step-img-example').src = step.img; 
        
        // Kullanƒ±cƒ± Y√ºkleme Alanƒ± Kontrol√º
        const userImg = document.getElementById('step-uploaded-img');
        const userContainer = document.getElementById('user-upload-container');
        
        if(guidePhotos[guideStepIndex]) {
            userImg.src = guidePhotos[guideStepIndex];
            userContainer.style.display = 'flex'; // Varsa g√∂ster
        } else {
            userContainer.style.display = 'none'; // Yoksa gizle
        }

        const pct = ((guideStepIndex + 1) / g.steps.length) * 100;
        document.getElementById('p-fill').style.width = `${pct}%`;
    }

    function handleStepUpload(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                guidePhotos[guideStepIndex] = e.target.result;
                renderStep();
                showToast('Fotoƒüraf Y√ºklendi!', 'success');
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    function nextGuideStep() {
        if(!guidePhotos[guideStepIndex]) {
            showToast('L√ºtfen √∂nce fotoƒüraf y√ºkle!', 'error');
            return;
        }
        
        if(guideStepIndex < guideData[activeGuideKey].steps.length - 1) {
            guideStepIndex++;
            renderStep();
        } else {
            addXP(50);
            launchConfetti();
            nav('s-rewards'); // √ñzet yerine direkt profile √∂d√ºl almaya gitsin
            showToast('Tebrikler! +50 XP', 'success');
        }
    }
    function prevGuideStep() {
        if(guideStepIndex > 0) { guideStepIndex--; renderStep(); } else { nav('s-guide-intro'); }
    }

    /* --- DERSLER --- */
    function startLesson(name) {
        showToast(`${name} dersi y√ºkleniyor...`, 'success');
        // Buraya ders/quiz ekranƒ± eklenebilir
    }

    /* --- GAMIFICATION --- */
    function addXP(amount) {
        xp += amount;
        document.getElementById('p-xp').innerText = xp;
        document.getElementById('xp-text').innerText = xp + "/100 XP";
        document.getElementById('lb-score').innerText = xp;
        document.getElementById('xp-bar').style.width = Math.min(xp, 100) + "%";
        
        if(xp >= 100) {
            level++;
            xp = 0; // Basitlik i√ßin sƒ±fƒ±rla
            document.getElementById('p-lvl').innerText = level;
            document.getElementById('lvl-num').innerText = level;
            showToast('Seviye Atladƒ±n!', 'success');
        }
    }

    function launchConfetti() { confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } }); }

    /* --- MODALS --- */
    function openBadgeModal(t, d, i, s) {
        document.getElementById('m-badge-title').innerText = t;
        document.getElementById('m-badge-desc').innerText = d;
        document.getElementById('m-badge-icon').innerText = i;
        document.getElementById('m-badge-status').innerText = s;
        document.getElementById('badge-modal').style.display = 'flex';
    }
    function openFriendModal(n, l, img) {
        document.getElementById('m-friend-name').innerText = n;
        document.getElementById('m-friend-level').innerText = l;
        document.getElementById('m-friend-img').src = img;
        document.getElementById('friend-modal').style.display = 'flex';
    }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }

</script>

</body>
</html>
