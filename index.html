<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Squishables Learning App</title>
    
    <!-- PWA Ayarlarƒ± -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#DCD6F7">
    <link rel="apple-touch-icon" href="logo.png">

    <!-- Fontlar ve ƒ∞konlar -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- 1. CSS TEMEL AYARLAR --- */
        :root {
            --theme-color: #C4DFD9; /* Dinamik */
            --mint: #C4DFD9; --dark-mint: #2e5c4d;
            --peach: #FFD1BA; --dark-peach: #d68c6d;
            --purple: #DCD6F7; --dark-purple: #424874;
            --bg-color: #eef2f5; --white: #ffffff;
            --text-dark: #2D2D2D; --text-light: #888;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { margin: 0; padding: 0; font-family: 'Nunito', sans-serif; background-color: var(--bg-color); display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }

        /* --- 2. APP √áER√áEVESƒ∞ --- */
        #app-frame {
            width: 375px; height: 812px; background-color: var(--white);
            border-radius: 40px; position: relative; overflow: hidden;
            box-shadow: 0 30px 60px rgba(0,0,0,0.3); border: 8px solid #222;
        }
        .notch { position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 150px; height: 30px; background: #222; border-radius: 0 0 20px 20px; z-index: 999; }

        /* --- 3. Bƒ∞LDƒ∞Rƒ∞M & MODAL Sƒ∞STEMƒ∞ --- */
        #toast-container { position: absolute; top: 50px; left: 50%; transform: translateX(-50%); z-index: 3000; width: 90%; pointer-events: none; display: flex; flex-direction: column; gap: 10px; }
        .toast {
            background: rgba(50, 50, 50, 0.95); color: white; padding: 12px 20px; border-radius: 30px;
            text-align: center; opacity: 0; transform: translateY(-20px); transition: 0.4s; font-size: 0.9rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center; gap: 10px; backdrop-filter: blur(5px);
        }
        .toast.show { opacity: 1; transform: translateY(0); }
        .toast.success { background: rgba(46, 92, 77, 0.95); }

        .modal-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2500; display: none; align-items: center; justify-content: center; animation: fadeIn 0.3s; }
        .modal-box { background: white; width: 85%; padding: 25px; border-radius: 25px; text-align: center; animation: popIn 0.3s; position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .close-modal { position: absolute; top: 15px; right: 15px; font-size: 1.5rem; cursor: pointer; color: #888; }

        /* --- 4. EKRANLAR --- */
        .screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: white; display: none; flex-direction: column; padding-top: 40px; animation: fadeIn 0.3s ease; z-index: 10; }
        .screen.active { display: flex; }
        .scroll-content { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; }
        .scroll-content::-webkit-scrollbar { display: none; }

        /* --- 5. UI Bƒ∞LE≈ûENLERƒ∞ --- */
        h1, h2, h3 { font-family: 'Fredoka', sans-serif; color: var(--text-dark); margin: 10px 0; }
        p { color: var(--text-light); font-size: 0.9rem; line-height: 1.5; margin-top: 0; }

        .btn-primary { background: var(--theme-color); color: #333; border: none; padding: 15px; width: 100%; border-radius: 25px; font-size: 1.1rem; font-weight: bold; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-top: auto; transition: 0.2s; }
        .btn-primary:active { transform: scale(0.98); }
        
        .btn-secondary { background: #eee; color: #555; border: none; padding: 15px; width: 100%; border-radius: 25px; font-weight: bold; cursor: pointer; }

        .card { background: white; border-radius: 20px; padding: 15px; margin-bottom: 15px; display: flex; align-items: center; gap: 15px; border: 1px solid #f0f0f0; box-shadow: 0 3px 8px rgba(0,0,0,0.03); cursor: pointer; transition: 0.2s; position: relative; overflow: hidden; }
        .card:active { transform: scale(0.98); background: #fafafa; }
        
        .icon-box { width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: white; flex-shrink: 0; }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background:white; border-bottom: 1px solid #f9f9f9; z-index: 20; }

        /* --- √ñZEL SAYFA STƒ∞LLERƒ∞ --- */
        /* Profil Setup */
        .input-group { margin-bottom: 15px; }
        .custom-input { width: 100%; padding: 15px; background: #f9f9f9; border: 1px solid #eee; border-radius: 15px; margin-bottom: 10px; font-family: 'Nunito'; font-size: 1rem; }
        .avatar-grid { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; }
        .avatar-opt { width: 60px; height: 60px; border-radius: 50%; border: 3px solid transparent; cursor: pointer; object-fit: cover; }
        .avatar-opt.selected { border-color: var(--theme-color); transform: scale(1.1); }
        .color-picker { display: flex; gap: 15px; margin-top: 5px; }
        .color-opt { width: 50px; height: 50px; border-radius: 50%; cursor: pointer; border: 3px solid transparent; }
        .color-opt.selected { border-color: #333; transform: scale(1.1); }
        
        /* Rewards & Profile Page */
        .points-banner { background: linear-gradient(135deg, #FF9A9E 0%, #FECFEF 100%); padding: 30px; border-radius: 25px; text-align: center; color: white; margin-bottom: 20px; position: relative; }
        .badge-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .badge-item { background: white; padding: 10px; border-radius: 15px; text-align: center; border: 2px solid transparent; transition: 0.3s; opacity: 0.6; cursor: pointer; filter: grayscale(100%); }
        .badge-item.unlocked { opacity: 1; border-color: gold; box-shadow: 0 5px 15px rgba(255, 215, 0, 0.2); filter: grayscale(0%); }
        .badge-icon { font-size: 2rem; margin-bottom: 5px; display: block; }

        .leaderboard-list { display: flex; flex-direction: column; gap: 0; }
        .lb-item { display: flex; align-items: center; padding: 15px; border-bottom: 1px solid #eee; cursor: pointer; transition: 0.2s; }
        .lb-item:active { background: #f9f9f9; }
        .lb-rank { font-weight: bold; width: 30px; font-size: 1.1rem; }
        .lb-avatar { width: 40px; height: 40px; border-radius: 50%; background: #eee; margin-right: 15px; object-fit: cover; }
        .lb-info { flex: 1; }
        .lb-name { font-weight: bold; display: block; }
        .lb-level { font-size: 0.8rem; color: #888; }
        .lb-score { font-weight: bold; color: var(--dark-purple); }

        /* Build Guide (Adƒ±m Adƒ±m) */
        .progress-bar { width: 100%; height: 6px; background: #eee; border-radius: 3px; margin-bottom: 20px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--theme-color); width: 0%; transition: width 0.3s ease; }
        .step-image-box { width: 100%; height: 220px; background: #f9f9f9; border-radius: 20px; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; font-size: 4rem; color: var(--theme-color); border: 2px dashed #eee; overflow: hidden; position: relative; }
        .step-image-box img { width: 100%; height: 100%; object-fit: cover; display: none; }
        .step-upload-btn { background: white; border: 2px dashed #ccc; padding: 15px; border-radius: 15px; cursor: pointer; margin-bottom: 20px; text-align: center; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px; font-weight: bold; color: #666; }
        
        /* Summary Grid */
        .summary-grid { display: flex; flex-direction: column; gap: 15px; margin-top: 20px; }
        .summary-card { background: white; padding: 10px; border-radius: 15px; display: flex; align-items: center; gap: 15px; border: 1px solid #eee; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .summary-thumb { width: 70px; height: 70px; border-radius: 10px; background: #eee; object-fit: cover; border: 1px solid #ddd; }

        /* Buddy & Lessons */
        .lesson-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        .lesson-card { background: white; border-radius: 20px; padding: 15px; text-align: center; border: 1px solid #f0f0f0; cursor: pointer; box-shadow: 0 3px 8px rgba(0,0,0,0.03); display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .lesson-icon-lg { font-size: 2rem; margin-bottom: 5px; }
        .upload-area { border: 2px dashed #ccc; padding: 30px; border-radius: 20px; text-align: center; cursor: pointer; margin-top: 20px; background: #fafafa; position: relative; }
        #buddy-preview { width: 100%; max-height: 150px; object-fit: contain; display: none; margin-top: 10px; border-radius: 10px; }

        /* Bottom Nav */
        .bottom-nav { position: absolute; bottom: 0; width: 100%; height: 80px; background: white; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #f0f0f0; padding-bottom: 15px; z-index: 100; }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; color: #ccc; font-size: 0.75rem; cursor: pointer; width: 20%; }
        .nav-item.active { color: var(--theme-color); font-weight: bold; filter: brightness(0.7); }
        .nav-item i { font-size: 1.4rem; }

        /* Animations */
        @keyframes popIn { from {transform: scale(0);} to {transform: scale(1);} }
        @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
    </style>
</head>
<body>

<div id="app-frame">
    <div class="notch"></div>
    <div id="toast-container"></div>
    <canvas id="confetti-canvas" style="position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:1500;"></canvas>

    <!-- MODAL: ROZET DETAYI -->
    <div id="badge-modal" class="modal-overlay" onclick="closeModal('badge-modal')">
        <div class="modal-box" onclick="event.stopPropagation()">
            <i class="fa-solid fa-xmark close-modal" onclick="closeModal('badge-modal')"></i>
            <div style="font-size:4rem; margin-bottom:10px;" id="m-badge-icon">ü•á</div>
            <h2 id="m-badge-title">Rozet Ba≈ülƒ±ƒüƒ±</h2>
            <p id="m-badge-desc">A√ßƒ±klama buraya gelecek.</p>
            <div style="margin-top:20px; background:#f9f9f9; padding:10px; border-radius:10px;">
                <small>Durum: <span id="m-badge-status" style="font-weight:bold;">Kilitli</span></small>
            </div>
        </div>
    </div>

    <!-- MODAL: ARKADA≈û DETAYI -->
    <div id="friend-modal" class="modal-overlay" onclick="closeModal('friend-modal')">
        <div class="modal-box" onclick="event.stopPropagation()">
            <i class="fa-solid fa-xmark close-modal" onclick="closeModal('friend-modal')"></i>
            <img id="m-friend-img" src="" style="width:80px; height:80px; border-radius:50%; margin-bottom:10px; border:3px solid var(--theme-color);">
            <h2 id="m-friend-name">ƒ∞sim</h2>
            <p id="m-friend-level">Seviye 5 ‚Ä¢ Usta Yaratƒ±cƒ±</p>
            <div style="margin-top:20px; display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                <div style="background:#f0f0f0; padding:10px; border-radius:10px;"><b>Favori Renk</b><br>Pembe</div>
                <div style="background:#f0f0f0; padding:10px; border-radius:10px;"><b>Rozetler</b><br>12</div>
            </div>
        </div>
    </div>

    <!-- 1. ONBOARDING -->
    <div id="s-on1" class="screen active" style="padding:30px; text-align:center;">
        <div class="onboard-img" style="background:var(--mint);"><i class="fa-solid fa-palette"></i></div>
        <h1>Eller Hamura,<br>Ekranlar Kenara.</h1>
        <p>Duyusal oyunun sihrini ke≈üfet! Kendi d√ºnyanƒ± yarat.</p>
        <div class="dots" style="margin-top:auto;"><div class="dot active"></div><div class="dot"></div></div>
        <button class="btn-primary" onclick="nav('s-on2')">ƒ∞leri</button>
    </div>
    <div id="s-on2" class="screen" style="padding:30px; text-align:center;">
        <div class="onboard-img" style="background:var(--purple);"><i class="fa-solid fa-trophy"></i></div>
        <h1>√ñƒüren & Kazan</h1>
        <p>G√∂revleri tamamla, rozetlerin kilidini a√ß ve liderlik tablosunda y√ºksel!</p>
        <div class="dots" style="margin-top:auto;"><div class="dot"></div><div class="dot active"></div></div>
        <button class="btn-primary" onclick="nav('s-profile')">Ba≈üla</button>
    </div>

    <!-- 2. PROFIL KURULUMU -->
    <div id="s-profile" class="screen">
        <div class="header"><i class="fa-solid fa-arrow-left" onclick="nav('s-on2')"></i><h3>Profil Olu≈ütur</h3><div></div></div>
        <div class="scroll-content">
            <p style="text-align:center; margin-bottom:10px;">Avatarƒ±nƒ± Se√ß:</p>
            <div class="avatar-grid">
                <img src="https://picsum.photos/seed/ava1/100/100" class="avatar-opt selected" onclick="pickAvatar(this)">
                <img src="https://picsum.photos/seed/ava2/100/100" class="avatar-opt" onclick="pickAvatar(this)">
                <img src="https://picsum.photos/seed/ava3/100/100" class="avatar-opt" onclick="pickAvatar(this)">
            </div>

            <div class="input-group"><label>√áocuk ƒ∞smi</label><input type="text" id="inp-name" class="custom-input" placeholder="ƒ∞sim Giriniz"></div>
            <div class="input-group"><label>Ya≈ü</label><input type="number" class="custom-input" placeholder="5"></div>
            <div class="input-group">
                <label>Uygulama Temasƒ±</label>
                <div class="color-picker">
                    <div class="color-opt selected" style="background:#C4DFD9;" onclick="pickColor(this, '#C4DFD9')"></div>
                    <div class="color-opt" style="background:#FFD1BA;" onclick="pickColor(this, '#FFD1BA')"></div>
                    <div class="color-opt" style="background:#DCD6F7;" onclick="pickColor(this, '#DCD6F7')"></div>
                </div>
            </div>
            <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">
            <div class="input-group"><label>Ebeveyn Adƒ±</label><input type="text" class="custom-input" placeholder="Ebeveyn Adƒ±"></div>
            <div class="input-group"><label>E-posta</label><input type="email" class="custom-input" placeholder="email@ornek.com"></div>
        </div>
        <div style="padding:20px;"><button class="btn-primary" onclick="saveProfile()">Kaydet ve Ba≈üla</button></div>
    </div>

    <!-- 3. ANA SAYFA (HOME) -->
    <div id="s-home" class="screen">
        <div class="header">
            <div><p style="margin:0;">Merhaba,</p><h2 style="margin:0;" id="display-name">Yaratƒ±cƒ±</h2></div>
            <div style="background:#FFF3E0; color:orange; padding:5px 12px; border-radius:20px; font-weight:bold;" onclick="nav('s-rewards')"><i class="fa-solid fa-fire"></i> 1 G√ºn</div>
        </div>
        <div class="scroll-content">
            <div style="margin-bottom:20px; padding:15px; background:white; border-radius:20px; border:1px solid #f0f0f0; cursor:pointer;" onclick="nav('s-rewards')">
                <div style="display:flex; justify-content:space-between; font-size:0.9rem; color:#555; margin-bottom:5px;">
                    <b>Seviye <span id="lvl-num">1</span></b> <span id="xp-text">0/100 XP</span>
                </div>
                <div style="width:100%; background:#eee; height:10px; border-radius:5px; overflow:hidden;">
                    <div id="xp-bar" style="height:100%; background:var(--theme-color); width:0%; transition:width 0.5s;"></div>
                </div>
            </div>

            <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:20px;">
                <div class="card" style="flex-direction:column; background:#FFF5E6; border:none;" onclick="nav('s-challenges')">
                    <div style="font-size:2.5rem;">üéØ</div>
                    <b>G√ºnl√ºk G√∂rev</b>
                    <small style="color:#d68c6d;">√ái√ßek Yap</small>
                </div>
                <div class="card" style="flex-direction:column; background:#E8F5E9; border:none;" onclick="nav('s-build')">
                    <div style="font-size:2.5rem;">üìö</div>
                    <b>Ders √áalƒ±≈ü</b>
                    <small style="color:#2e5c4d;">Matematik</small>
                </div>
            </div>

            <h3 style="margin-bottom:10px;">Son Aktiviteler</h3>
            <div style="display:flex; gap:10px; overflow-x:auto; padding-bottom:10px;">
                <div class="card" style="min-width:100px; flex-direction:column; padding:10px;" onclick="setupGuide('flower')">üå∏<small>√ái√ßek</small></div>
                <div class="card" style="min-width:100px; flex-direction:column; padding:10px;" onclick="setupGuide('castle')">üè∞<small>Kale</small></div>
                <div class="card" style="min-width:100px; flex-direction:column; padding:10px;" onclick="nav('s-rewards')">üèÜ<small>√ñd√ºller</small></div>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item active" onclick="nav('s-home')"><i class="fa-solid fa-house"></i><span>Ana Sayfa</span></div>
            <div class="nav-item" onclick="nav('s-challenges')"><i class="fa-solid fa-bullseye"></i><span>G√∂revler</span></div>
            <div class="nav-item" onclick="nav('s-build')"><i class="fa-solid fa-graduation-cap"></i><span>√ñƒüren</span></div>
            <div class="nav-item" onclick="nav('s-rewards')"><i class="fa-solid fa-trophy"></i><span>Profil</span></div>
        </div>
    </div>

    <!-- 4. CHALLENGES -->
    <div id="s-challenges" class="screen">
        <div class="header"><h3>Meydan Okumalar</h3></div>
        <div class="scroll-content">
            <div class="card" onclick="setupGuide('flower')"><div class="icon-box" style="background:var(--mint);">üå∏</div><div style="flex:1;"><h3>√ái√ßek Yap</h3><p>10 dk ‚Ä¢ Kolay</p></div><i class="fa-solid fa-play" style="color:var(--dark-mint);"></i></div>
            <div class="card" onclick="setupGuide('castle')"><div class="icon-box" style="background:var(--peach);">üè∞</div><div style="flex:1;"><h3>Kale Yap</h3><p>15 dk ‚Ä¢ Orta</p></div><i class="fa-solid fa-play" style="color:var(--dark-peach);"></i></div>
            <div class="card" onclick="setupGuide('animal')"><div class="icon-box" style="background:var(--purple);">ü¶Å</div><div style="flex:1;"><h3>Hayvan Yap</h3><p>12 dk ‚Ä¢ Kolay</p></div><i class="fa-solid fa-play" style="color:var(--dark-purple);"></i></div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item" onclick="nav('s-home')"><i class="fa-solid fa-house"></i><span>Ana Sayfa</span></div>
            <div class="nav-item active" onclick="nav('s-challenges')"><i class="fa-solid fa-bullseye"></i><span>G√∂revler</span></div>
            <div class="nav-item" onclick="nav('s-build')"><i class="fa-solid fa-graduation-cap"></i><span>√ñƒüren</span></div>
            <div class="nav-item" onclick="nav('s-rewards')"><i class="fa-solid fa-trophy"></i><span>Profil</span></div>
        </div>
    </div>

    <!-- 5. BUILD GUIDE (ADIM ADIM + FOTOƒûRAF) -->
    <div id="s-guide-intro" class="screen">
        <div class="header"><i class="fa-solid fa-arrow-left" onclick="nav('s-challenges')"></i><h3>Rehber</h3><div></div></div>
        <div class="scroll-content" style="text-align:center; display:flex; flex-direction:column; justify-content:center; height:100%;">
            <div style="font-size:5rem; margin-bottom:20px;" id="intro-icon">üå∏</div>
            <h1 id="intro-title">√ái√ßek Yapƒ±mƒ±</h1>
            <p id="intro-desc">Gerekli malzemeler: Renkli hamurlar.</p>
            <button class="btn-primary" onclick="startActualGuide()" style="margin-top:30px;">Ba≈üla</button>
        </div>
    </div>

    <div id="s-guide-steps" class="screen">
        <div class="header"><i class="fa-solid fa-xmark" onclick="nav('s-challenges')"></i><h3 id="step-header">Adƒ±m 1/4</h3><div></div></div>
        <div class="scroll-content" style="text-align:center;">
            <div class="progress-bar"><div class="progress-fill" id="p-fill"></div></div>
            <div class="step-image-box">
                <div class="guide-overlay-hint">√ñrnek G√∂r√ºn√ºm</div>
                <img id="step-img-example" class="placeholder" src="">
                <img id="step-uploaded-img" style="z-index: 2; position: absolute; top:0; left:0;"> 
            </div>
            <h2 id="step-title-text">Ba≈ülƒ±k</h2>
            <p id="step-desc-text">A√ßƒ±klama</p>
            <div class="step-upload-btn" onclick="document.getElementById('step-file').click()">
                <i class="fa-solid fa-camera"></i> Fotoƒürafƒ±nƒ± Y√ºkle
            </div>
            <input type="file" id="step-file" style="display:none;" accept="image/*" onchange="handleStepUpload(this)">
            <div style="margin-top:20px; display:flex; gap:10px;">
                <button class="btn-secondary" style="flex:1;" onclick="prevGuideStep()">Geri</button>
                <button class="btn-primary" style="flex:2;" onclick="nextGuideStep()" id="btn-guide-next">ƒ∞leri</button>
            </div>
        </div>
    </div>

    <div id="s-guide-summary" class="screen">
        <div class="scroll-content" style="text-align:center; padding-top:30px;">
            <div style="width:80px; height:80px; background:var(--mint); border-radius:50%; margin:0 auto; display:flex; align-items:center; justify-content:center; font-size:2.5rem; color:white;"><i class="fa-solid fa-check"></i></div>
            <h1 style="margin-top:15px;">Harika ƒ∞≈ü!</h1>
            <p>ƒ∞≈üte senin yaratƒ±cƒ± s√ºrecin:</p>
            <div id="summary-grid" class="summary-grid"></div>
            <button class="btn-primary" onclick="nav('s-rewards'); addXP(50); launchConfetti();" style="margin-top:20px;">√ñd√ºl√ºn√º Al (+50 XP)</button>
        </div>
    </div>

    <!-- 6. BUILD & LEARN (DERSLER) -->
    <div id="s-build" class="screen">
        <div class="header"><h3>ƒ∞n≈üa Et & √ñƒüren</h3></div>
        <div class="scroll-content">
            <!-- Buddy -->
            <div class="card" style="flex-direction:column; text-align:center; padding:20px; background:#F3E5F5;" onclick="document.getElementById('buddy-upload').click()">
                <img id="menu-buddy" src="logo.png" style="width:80px; height:80px; border-radius:50%; object-fit:cover; border:3px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                <h3 style="font-size:1rem; margin:10px 0 5px 0;">√áalƒ±≈üma Arkada≈üƒ±n</h3>
                <p style="font-size:0.8rem; margin:0;">Deƒüi≈ütirmek i√ßin tƒ±kla</p>
                <input type="file" id="buddy-upload" style="display:none;" accept="image/*" onchange="uploadBuddy(this)">
            </div>

            <h3 style="margin:20px 0 15px 0;">Dersler</h3>
            <div class="lesson-grid">
                <div class="lesson-card" onclick="startLesson('math')">
                    <i class="fa-solid fa-calculator lesson-icon-lg" style="color:var(--purple);"></i><b>Matematik</b>
                </div>
                <div class="lesson-card" onclick="startLesson('colors')">
                    <i class="fa-solid fa-palette lesson-icon-lg" style="color:var(--peach);"></i><b>Renkler</b>
                </div>
                <div class="lesson-card" onclick="startLesson('shapes')">
                    <i class="fa-solid fa-shapes lesson-icon-lg" style="color:var(--mint);"></i><b>≈ûekiller</b>
                </div>
                <div class="lesson-card" onclick="startLesson('space')">
                    <i class="fa-solid fa-rocket lesson-icon-lg" style="color:#4FC3F7;"></i><b>Uzay</b>
                </div>
                <div class="lesson-card" onclick="startLesson('music')">
                    <i class="fa-solid fa-music lesson-icon-lg" style="color:#FF6B6B;"></i><b>M√ºzik</b>
                </div>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item" onclick="nav('s-home')"><i class="fa-solid fa-house"></i><span>Ana Sayfa</span></div>
            <div class="nav-item" onclick="nav('s-challenges')"><i class="fa-solid fa-bullseye"></i><span>G√∂revler</span></div>
            <div class="nav-item active" onclick="nav('s-build')"><i class="fa-solid fa-graduation-cap"></i><span>√ñƒüren</span></div>
            <div class="nav-item" onclick="nav('s-rewards')"><i class="fa-solid fa-trophy"></i><span>Profil</span></div>
        </div>
    </div>

    <!-- 7. REWARDS & PROFILE (Bƒ∞RLE≈ûƒ∞K) -->
    <div id="s-rewards" class="screen">
        <div class="header"><h3>Profilim</h3><i class="fa-solid fa-gear" style="color:#888;"></i></div>
        <div class="scroll-content">
            <div class="points-banner">
                <img id="profile-avatar-display" src="https://picsum.photos/seed/avatar/100/100" style="width:80px; height:80px; border-radius:50%; border:3px solid white; margin-bottom:10px;">
                <h2 style="margin:0; color:white;" id="profile-name-display">Yaratƒ±cƒ±</h2>
                <p style="color:rgba(255,255,255,0.9);">Seviye <span id="p-lvl">1</span> ‚Ä¢ <span id="p-xp">0</span> XP</p>
            </div>

            <h3 style="margin-top:20px;">Rozetlerim</h3>
            <div class="badge-grid">
                <div class="badge-item unlocked" onclick="openBadgeModal('ƒ∞lk Adƒ±m', 'ƒ∞lk g√∂revini tamamladƒ±n!', 'ü•á', 'Kazanƒ±ldƒ±')">
                    <span class="badge-icon">ü•á</span><small>ƒ∞lk Adƒ±m</small>
                </div>
                <div class="badge-item" id="badge-streak" onclick="openBadgeModal('Seri √úretim', '3 g√ºn √ºst √ºste giri≈ü yap.', 'üî•', 'Kilitli')">
                    <span class="badge-icon">üî•</span><small>Seri</small>
                </div>
                <div class="badge-item" id="badge-artist" onclick="openBadgeModal('Sanat√ßƒ±', '5 farklƒ± heykel yap.', 'üé®', 'Kilitli')">
                    <span class="badge-icon">üé®</span><small>Sanat√ßƒ±</small>
                </div>
            </div>

            <h3 style="margin-top:20px;">Liderlik Tablosu</h3>
            <div class="card" style="flex-direction:column; align-items:stretch; gap:0; padding:0;">
                <div class="lb-item" onclick="openFriendModal('Ay≈üe', 'Seviye 5', 'https://picsum.photos/seed/u1/100/100')">
                    <div class="lb-rank" style="color:gold;">1</div>
                    <img src="https://picsum.photos/seed/u1/100/100" class="lb-avatar">
                    <div class="lb-info"><span class="lb-name">Ay≈üe</span></div>
                    <div class="lb-score">1500</div>
                </div>
                <div class="lb-item" onclick="openFriendModal('Mehmet', 'Seviye 4', 'https://picsum.photos/seed/u2/100/100')">
                    <div class="lb-rank" style="color:silver;">2</div>
                    <img src="https://picsum.photos/seed/u2/100/100" class="lb-avatar">
                    <div class="lb-info"><span class="lb-name">Mehmet</span></div>
                    <div class="lb-score">1200</div>
                </div>
                <div class="lb-item" style="background:#f0f0f0;">
                    <div class="lb-rank">3</div>
                    <img id="lb-my-avatar" src="https://picsum.photos/seed/avatar/100/100" class="lb-avatar">
                    <div class="lb-info"><span class="lb-name">Sen</span></div>
                    <div class="lb-score" id="lb-score">0</div>
                </div>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item" onclick="nav('s-home')"><i class="fa-solid fa-house"></i><span>Ana Sayfa</span></div>
            <div class="nav-item" onclick="nav('s-challenges')"><i class="fa-solid fa-bullseye"></i><span>G√∂revler</span></div>
            <div class="nav-item" onclick="nav('s-build')"><i class="fa-solid fa-graduation-cap"></i><span>√ñƒüren</span></div>
            <div class="nav-item active" onclick="nav('s-rewards')"><i class="fa-solid fa-trophy"></i><span>Profil</span></div>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
    /* --- STATE --- */
    let xp = 0;
    let level = 1;
    let guideStepIndex = 0;
    let activeGuideKey = null;
    let guidePhotos = [];

    const guides = {
        flower: { t: "√ái√ßek Yapƒ±mƒ±", icon: "üå∏", steps: [{t:"Merkez", d:"Turuncu top yap"}, {t:"Yapraklar", d:"Pembe toplar yap"}, {t:"Birle≈ütir", d:"Yapraklarƒ± ekle"}, {t:"Sap", d:"Ye≈üil sap yap"}] },
        castle: { t: "Kale Yapƒ±mƒ±", icon: "üè∞", steps: [{t:"Taban", d:"Kare taban yap"}, {t:"Kuleler", d:"4 kule ekle"}, {t:"Duvarlar", d:"Duvarlarƒ± √ßek"}, {t:"Bayrak", d:"Bayraƒüƒ± dik"}] },
        animal: { t: "Hayvan Yap", icon: "ü¶Å", steps: [{t:"G√∂vde", d:"Oval g√∂vde"}, {t:"Kafa", d:"Kafayƒ± ekle"}, {t:"Bacaklar", d:"4 bacak ekle"}] }
    };

    /* --- INIT --- */
    // Test i√ßin splash'tan ba≈üla
    setTimeout(() => nav('s-on1'), 1500);

    /* --- NAV --- */
    function nav(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        // Bottom Nav Update
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        if(id.includes('home')) document.querySelectorAll('.nav-item')[0].classList.add('active');
        if(id.includes('challenges')) document.querySelectorAll('.nav-item')[1].classList.add('active');
        if(id.includes('build')) document.querySelectorAll('.nav-item')[2].classList.add('active');
        if(id.includes('rewards')) document.querySelectorAll('.nav-item')[3].classList.add('active');
    }

    function showToast(msg, type='neutral') {
        const box = document.getElementById('toast-container');
        const t = document.createElement('div');
        t.className = `toast ${type}`;
        t.innerHTML = type==='success' ? `<i class="fa-solid fa-check"></i> ${msg}` : msg;
        box.appendChild(t);
        setTimeout(()=>t.classList.add('show'),10);
        setTimeout(()=>{ t.classList.remove('show'); setTimeout(()=>t.remove(),300); }, 2500);
    }

    /* --- PROFIL --- */
    function pickColor(el, color) {
        document.querySelectorAll('.color-opt').forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        document.documentElement.style.setProperty('--theme-color', color);
    }
    function pickAvatar(el) {
        document.querySelectorAll('.avatar-opt').forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        document.getElementById('profile-avatar-display').src = el.src;
        document.getElementById('lb-my-avatar').src = el.src;
    }
    function saveProfile() {
        const n = document.getElementById('inp-name').value;
        if(n) {
            document.getElementById('display-name').innerText = n;
            document.getElementById('profile-name-display').innerText = n;
        }
        showToast('Profil Hazƒ±r!', 'success');
        nav('s-home');
    }

    /* --- BUILD GUIDE --- */
    function setupGuide(key) {
        activeGuideKey = key;
        nav('s-guide-intro');
        const g = guides[key];
        document.getElementById('intro-title').innerText = g.t;
        document.getElementById('intro-icon').innerText = g.icon;
    }

    function startActualGuide() {
        guideStepIndex = 0;
        guidePhotos = new Array(guides[activeGuideKey].steps.length).fill(null);
        renderGuideStep();
        nav('s-guide-steps');
    }

    function renderGuideStep() {
        const step = guides[activeGuideKey].steps[guideStepIndex];
        document.getElementById('step-header').innerText = `Adƒ±m ${guideStepIndex+1}`;
        document.getElementById('step-title-text').innerText = step.t;
        document.getElementById('step-desc-text').innerText = step.d;
        
        const img = document.getElementById('step-uploaded-img');
        const placeholder = document.getElementById('step-img-example');
        // Picsum'dan rastgele √∂rnek foto
        placeholder.src = `https://picsum.photos/seed/${activeGuideKey}${guideStepIndex}/400/400`;

        if(guidePhotos[guideStepIndex]) {
            img.src = guidePhotos[guideStepIndex]; img.style.display='block';
        } else {
            img.style.display='none';
        }
        
        const pct = ((guideStepIndex + 1) / guides[activeGuideKey].steps.length) * 100;
        document.getElementById('p-fill').style.width = `${pct}%`;
    }

    function handleStepUpload(input) {
        if(input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = e => {
                guidePhotos[guideStepIndex] = e.target.result;
                renderGuideStep();
                showToast('Fotoƒüraf Kaydedildi', 'success');
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function nextGuideStep() {
        if(!guidePhotos[guideStepIndex]) { showToast('L√ºtfen fotoƒüraf y√ºkle!', 'error'); return; }
        if(guideStepIndex < guides[activeGuideKey].steps.length - 1) {
            guideStepIndex++; renderGuideStep();
        } else {
            finishGuide();
        }
    }

    function prevGuideStep() { if(guideStepIndex>0) { guideStepIndex--; renderGuideStep(); } else { nav('s-guide-intro'); } }

    function finishGuide() {
        const grid = document.getElementById('summary-grid');
        grid.innerHTML = "";
        guidePhotos.forEach((p, i) => {
            grid.innerHTML += `<div class="summary-card"><img src="${p}" class="summary-thumb"><div><b>Adƒ±m ${i+1}</b><br><small style="color:green">Tamamlandƒ±</small></div></div>`;
        });
        nav('s-guide-summary');
        addXP(50);
        launchConfetti();
    }

    /* --- SYSTEM --- */
    function uploadBuddy(input) {
        if(input.files && input.files[0]) {
            const r = new FileReader();
            r.onload = e => {
                document.getElementById('menu-buddy').src = e.target.result;
                showToast('Arkada≈üƒ±n Y√ºklendi!', 'success');
            };
            r.readAsDataURL(input.files[0]);
        }
    }

    function startLesson(type) {
        showToast(type.toUpperCase() + ' Dersi Ba≈ülƒ±yor...', 'success');
        // Burada ders ekranƒ±na y√∂nlendirme veya quiz mantƒ±ƒüƒ± eklenebilir.
        // Basitlik i√ßin ≈üimdilik sadece toast mesajƒ± g√∂steriyoruz.
    }

    function addXP(n) {
        xp += n;
        document.getElementById('xp-text').innerText = `${xp}/100 XP`;
        document.getElementById('xp-bar').style.width = `${Math.min(xp, 100)}%`;
        document.getElementById('p-xp').innerText = xp;
        document.getElementById('lb-score').innerText = xp;
        if(xp >= 100) {
            level++;
            xp = 0;
            document.getElementById('lvl-num').innerText = level;
            document.getElementById('p-lvl').innerText = level;
            showToast('Seviye Atladƒ±n!', 'success');
        }
    }

    function launchConfetti() { confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } }); }

    /* --- MODALS --- */
    function openBadgeModal(title, desc, icon, status) {
        document.getElementById('m-badge-title').innerText = title;
        document.getElementById('m-badge-desc').innerText = desc;
        document.getElementById('m-badge-icon').innerText = icon;
        document.getElementById('m-badge-status').innerText = status;
        document.getElementById('badge-modal').style.display = 'flex';
    }

    function openFriendModal(name, level, img) {
        document.getElementById('m-friend-name').innerText = name;
        document.getElementById('m-friend-level').innerText = level;
        document.getElementById('m-friend-img').src = img;
        document.getElementById('friend-modal').style.display = 'flex';
    }

    function closeModal(id) { document.getElementById(id).style.display = 'none'; }

</script>

</body>
</html>
