<!-- 
    ============================================================================
    PROJE: SQUISHABLES LEARNING APP (ULTIMATE EDITION)
    DURUM: FINAL RELEASE CANDIDATE
    
    DOSYA GEREKSƒ∞Nƒ∞MLERƒ∞ (Aynƒ± klas√∂rde olmalƒ±):
    -------------------------------------------------------
    [Ana G√∂rseller]
    1. Product1.jpg (Kutu g√∂rseli)
    2. logo.png (App ikonu)
    
    [Avatarlar]
    3. avatar1.png, avatar2.png, avatar3.png
    
    [Rehber - √ái√ßek]
    4. cicek_adim1.jpg, cicek_adim2.jpg, cicek_adim3.jpg, cicek_adim4.jpg, cicek_adim5.jpg
    
    [Rehber - Kale]
    5. kale_adim1.jpg, kale_adim2.jpg
    
    [Rehber - Hayvan]
    6. hayvan_adim1.jpg
    ============================================================================
-->

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Squishables - Aile Baƒülarƒ± ve Eƒüitim Kiti</title>
    
    <!-- PWA Manifest & Meta -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#C4DFD9">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="logo.png">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* =================================================================
           B√ñL√úM 1: CSS DEƒûƒ∞≈ûKENLERƒ∞ VE RESET
           =================================================================
        */
        :root {
            /* Renk Paleti */
            --primary: #C4DFD9;      /* Mint */
            --primary-dark: #2e5c4d;
            --secondary: #FFD1BA;    /* Peach */
            --secondary-dark: #d68c6d;
            --accent: #DCD6F7;       /* Purple */
            --accent-dark: #424874;
            --bg-body: #f4f7f6;
            --white: #ffffff;
            --text-main: #2D3436;
            --text-muted: #636E72;
            --success: #00b894;
            --warning: #fdcb6e;
            --danger: #ff7675;
            --gold: #FFD700;
            
            /* G√∂lgeler */
            --shadow-sm: 0 2px 5px rgba(0,0,0,0.05);
            --shadow-md: 0 5px 15px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 30px rgba(0,0,0,0.15);
            --shadow-float: 0 15px 35px rgba(0,0,0,0.2);

            /* Ge√ßi≈üler */
            --trans-fast: 0.2s ease;
            --trans-med: 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        body { 
            margin: 0; padding: 0; 
            font-family: 'Nunito', sans-serif; 
            background-color: var(--bg-body); 
            display: flex; justify-content: center; align-items: center; 
            height: 100vh; overflow: hidden;
            color: var(--text-main);
        }

        /* Scrollbar Gizleme */
        ::-webkit-scrollbar { width: 0px; background: transparent; }

        /* =================================================================
           B√ñL√úM 2: APP ƒ∞SKELETƒ∞ (√áER√áEVE)
           =================================================================
        */
        #app-frame {
            width: 100%; max-width: 414px; height: 100%; max-height: 896px;
            background-color: var(--white);
            position: relative; overflow: hidden;
            display: flex; flex-direction: column;
        }

        /* Masa√ºst√ºnde telefon √ßer√ßevesi gibi g√∂r√ºnmesi i√ßin */
        @media (min-width: 450px) {
            #app-frame {
                height: 85vh; border-radius: 40px;
                border: 12px solid #2d3436;
                box-shadow: var(--shadow-float);
            }
            .notch {
                position: absolute; top: 0; left: 50%; transform: translateX(-50%);
                width: 150px; height: 30px; background: #2d3436;
                border-radius: 0 0 20px 20px; z-index: 9999;
            }
        }

        /* =================================================================
           B√ñL√úM 3: ORTAK UI Bƒ∞LE≈ûENLERƒ∞
           =================================================================
        */
        h1, h2, h3, h4 { font-family: 'Fredoka', sans-serif; margin: 0; padding: 0; letter-spacing: 0.5px; }
        p { color: var(--text-muted); font-size: 0.95rem; line-height: 1.6; margin: 10px 0; }

        /* Butonlar */
        .btn {
            border: none; padding: 16px; width: 100%; border-radius: 20px;
            font-size: 1.1rem; font-weight: 700; cursor: pointer;
            transition: var(--trans-fast); position: relative; overflow: hidden;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn:active { transform: scale(0.97); }
        
        .btn-primary { background: var(--primary); color: #333; box-shadow: var(--shadow-md); }
        .btn-secondary { background: #f1f2f6; color: var(--text-muted); }
        .btn-success { background: var(--success); color: white; box-shadow: 0 5px 15px rgba(0,184,148,0.3); }
        .btn-purple { background: var(--accent); color: var(--accent-dark); }
        .btn-peach { background: var(--secondary); color: var(--secondary-dark); }

        .btn-floating {
            position: absolute; bottom: 20px; right: 20px;
            width: 60px; height: 60px; border-radius: 50%;
            background: var(--text-main); color: white;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; box-shadow: var(--shadow-lg); z-index: 500;
        }

        /* Kartlar */
        .card {
            background: white; border-radius: 24px; padding: 20px;
            margin-bottom: 15px; border: 1px solid #f0f0f0;
            box-shadow: var(--shadow-sm); transition: var(--trans-fast);
            position: relative; overflow: hidden;
        }
        .card:active { transform: scale(0.98); background: #fafafa; border-color: #eee; }
        .card-row { display: flex; align-items: center; gap: 15px; }
        
        /* ƒ∞kon Kutularƒ± */
        .icon-box {
            width: 55px; height: 55px; border-radius: 18px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.6rem; color: white; flex-shrink: 0;
            box-shadow: inset 0 0 0 2px rgba(255,255,255,0.2);
        }

        /* Header */
        .app-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 25px; background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px); z-index: 100;
            border-bottom: 1px solid rgba(0,0,0,0.03);
            position: sticky; top: 0;
        }
        .back-btn { font-size: 1.2rem; padding: 10px; cursor: pointer; color: var(--text-main); transition: 0.2s; }
        .back-btn:hover { background: #f0f0f0; border-radius: 50%; }

        /* =================================================================
           B√ñL√úM 4: Bƒ∞LDƒ∞Rƒ∞M & MODAL Sƒ∞STEMƒ∞
           =================================================================
        */
        #toast-container {
            position: absolute; top: 60px; left: 50%; transform: translateX(-50%);
            z-index: 5000; width: 90%; pointer-events: none;
            display: flex; flex-direction: column; gap: 10px;
        }
        .toast {
            background: rgba(45, 52, 54, 0.95); color: white;
            padding: 14px 20px; border-radius: 30px; text-align: center;
            opacity: 0; transform: translateY(-20px); transition: var(--trans-med);
            font-size: 0.95rem; font-weight: 600;
            box-shadow: var(--shadow-lg); display: flex; align-items: center;
            justify-content: center; gap: 12px; backdrop-filter: blur(5px);
        }
        .toast.show { opacity: 1; transform: translateY(0); }
        .toast.success { background: var(--primary-dark); }
        .toast.error { background: var(--danger); }
        .toast.levelup { background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); color: #333; }

        .modal-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 4000; display: none;
            align-items: center; justify-content: center;
            animation: fadeIn 0.3s; backdrop-filter: blur(4px);
        }
        .modal-box {
            background: white; width: 85%; max-height: 80%; overflow-y: auto;
            padding: 30px; border-radius: 30px; text-align: center;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative; box-shadow: var(--shadow-float);
        }
        .close-modal {
            position: absolute; top: 20px; right: 20px; font-size: 1.5rem;
            cursor: pointer; color: #ccc; transition: 0.2s;
            width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;
            background: #f9f9f9; border-radius: 50%;
        }
        .close-modal:hover { background: #eee; color: #333; }

        /* =================================================================
           B√ñL√úM 5: EKRAN Y√ñNETƒ∞Mƒ∞ & SCROLL
           =================================================================
        */
        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-body); display: none; flex-direction: column;
            animation: fadeIn 0.4s ease; z-index: 10;
        }
        .screen.active { display: flex; }
        
        .scroll-content { 
            flex: 1; overflow-y: auto; padding: 25px; padding-bottom: 120px; 
            -webkit-overflow-scrolling: touch;
        }

        /* =================================================================
           B√ñL√úM 6: SAYFAYA √ñZEL STƒ∞LLER
           =================================================================
        */

        /* PRODUCT HERO (ANA Vƒ∞TRƒ∞N) */
        .product-hero {
            width: 100%; height: 260px; border-radius: 30px;
            overflow: hidden; margin-bottom: 25px; position: relative;
            background: white; border: 1px solid rgba(0,0,0,0.05);
            box-shadow: var(--shadow-md);
        }
        .product-hero img { width: 100%; height: 100%; object-fit: contain; padding: 10px; }
        .product-badge {
            position: absolute; top: 15px; right: 15px;
            background: var(--gold); color: #333; padding: 5px 12px;
            border-radius: 12px; font-size: 0.8rem; font-weight: 800;
            box-shadow: var(--shadow-sm); animation: pulse 2s infinite;
        }
        .product-tag {
            position: absolute; bottom: 15px; left: 15px;
            background: rgba(255,255,255,0.9); padding: 8px 16px;
            border-radius: 20px; font-size: 0.85rem; font-weight: 700;
            color: var(--text-main); backdrop-filter: blur(5px);
            box-shadow: var(--shadow-sm);
        }

        /* PROFIL SE√áƒ∞Mƒ∞ */
        .avatar-grid { display: flex; gap: 15px; justify-content: center; margin: 30px 0; }
        .avatar-opt {
            width: 80px; height: 80px; border-radius: 50%;
            border: 4px solid white; cursor: pointer; object-fit: cover;
            transition: var(--trans-med); background: #eee;
            box-shadow: var(--shadow-sm);
        }
        .avatar-opt.selected {
            border-color: var(--text-main); transform: scale(1.15);
            box-shadow: var(--shadow-md);
        }
        .custom-input {
            width: 100%; padding: 18px; background: white;
            border: 2px solid #eee; border-radius: 20px;
            margin-bottom: 20px; font-family: 'Nunito'; font-size: 1rem;
            transition: 0.2s; outline: none;
        }
        .custom-input:focus { border-color: var(--primary); background: #fff; }

        /* BUILD GUIDE (ADIM ADIM) */
        .step-container { text-align: center; }
        .step-progress { 
            display: flex; justify-content: space-between; margin-bottom: 20px; 
            padding: 0 10px; position: relative;
        }
        .step-dot {
            width: 12px; height: 12px; background: #ddd; border-radius: 50%;
            z-index: 2; transition: 0.3s;
        }
        .step-dot.active { background: var(--text-main); transform: scale(1.2); }
        .step-line {
            position: absolute; top: 5px; left: 15px; right: 15px; height: 2px;
            background: #eee; z-index: 1;
        }
        
        /* √áift G√∂rsel Alanƒ± */
        .dual-image-container {
            display: flex; flex-direction: column; gap: 15px; margin-bottom: 25px;
        }
        .step-image-box {
            width: 100%; height: 200px; background: white; border-radius: 24px;
            display: flex; align-items: center; justify-content: center;
            border: 2px solid #f0f0f0; overflow: hidden; position: relative;
            transition: var(--trans-fast);
        }
        .step-image-box img { width: 100%; height: 100%; object-fit: cover; }
        .guide-label {
            position: absolute; top: 12px; left: 12px;
            background: rgba(0,0,0,0.7); color: white;
            padding: 6px 14px; border-radius: 12px; font-size: 0.75rem;
            font-weight: bold; z-index: 2; pointer-events: none;
        }
        .guide-label.user { background: var(--primary-dark); }

        .upload-placeholder {
            display: flex; flex-direction: column; align-items: center; gap: 10px;
            color: #aaa;
        }

        /* REWARDS & PROFILE HEADER */
        .profile-card {
            background: white; border-radius: 30px; padding: 30px;
            text-align: center; margin-bottom: 25px;
            box-shadow: var(--shadow-sm); position: relative;
            overflow: hidden;
        }
        .profile-card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 80px;
            background: var(--primary); opacity: 0.3; z-index: 0;
        }
        .profile-avatar-lg {
            width: 100px; height: 100px; border-radius: 50%;
            border: 5px solid white; margin-top: 10px; margin-bottom: 10px;
            position: relative; z-index: 1; object-fit: cover;
            box-shadow: var(--shadow-md);
        }
        
        .stat-row { display: flex; justify-content: center; gap: 15px; margin-top: 20px; }
        .stat-box {
            background: #f9f9f9; padding: 10px 20px; border-radius: 15px;
            min-width: 90px;
        }
        .stat-val { font-size: 1.2rem; font-weight: 800; color: var(--text-main); display: block; }
        .stat-lbl { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }

        /* LEVEL & LESSON GRID */
        .lesson-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .lesson-card {
            background: white; border-radius: 24px; padding: 20px;
            text-align: center; cursor: pointer; transition: var(--trans-fast);
            border: 2px solid transparent; box-shadow: var(--shadow-sm);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 140px; gap: 12px;
        }
        .lesson-card:hover { border-color: var(--primary); transform: translateY(-5px); box-shadow: var(--shadow-md); }
        .lesson-card i { font-size: 2.2rem; margin-bottom: 5px; }
        
        .level-map {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;
            padding: 20px 0;
        }
        .level-node {
            aspect-ratio: 1; border-radius: 20px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-weight: 800; font-size: 1.2rem;
            cursor: pointer; position: relative; transition: 0.2s;
            background: #e0e0e0; color: #999; border: 2px solid transparent;
        }
        .level-node.unlocked { background: white; color: var(--text-main); border-color: #eee; box-shadow: var(--shadow-sm); }
        .level-node.completed { background: var(--primary); color: #333; border-color: var(--primary-dark); }
        .level-node:active { transform: scale(0.9); }
        .level-stars { display: flex; gap: 2px; font-size: 0.6rem; color: var(--gold); margin-top: 5px; }

        /* BOTTOM NAV */
        .bottom-nav {
            position: absolute; bottom: 0; width: 100%; height: 90px;
            background: white; display: flex; justify-content: space-around;
            align-items: center; padding-bottom: 20px; z-index: 200;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.03); border-radius: 30px 30px 0 0;
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; gap: 6px;
            color: #b2bec3; font-size: 0.7rem; cursor: pointer; width: 25%;
            transition: 0.3s; position: relative;
        }
        .nav-item i { font-size: 1.5rem; transition: 0.3s; }
        .nav-item.active { color: var(--text-main); font-weight: 700; }
        .nav-item.active i { transform: translateY(-3px); color: var(--primary-dark); }
        .nav-item.active::after {
            content: ''; position: absolute; bottom: -10px; width: 6px; height: 6px;
            background: var(--primary-dark); border-radius: 50%;
        }

        /* ANIMATIONS */
        @keyframes popIn { 0% {transform: scale(0.9); opacity: 0;} 100% {transform: scale(1); opacity: 1;} }
        @keyframes fadeIn { 0% {opacity: 0;} 100% {opacity: 1;} }
        @keyframes pulse { 0% {transform: scale(1);} 50% {transform: scale(1.05);} 100% {transform: scale(1);} }
        @keyframes float { 0% {transform: translateY(0px);} 50% {transform: translateY(-10px);} 100% {transform: translateY(0px);} }
        @keyframes slideUp { 0% {transform: translateY(20px); opacity: 0;} 100% {transform: translateY(0); opacity: 1;} }

        /* QUIZ EKRANI √ñZEL */
        .quiz-timer { width: 100%; height: 6px; background: #eee; margin-bottom: 20px; border-radius: 3px; overflow: hidden; }
        .quiz-timer-fill { height: 100%; background: var(--warning); width: 100%; transition: width 1s linear; }
        .option-btn {
            background: white; border: 2px solid #f0f0f0; padding: 20px;
            border-radius: 18px; font-size: 1.3rem; font-weight: 700;
            color: var(--text-main); cursor: pointer; transition: 0.2s;
            display: flex; align-items: center; justify-content: center;
        }
        .option-btn:active { transform: scale(0.96); background: #f9f9f9; }
        .buddy-corner {
            position: absolute; bottom: 120px; left: 20px; display: flex; align-items: flex-end; z-index: 10;
            pointer-events: none;
        }
        .buddy-avatar-small {
            width: 70px; height: 70px; border-radius: 50%; border: 3px solid white;
            box-shadow: var(--shadow-md); background: white; object-fit: cover;
        }
        .buddy-bubble {
            background: white; padding: 10px 15px; border-radius: 15px 15px 15px 0;
            box-shadow: var(--shadow-md); font-size: 0.85rem; color: var(--text-main);
            max-width: 180px; margin-bottom: 15px; margin-left: 10px;
            animation: popIn 0.3s ease; transform-origin: bottom left;
        }

    </style>
</head>
<body>

<div id="app-frame">
    <div class="notch"></div>
    <div id="toast-container"></div>
    <canvas id="confetti-canvas" style="position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:1500;"></canvas>

    <!-- ================= MODALLER ================= -->

    <!-- 1. ROZET DETAY MODALI -->
    <div id="badge-modal" class="modal-overlay" onclick="closeModal('badge-modal')">
        <div class="modal-box" onclick="event.stopPropagation()">
            <div style="font-size:5rem; margin-bottom:15px; animation: float 3s infinite;" id="m-badge-icon">ü•á</div>
            <h2 id="m-badge-title" style="color:var(--text-main);">Rozet Ba≈ülƒ±ƒüƒ±</h2>
            <p id="m-badge-desc">Bu rozeti kazanmak i√ßin gerekli a√ßƒ±klama.</p>
            <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <span style="font-size:0.8rem; color:#888;">DURUM</span>
                <span id="m-badge-status" style="font-weight:bold; background:#eee; padding:5px 10px; border-radius:10px;">Kilitli</span>
            </div>
            <button class="btn-secondary" style="margin-top:20px;" onclick="closeModal('badge-modal')">Kapat</button>
        </div>
    </div>

    <!-- 2. ARKADA≈û PROFƒ∞L MODALI -->
    <div id="friend-modal" class="modal-overlay" onclick="closeModal('friend-modal')">
        <div class="modal-box" onclick="event.stopPropagation()">
            <i class="fa-solid fa-xmark close-modal" onclick="closeModal('friend-modal')"></i>
            <img id="m-friend-img" src="" style="width:100px; height:100px; border-radius:50%; margin-bottom:15px; border:4px solid var(--primary); object-fit:cover;">
            <h2 id="m-friend-name">ƒ∞sim</h2>
            <p id="m-friend-title" style="color:var(--primary-dark); font-weight:bold;">Usta Tasarƒ±mcƒ±</p>
            
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:20px;">
                <div style="background:#f4f7f6; padding:15px; border-radius:15px;">
                    <i class="fa-solid fa-trophy" style="color:gold; font-size:1.5rem; margin-bottom:5px;"></i><br>
                    <b>1500</b><br><small>XP Puan</small>
                </div>
                <div style="background:#f4f7f6; padding:15px; border-radius:15px;">
                    <i class="fa-solid fa-palette" style="color:var(--secondary-dark); font-size:1.5rem; margin-bottom:5px;"></i><br>
                    <b>Sanat</b><br><small>Favori Ders</small>
                </div>
            </div>
            <button class="btn-primary" style="margin-top:20px;" onclick="showToast('Arkada≈ülƒ±k isteƒüi g√∂nderildi!', 'success'); closeModal('friend-modal')">Arkada≈ü Ekle</button>
        </div>
    </div>

    <!-- 3. AYARLAR MODALI -->
    <div id="settings-modal" class="modal-overlay" onclick="closeModal('settings-modal')">
        <div class="modal-box" onclick="event.stopPropagation()">
            <h3>Ayarlar</h3>
            <div style="text-align:left; margin-top:20px;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                    <span>Ses Efektleri</span>
                    <i class="fa-solid fa-toggle-on" style="font-size:1.5rem; color:var(--success);"></i>
                </div>
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                    <span>M√ºzik</span>
                    <i class="fa-solid fa-toggle-off" style="font-size:1.5rem; color:#ccc;"></i>
                </div>
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                    <span>Bildirimler</span>
                    <i class="fa-solid fa-toggle-on" style="font-size:1.5rem; color:var(--success);"></i>
                </div>
            </div>
            <button class="btn-secondary" style="margin-top:10px; color:var(--danger);" onclick="resetProgress()">ƒ∞lerlemeyi Sƒ±fƒ±rla</button>
            <button class="btn-primary" style="margin-top:10px;" onclick="closeModal('settings-modal')">Kaydet</button>
        </div>
    </div>

    <!-- ================= EKRANLAR ================= -->

    <!-- EKRAN 1: SPLASH (A√ßƒ±lƒ±≈ü) -->
    <div id="s-splash" class="screen active" style="align-items:center; justify-content:center; background:var(--bg-body);">
        <img src="logo.png" alt="Logo" style="width:160px; animation:popIn 1s; border-radius:30px; box-shadow:var(--shadow-lg);">
        <h1 style="margin-top:25px; color:var(--text-main); font-size:2rem;">Squishables</h1>
        <p style="font-size:1rem;">Yaratƒ±cƒ±lƒ±ƒüƒ±n Dokunu≈üu</p>
        <div style="margin-top:40px;"><i class="fa-solid fa-spinner fa-spin" style="font-size:2rem; color:var(--primary-dark);"></i></div>
    </div>

    <!-- EKRAN 2: ONBOARDING -->
    <div id="s-onboarding" class="screen" style="padding:0;">
        <div class="product-hero" style="height:55%; border-radius:0 0 40px 40px; border:none; margin:0; background:white;">
            <img src="Product1.jpg" style="width:100%; height:100%; object-fit:contain; padding:40px;">
        </div>
        <div style="padding:40px 30px; text-align:center; flex:1; display:flex; flex-direction:column;">
            <h1 style="font-size:2rem; margin-bottom:10px;">Aile Baƒülarƒ± Kiti</h1>
            <p>Bu kutu ile ailecek hem √∂ƒürenin, hem eƒülenin, hem de harika anƒ±lar biriktirin.</p>
            <div style="display:flex; justify-content:center; gap:10px; margin:20px 0;">
                <div style="width:10px; height:10px; background:var(--text-main); border-radius:50%;"></div>
                <div style="width:10px; height:10px; background:#ddd; border-radius:50%;"></div>
                <div style="width:10px; height:10px; background:#ddd; border-radius:50%;"></div>
            </div>
            <button class="btn-primary" style="margin-top:auto;" onclick="nav('s-profile-setup')">Hadi Ba≈ülayalƒ±m!</button>
        </div>
    </div>

    <!-- EKRAN 3: PROFIL KURULUMU -->
    <div id="s-profile-setup" class="screen">
        <div class="header">
            <i class="fa-solid fa-chevron-left back-btn" onclick="nav('s-onboarding')"></i>
            <h3>Profilini Yarat</h3>
            <div style="width:30px;"></div>
        </div>
        <div class="scroll-content">
            <p style="text-align:center; font-weight:bold; margin-bottom:20px;">Seni en iyi yansƒ±tan Avatar hangisi?</p>
            <div class="avatar-grid">
                <img src="avatar1.png" class="avatar-opt selected" onclick="pickAvatar(this, 'avatar1.png')">
                <img src="avatar2.png" class="avatar-opt" onclick="pickAvatar(this, 'avatar2.png')">
                <img src="avatar3.png" class="avatar-opt" onclick="pickAvatar(this, 'avatar3.png')">
            </div>

            <div class="input-group">
                <label style="font-weight:bold; margin-bottom:5px; display:block;">ƒ∞smin Nedir?</label>
                <input type="text" id="inp-name" class="custom-input" placeholder="√ñrn: Deniz">
            </div>

            <div class="input-group">
                <label style="font-weight:bold; margin-bottom:5px; display:block;">Ya≈üƒ±n</label>
                <input type="number" class="custom-input" placeholder="5">
            </div>

            <p style="text-align:center; margin-top:20px; font-size:0.8rem;">Verilerin sadece cihazƒ±nda saklanƒ±r.</p>
        </div>
        <div style="padding:20px;">
            <button class="btn-primary" onclick="saveProfileAndStart()">Maceraya Atƒ±l üöÄ</button>
        </div>
    </div>

    <!-- EKRAN 4: ANA SAYFA (HOME) -->
    <div id="s-home" class="screen">
        <div class="header" style="padding-bottom:10px;">
            <div>
                <p style="margin:0; font-size:0.9rem;">Tekrar Merhaba,</p>
                <h2 style="margin:0; color:var(--primary-dark);" id="home-name-display">Arkada≈üƒ±m</h2>
            </div>
            <div style="display:flex; gap:10px;">
                <div style="background:#FFF3E0; color:#FF9800; padding:5px 12px; border-radius:20px; font-weight:bold; font-size:0.9rem; display:flex; align-items:center; gap:5px;">
                    <i class="fa-solid fa-fire"></i> 3
                </div>
                <i class="fa-solid fa-gear back-btn" onclick="document.getElementById('settings-modal').style.display='flex'"></i>
            </div>
        </div>
        
        <div class="scroll-content">
            <!-- XP Progress -->
            <div class="card" style="padding:15px; background:white; border-left: 5px solid var(--primary);" onclick="nav('s-rewards')">
                <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                    <b>Seviye <span id="home-lvl">1</span></b>
                    <span style="font-size:0.9rem; color:var(--text-muted);"><span id="home-xp">0</span> / 100 XP</span>
                </div>
                <div style="width:100%; height:8px; background:#f0f0f0; border-radius:4px; overflow:hidden;">
                    <div id="home-xp-bar" style="height:100%; width:0%; background:var(--primary); transition:width 0.5s;"></div>
                </div>
            </div>

            <!-- Quick Actions -->
            <h3 style="margin:20px 0 10px 0;">Bug√ºn Ne Yapalƒ±m?</h3>
            <div class="dash-grid">
                <div class="card" style="flex-direction:column; padding:25px; border-bottom:4px solid var(--secondary-dark);" onclick="nav('s-build-hub')">
                    <div style="background:var(--secondary); width:60px; height:60px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:2rem; margin-bottom:10px;">
                        üìö
                    </div>
                    <b>Ders √áalƒ±≈ü</b>
                    <small>Yeni ≈üeyler √∂ƒüren</small>
                </div>
                <div class="card" style="flex-direction:column; padding:25px; border-bottom:4px solid var(--primary-dark);" onclick="nav('s-challenges')">
                    <div style="background:var(--primary); width:60px; height:60px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:2rem; margin-bottom:10px;">
                        üé®
                    </div>
                    <b>Bir ≈ûey Yap</b>
                    <small>Kutunu kullan</small>
                </div>
            </div>

            <!-- New Product Promo (Vitrin) -->
            <h3 style="margin:25px 0 10px 0;">Kutunun ƒ∞√ßindekiler</h3>
            <div class="product-hero" style="height:180px;" onclick="nav('s-challenges')">
                <img src="Product1.jpg">
                <div class="product-tag">Ke≈üfet</div>
            </div>
        </div>

        <div class="bottom-nav">
            <div class="nav-item active" onclick="nav('s-home')"><i class="fa-solid fa-house"></i>Ev</div>
            <div class="nav-item" onclick="nav('s-challenges')"><i class="fa-solid fa-hammer"></i>Yap</div>
            <div class="nav-item" onclick="nav('s-build-hub')"><i class="fa-solid fa-book-open"></i>√ñƒüren</div>
            <div class="nav-item" onclick="nav('s-rewards')"><i class="fa-solid fa-user"></i>Ben</div>
        </div>
    </div>

    <!-- EKRAN 5: DERSLER HUB (BUILD HUB) -->
    <div id="s-build-hub" class="screen">
        <div class="header">
            <h3>Dersler</h3>
            <span style="font-size:0.9rem; color:var(--text-muted);">Toplam 6 Ders</span>
        </div>
        <div class="scroll-content">
            <div class="lesson-grid">
                <div class="lesson-card" onclick="openLevelMap('math')">
                    <i class="fa-solid fa-calculator" style="color:var(--purple);"></i>
                    <b>Matematik</b>
                    <small>10 Seviye</small>
                </div>
                <div class="lesson-card" onclick="openLevelMap('colors')">
                    <i class="fa-solid fa-palette" style="color:var(--secondary-dark);"></i>
                    <b>Renkler</b>
                    <small>10 Seviye</small>
                </div>
                <div class="lesson-card" onclick="openLevelMap('shapes')">
                    <i class="fa-solid fa-shapes" style="color:var(--primary-dark);"></i>
                    <b>≈ûekiller</b>
                    <small>10 Seviye</small>
                </div>
                <div class="lesson-card" onclick="openLevelMap('space')">
                    <i class="fa-solid fa-rocket" style="color:#0984e3;"></i>
                    <b>Uzay</b>
                    <small>10 Seviye</small>
                </div>
                <div class="lesson-card" onclick="openLevelMap('music')">
                    <i class="fa-solid fa-music" style="color:#fd79a8;"></i>
                    <b>M√ºzik</b>
                    <small>10 Seviye</small>
                </div>
                <div class="lesson-card" onclick="openLevelMap('animals')">
                    <i class="fa-solid fa-paw" style="color:#e17055;"></i>
                    <b>Hayvanlar</b>
                    <small>10 Seviye</small>
                </div>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item" onclick="nav('s-home')"><i class="fa-solid fa-house"></i>Ev</div>
            <div class="nav-item" onclick="nav('s-challenges')"><i class="fa-solid fa-hammer"></i>Yap</div>
            <div class="nav-item active" onclick="nav('s-build-hub')"><i class="fa-solid fa-book-open"></i>√ñƒüren</div>
            <div class="nav-item" onclick="nav('s-rewards')"><i class="fa-solid fa-user"></i>Ben</div>
        </div>
    </div>

    <!-- EKRAN 6: SEVƒ∞YE HARƒ∞TASI (LEVEL MAP) -->
    <div id="s-level-map" class="screen">
        <div class="header">
            <i class="fa-solid fa-chevron-left back-btn" onclick="nav('s-build-hub')"></i>
            <h3 id="map-title">Matematik</h3>
            <div></div>
        </div>
        <div class="scroll-content" style="text-align:center;">
            <p>Sƒ±rayla t√ºm yƒ±ldƒ±zlarƒ± topla!</p>
            <div class="level-map" id="level-grid-container">
                <!-- JS ile dolacak -->
            </div>
        </div>
    </div>

    <!-- EKRAN 7: QUIZ EKRANI -->
    <div id="s-quiz" class="screen">
        <div class="header">
            <i class="fa-solid fa-xmark back-btn" onclick="nav('s-level-map')" style="color:var(--danger);"></i>
            <h3 id="quiz-level-ind">Level 1</h3>
            <div style="width:30px;"></div>
        </div>
        <div class="scroll-content" style="display:flex; flex-direction:column; justify-content:center;">
            <div class="quiz-timer"><div class="quiz-timer-fill" id="timer-bar"></div></div>
            
            <div style="text-align:center; margin-bottom:40px;">
                <h1 style="font-size:3.5rem; color:var(--text-main); margin-bottom:10px;" id="quiz-question">2 + 2 = ?</h1>
                <p>Doƒüru cevabƒ± se√ß!</p>
            </div>

            <div class="dash-grid" id="quiz-options">
                <!-- JS ile dolacak -->
            </div>

            <!-- Buddy -->
            <div class="buddy-corner">
                <div class="buddy-bubble" id="quiz-buddy-msg">Ba≈üarƒ±lar!</div>
                <img src="avatar1.png" class="buddy-avatar-small" id="quiz-buddy-img">
            </div>
        </div>
    </div>

    <!-- EKRAN 8: CHALLENGES (YAP) -->
    <div id="s-challenges" class="screen">
        <div class="header"><h3>Aktiviteler</h3></div>
        <div class="scroll-content">
            <div class="card" onclick="startGuide('flower')" style="padding:0;">
                <div style="height:120px; width:100%; background:#ffeaa7; display:flex; align-items:center; justify-content:center; font-size:4rem;">üå∏</div>
                <div style="padding:15px; width:100%; display:flex; align-items:center; justify-content:space-between;">
                    <div><h3>√ái√ßek Yap</h3><p style="margin:0;">5 Adƒ±m ‚Ä¢ Kolay</p></div>
                    <button class="btn-primary" style="width:auto; padding:10px 20px;">Ba≈üla</button>
                </div>
            </div>

            <div class="card" onclick="startGuide('castle')" style="padding:0;">
                <div style="height:120px; width:100%; background:#74b9ff; display:flex; align-items:center; justify-content:center; font-size:4rem;">üè∞</div>
                <div style="padding:15px; width:100%; display:flex; align-items:center; justify-content:space-between;">
                    <div><h3>Kale Yap</h3><p style="margin:0;">2 Adƒ±m ‚Ä¢ Orta</p></div>
                    <button class="btn-primary" style="width:auto; padding:10px 20px;">Ba≈üla</button>
                </div>
            </div>

            <div class="card" onclick="startGuide('animal')" style="padding:0;">
                <div style="height:120px; width:100%; background:#a29bfe; display:flex; align-items:center; justify-content:center; font-size:4rem;">ü¶Å</div>
                <div style="padding:15px; width:100%; display:flex; align-items:center; justify-content:space-between;">
                    <div><h3>Hayvan Yap</h3><p style="margin:0;">1 Adƒ±m ‚Ä¢ Kolay</p></div>
                    <button class="btn-primary" style="width:auto; padding:10px 20px;">Ba≈üla</button>
                </div>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item" onclick="nav('s-home')"><i class="fa-solid fa-house"></i>Ev</div>
            <div class="nav-item active" onclick="nav('s-challenges')"><i class="fa-solid fa-hammer"></i>Yap</div>
            <div class="nav-item" onclick="nav('s-build-hub')"><i class="fa-solid fa-book-open"></i>√ñƒüren</div>
            <div class="nav-item" onclick="nav('s-rewards')"><i class="fa-solid fa-user"></i>Ben</div>
        </div>
    </div>

    <!-- EKRAN 9: GUIDE STEPS (REHBER ADIMLARI) -->
    <div id="s-guide-steps" class="screen">
        <div class="header">
            <i class="fa-solid fa-xmark back-btn" onclick="nav('s-challenges')"></i>
            <h3 id="guide-step-header">Adƒ±m 1/5</h3>
            <div style="width:30px;"></div>
        </div>
        <div class="scroll-content">
            <div class="step-progress">
                <!-- JS ile noktalar eklenecek -->
            </div>

            <!-- √ñRNEK G√ñRSEL -->
            <div class="step-image-box">
                <div class="guide-label">√ñrnek</div>
                <img id="guide-example-img" src="" alt="√ñrnek">
            </div>

            <!-- KULLANICI G√ñRSELƒ∞ -->
            <div class="step-image-box" id="guide-user-box" style="display:none; border-color:var(--primary);">
                <div class="guide-label user">Senin Eserin</div>
                <img id="guide-user-img" src="" alt="Senin Eserin">
            </div>

            <div style="text-align:center; margin:20px 0;">
                <h2 id="guide-step-title">Ba≈ülƒ±k</h2>
                <p id="guide-step-desc">A√ßƒ±klama</p>
            </div>

            <!-- FOTOƒûRAF Y√úKLEME BUTONU -->
            <div class="step-upload-btn" onclick="document.getElementById('guide-file-input').click()">
                <i class="fa-solid fa-camera" style="font-size:1.5rem; margin-bottom:5px; color:var(--text-muted);"></i>
                <div>Fotoƒüraf √áek / Y√ºkle</div>
            </div>
            <input type="file" id="guide-file-input" style="display:none;" accept="image/*" onchange="handlePhotoUpload(this)">

            <!-- NAVƒ∞GASYON -->
            <div style="display:flex; gap:15px; margin-top:25px;">
                <button class="btn-secondary" style="flex:1;" onclick="prevStep()">Geri</button>
                <button class="btn-primary" style="flex:2;" id="btn-guide-next" onclick="nextStep()">ƒ∞leri</button>
            </div>
        </div>
    </div>

    <!-- EKRAN 10: GUIDE SUCCESS (SONU√á) -->
    <div id="s-guide-success" class="screen" style="text-align:center; padding:30px;">
        <div style="width:100px; height:100px; background:var(--success); border-radius:50%; display:flex; align-items:center; justify-content:center; color:white; font-size:3rem; margin:20px auto; animation:popIn 0.5s;">
            <i class="fa-solid fa-check"></i>
        </div>
        <h1>Harika ƒ∞≈ü!</h1>
        <p>ƒ∞≈üte yaratƒ±cƒ±lƒ±ƒüƒ±nƒ±n hikayesi:</p>
        
        <div class="scroll-content" style="flex:1; padding:0;">
            <div class="summary-grid" id="summary-grid">
                <!-- Y√ºklenen fotolar buraya gelecek -->
            </div>
        </div>
        
        <div style="padding:20px 0;">
            <button class="btn-primary" onclick="claimGuideReward()">√ñd√ºl√ºn√º Al (+50 XP)</button>
        </div>
    </div>

    <!-- EKRAN 11: REWARDS & PROFILE (BEN) -->
    <div id="s-rewards" class="screen">
        <div class="scroll-content" style="padding:0;">
            <div class="profile-card">
                <div style="position:relative; z-index:2;">
                    <img id="profile-avatar-main" src="avatar1.png" class="profile-avatar-lg">
                    <h2 id="profile-name-main">ƒ∞simsiz</h2>
                    <p style="margin:5px 0;">Usta Yaratƒ±cƒ±</p>
                    
                    <div class="stat-row">
                        <div class="stat-box">
                            <span class="stat-val" id="profile-lvl">1</span>
                            <span class="stat-lbl">Seviye</span>
                        </div>
                        <div class="stat-box">
                            <span class="stat-val" id="profile-xp">0</span>
                            <span class="stat-lbl">XP Puan</span>
                        </div>
                    </div>
                </div>
            </div>

            <div style="padding:0 25px;">
                <!-- Rozetler -->
                <h3>Koleksiyonun</h3>
                <div class="badge-grid" id="badge-container">
                    <!-- JS ile dolacak -->
                </div>

                <!-- Liderlik -->
                <h3>Liderlik Tablosu</h3>
                <div class="card" style="padding:0; overflow:hidden;">
                    <div class="leaderboard-list">
                        <div class="lb-item" onclick="openFriendModal('Ay≈üe', 'Seviye 5', 'avatar2.png')">
                            <div class="lb-rank" style="color:var(--gold);">1</div>
                            <img src="avatar2.png" class="lb-avatar">
                            <div class="lb-info"><span class="lb-name">Ay≈üe</span><span class="lb-level">Seviye 5</span></div>
                            <div class="lb-score">1500 XP</div>
                        </div>
                        <div class="lb-item" onclick="openFriendModal('Ali', 'Seviye 4', 'avatar3.png')">
                            <div class="lb-rank" style="color:#bdc3c7;">2</div>
                            <img src="avatar3.png" class="lb-avatar">
                            <div class="lb-info"><span class="lb-name">Ali</span><span class="lb-level">Seviye 4</span></div>
                            <div class="lb-score">1250 XP</div>
                        </div>
                        <div class="lb-item" style="background:#f0f0f0; border-left:4px solid var(--primary);">
                            <div class="lb-rank">3</div>
                            <img id="lb-my-avatar" src="avatar1.png" class="lb-avatar">
                            <div class="lb-info"><span class="lb-name" id="lb-my-name">Sen</span><span class="lb-level" id="lb-my-lvl">Seviye 1</span></div>
                            <div class="lb-score" id="lb-my-score">0 XP</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item" onclick="nav('s-home')"><i class="fa-solid fa-house"></i>Ev</div>
            <div class="nav-item" onclick="nav('s-challenges')"><i class="fa-solid fa-hammer"></i>Yap</div>
            <div class="nav-item" onclick="nav('s-build-hub')"><i class="fa-solid fa-book-open"></i>√ñƒüren</div>
            <div class="nav-item active" onclick="nav('s-rewards')"><i class="fa-solid fa-user"></i>Ben</div>
        </div>
    </div>

</div>

<!-- KONFETƒ∞ K√úT√úPHANESƒ∞ -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
    /* =================================================================
       B√ñL√úM 7: JAVASCRIPT MANTIƒûI & VERƒ∞ TABANI
       =================================================================
    */

    // --- 7.1 VERƒ∞ YAPILARI ---
    
    // Kullanƒ±cƒ± Durumu (State)
    let state = {
        name: "Yaratƒ±cƒ±",
        avatar: "avatar1.png",
        theme: "#C4DFD9",
        xp: 0,
        level: 1,
        unlockedLevels: { // Her dersin a√ßƒ±lan son seviyesi
            math: 1, colors: 1, shapes: 1, space: 1, music: 1, animals: 1
        },
        badges: [
            { id: "b1", title: "ƒ∞lk Adƒ±m", desc: "Uygulamaya ilk giri≈üini yaptƒ±n.", icon: "ü•á", unlocked: true },
            { id: "b2", title: "Usta Yapƒ±cƒ±", desc: "Bir rehberi tamamla.", icon: "üõ†Ô∏è", unlocked: false },
            { id: "b3", title: "Matematik Dehasƒ±", desc: "Matematik Level 5'e ula≈ü.", icon: "üßÆ", unlocked: false },
            { id: "b4", title: "Sanat√ßƒ±", desc: "3 farklƒ± eser fotoƒürafƒ± y√ºkle.", icon: "üé®", unlocked: false }
        ]
    };

    // Rehber Verileri
    const guides = {
        flower: {
            id: "flower",
            title: "√ái√ßek Yapƒ±mƒ±",
            steps: [
                { t: "Merkezi Yap", d: "Turuncu hamurdan yuvarlak yap.", img: "cicek_adim1.jpg" },
                { t: "Yapraklarƒ± Hazƒ±rla", d: "Pembe toplar olu≈ütur.", img: "cicek_adim2.jpg" },
                { t: "Birle≈ütir", d: "Yapraklarƒ± merkeze ekle.", img: "cicek_adim3.jpg" },
                { t: "Sapƒ± Ekle", d: "Ye≈üil sapƒ± monte et.", img: "cicek_adim4.jpg" },
                { t: "Son Dokunu≈ü", d: "K√º√ß√ºk yapraklarƒ± ekle.", img: "cicek_adim5.jpg" }
            ]
        },
        castle: {
            id: "castle",
            title: "Kale Yapƒ±mƒ±",
            steps: [
                { t: "Taban", d: "Kare taban hazƒ±rla.", img: "kale_adim1.jpg" },
                { t: "Kuleler", d: "K√∂≈üelere kule ekle.", img: "kale_adim2.jpg" }
            ]
        },
        animal: {
            id: "animal",
            title: "Hayvan Yapƒ±mƒ±",
            steps: [
                { t: "G√∂vde", d: "G√∂vdeyi olu≈ütur.", img: "hayvan_adim1.jpg" }
            ]
        }
    };

    // Ders Sorularƒ± (Basitle≈ütirilmi≈ü Sim√ºlasyon Veritabanƒ±)
    const quizzes = {
        math: [
            { q: "2 + 2 = ?", a: ["4", "5", "3", "6"], corr: "4" },
            { q: "5 - 3 = ?", a: ["2", "3", "1", "0"], corr: "2" },
            { q: "3 + 3 = ?", a: ["6", "9", "5", "7"], corr: "6" }
        ],
        colors: [
            { q: "Kƒ±rmƒ±zƒ± Hangisi?", a: ["üü•", "üü¶", "üü©", "üü®"], corr: "üü•" },
            { q: "Mavi Hangisi?", a: ["üü¶", "üü•", "üü®", "üüß"], corr: "üü¶" }
        ],
        shapes: [
            { q: "Kare Hangisi?", a: ["‚¨õ", "üîµ", "üî∫", "‚≠ê"], corr: "‚¨õ" },
            { q: "Daire Hangisi?", a: ["üîµ", "‚¨õ", "üî∑", "üî∂"], corr: "üîµ" }
        ]
        // Diƒüerleri i√ßin benzer mantƒ±kla devam eder...
    };

    // Ge√ßici Deƒüi≈ükenler
    let activeGuide = null;
    let currentStep = 0;
    let uploadedPhotos = []; // Kullanƒ±cƒ±nƒ±n rehberde y√ºkledikleri
    let currentLesson = null;
    let currentLessonLevel = 1;

    // --- 7.2 BA≈ûLATMA VE Y√úKLEME ---
    
    // Sayfa Y√ºklendiƒüinde
    window.onload = function() {
        loadData(); // Verileri √ßek
        updateUI(); // Aray√ºz√º g√ºncelle
        
        // ƒ∞lk kez giriyorsa Splash -> Onboarding, yoksa Splash -> Home
        setTimeout(() => {
            if(localStorage.getItem('squish_setup_done')) {
                nav('s-home');
            } else {
                nav('s-onboarding');
            }
        }, 2000);
    };

    function loadData() {
        const saved = localStorage.getItem('squish_state');
        if(saved) {
            const parsed = JSON.parse(saved);
            // State birle≈ütirme (yeni alanlar eklendiyse bozulmasƒ±n diye)
            state = { ...state, ...parsed };
            // Badge dizisini g√ºncelle (referans kaybetmemek i√ßin)
            // Ger√ßek uygulamada daha karma≈üƒ±k merge gerekir.
        }
    }

    function saveData() {
        localStorage.setItem('squish_state', JSON.stringify(state));
        localStorage.setItem('squish_setup_done', 'true');
        updateUI();
    }

    // --- 7.3 NAVƒ∞GASYON ---
    function nav(screenId) {
        // T√ºm ekranlarƒ± gizle
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        // Hedef ekranƒ± g√∂ster
        document.getElementById(screenId).classList.add('active');
        
        // Bottom Nav g√ºncelle
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        
        if (screenId === 's-home') activateNav(0);
        else if (screenId === 's-challenges' || screenId.includes('guide')) activateNav(1);
        else if (screenId === 's-build-hub' || screenId.includes('level') || screenId === 's-quiz') activateNav(2);
        else if (screenId === 's-rewards') activateNav(3);
    }

    function activateNav(index) {
        const items = document.querySelectorAll('.nav-item');
        if(items[index]) items[index].classList.add('active');
    }

    // --- 7.4 PROFƒ∞L ƒ∞≈ûLEMLERƒ∞ ---
    function pickAvatar(el, src) {
        document.querySelectorAll('.avatar-opt').forEach(a => a.classList.remove('selected'));
        el.classList.add('selected');
        state.avatar = src;
    }

    function pickColor(color) {
        state.theme = color;
        document.documentElement.style.setProperty('--primary', color);
        // Koyu tonu basit√ße ayarlƒ±yoruz (ger√ßekte HSL manip√ºlasyonu daha iyi olur)
        if(color === '#C4DFD9') document.documentElement.style.setProperty('--primary-dark', '#2e5c4d');
        if(color === '#FFD1BA') document.documentElement.style.setProperty('--primary-dark', '#d68c6d');
        if(color === '#DCD6F7') document.documentElement.style.setProperty('--primary-dark', '#424874');
    }

    function saveProfileAndStart() {
        const nameInput = document.getElementById('inp-name').value;
        if(nameInput.trim() !== "") state.name = nameInput;
        saveData();
        showToast(`Ho≈ü geldin, ${state.name}!`, 'success');
        nav('s-home');
    }

    function saveProfile() {
        // Profil sayfasƒ±ndan kaydetme
        saveData();
        showToast('Profil g√ºncellendi', 'success');
    }

    function resetProgress() {
        if(confirm("T√ºm ilerlemen silinecek. Emin misin?")) {
            localStorage.removeItem('squish_state');
            localStorage.removeItem('squish_setup_done');
            location.reload();
        }
    }

    // --- 7.5 REHBER (GUIDE) MANTIƒûI ---
    function setupGuide(key) {
        activeGuide = guides[key];
        document.getElementById('intro-title').innerText = activeGuide.title;
        // ƒ∞konu dinamik yapabiliriz ama ≈üimdilik sabit
        nav('s-guide-intro');
    }

    function startActualGuide() {
        currentStep = 0;
        uploadedPhotos = new Array(activeGuide.steps.length).fill(null);
        renderStep();
        nav('s-guide-steps');
    }

    function renderStep() {
        const stepData = activeGuide.steps[currentStep];
        const isLast = currentStep === activeGuide.steps.length - 1;

        // Ba≈ülƒ±klar
        document.getElementById('guide-step-header').innerText = `Adƒ±m ${currentStep + 1}/${activeGuide.steps.length}`;
        document.getElementById('guide-step-title').innerText = stepData.t;
        document.getElementById('guide-step-desc').innerText = stepData.d;

        // G√∂rseller
        document.getElementById('guide-example-img').src = stepData.img;
        
        const userBox = document.getElementById('guide-user-box');
        const userImg = document.getElementById('guide-user-img');
        
        if (uploadedPhotos[currentStep]) {
            userImg.src = uploadedPhotos[currentStep];
            userBox.style.display = 'flex';
        } else {
            userBox.style.display = 'none';
        }

        // Buton Durumu
        const nextBtn = document.getElementById('btn-guide-next');
        if(isLast) {
            nextBtn.innerText = "Macerayƒ± Tamamla üéâ";
            nextBtn.classList.add('btn-success');
        } else {
            nextBtn.innerText = "ƒ∞leri";
            nextBtn.classList.remove('btn-success');
        }

        // Progress Dots
        // (Basit√ße barƒ± dolduralƒ±m)
        const pct = ((currentStep + 1) / activeGuide.steps.length) * 100;
        document.querySelector('#s-guide-steps .progress-fill').style.width = `${pct}%`;
    }

    function handlePhotoUpload(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedPhotos[currentStep] = e.target.result;
                renderStep();
                showToast('Fotoƒüraf Y√ºklendi! üì∏', 'success');
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function prevStep() {
        if(currentStep > 0) {
            currentStep--;
            renderStep();
        } else {
            nav('s-guide-intro');
        }
    }

    function nextStep() {
        // Fotoƒüraf zorunluluƒüu kontrol√º
        if(!uploadedPhotos[currentStep]) {
            showToast('L√ºtfen √∂nce yaptƒ±ƒüƒ±nƒ± √ßek ve y√ºkle!', 'error');
            return;
        }

        if(currentStep < activeGuide.steps.length - 1) {
            currentStep++;
            renderStep();
        } else {
            // Biti≈ü
            finishGuide();
        }
    }

    function finishGuide() {
        // √ñzet ekranƒ±nƒ± doldur
        const grid = document.getElementById('summary-grid');
        grid.innerHTML = "";
        
        uploadedPhotos.forEach((photo, idx) => {
            const div = document.createElement('div');
            div.className = 'summary-card';
            div.innerHTML = `
                <img src="${photo}" class="summary-thumb">
                <div style="text-align:left;">
                    <b>Adƒ±m ${idx + 1}</b><br>
                    <small style="color:var(--success);">Tamamlandƒ±</small>
                </div>
            `;
            grid.appendChild(div);
        });

        nav('s-guide-success');
        
        // Rozet Kontrol√º (Usta Yapƒ±cƒ±)
        if(!state.badges[1].unlocked) {
            state.badges[1].unlocked = true;
            setTimeout(() => showToast('ROZET KAZANDIN: Usta Yapƒ±cƒ±!', 'levelup'), 1000);
        }
    }

    function claimGuideReward() {
        addXP(50);
        launchConfetti();
        nav('s-rewards');
    }

    // --- 7.6 DERS & LEVEL Sƒ∞STEMƒ∞ ---
    function openLevelMap(lessonId) {
        currentLesson = lessonId;
        // Ba≈ülƒ±k ayarla
        const titles = {math: "Matematik", colors: "Renkler", shapes: "≈ûekiller", space: "Uzay", music: "M√ºzik", animals: "Hayvanlar"};
        document.getElementById('map-title').innerText = titles[lessonId];
        
        // Grid olu≈ütur
        const container = document.getElementById('level-grid-container');
        container.innerHTML = "";
        
        const unlockedCount = state.unlockedLevels[lessonId];

        for(let i=1; i<=10; i++) {
            let statusClass = "locked";
            if(i <= unlockedCount) statusClass = "unlocked";
            if(i < unlockedCount) statusClass = "completed"; // Basitlik i√ßin

            let content = `<i class="fa-solid fa-lock"></i>`;
            if(statusClass !== "locked") content = i;
            if(statusClass === "completed") content = `<i class="fa-solid fa-check"></i>`;

            const div = document.createElement('div');
            div.className = `level-node ${statusClass}`;
            div.innerHTML = `
                <div>${content}</div>
                ${statusClass !== 'locked' ? '<div class="level-stars"><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i></div>' : ''}
            `;
            
            if(statusClass !== 'locked') {
                div.onclick = () => startQuiz(i);
            } else {
                div.onclick = () => showToast("√ñnceki seviyeyi tamamlamalƒ±sƒ±n!", "error");
            }
            container.appendChild(div);
        }
        nav('s-level-map');
    }

    function startQuiz(lvl) {
        currentLessonLevel = lvl;
        document.getElementById('quiz-level-ind').innerText = `Level ${lvl}`;
        nav('s-quiz');
        
        // Soru y√ºkle (Sim√ºlasyon: Rastgele soru se√ß)
        // Ger√ßekte lessonId ve lvl'e g√∂re filtreleme yapƒ±lƒ±r.
        // Burada basitlik adƒ±na rastgele bir soru g√∂steriyoruz.
        let pool = quizzes[currentLesson] || quizzes.math; // Fallback
        let qData = pool[Math.floor(Math.random() * pool.length)];
        
        document.getElementById('quiz-question').innerText = qData.q;
        
        const optsContainer = document.getElementById('quiz-options');
        optsContainer.innerHTML = "";
        
        qData.a.forEach(opt => {
            const btn = document.createElement('div');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(opt, qData.corr, btn);
            optsContainer.appendChild(btn);
        });

        // Timer animasyonu
        const timer = document.getElementById('timer-bar');
        timer.style.width = '100%';
        setTimeout(() => timer.style.width = '0%', 100);
    }

    function checkAnswer(selected, correct, btnEl) {
        if(selected === correct) {
            btnEl.style.background = "var(--success)";
            btnEl.style.color = "white";
            btnEl.style.borderColor = "var(--success)";
            showToast("Doƒüru!", "success");
            
            setTimeout(() => {
                // Seviye ge√ßi≈üi
                if(currentLessonLevel === state.unlockedLevels[currentLesson]) {
                    state.unlockedLevels[currentLesson]++;
                    showToast("Yeni Seviye A√ßƒ±ldƒ±!", "levelup");
                }
                addXP(15);
                openLevelMap(currentLesson);
            }, 1000);
        } else {
            btnEl.style.background = "var(--danger)";
            btnEl.style.color = "white";
            showToast("Tekrar dene!", "error");
        }
    }

    // --- 7.7 YARDIMCI FONKSƒ∞YONLAR ---
    function addXP(amount) {
        state.xp += amount;
        if(state.xp >= 100) {
            state.level++;
            state.xp = state.xp - 100;
            showToast(`TEBRƒ∞KLER! SEVƒ∞YE ${state.level} OLDUN! üéâ`, 'levelup');
            launchConfetti();
        }
        saveData();
    }

    function updateUI() {
        // ƒ∞simler
        document.getElementById('home-name').innerText = state.name;
        document.getElementById('home-name-display').innerText = state.name;
        document.getElementById('profile-name-display').innerText = state.name;
        document.getElementById('lb-my-name').innerText = state.name;
        
        // Avatarlar
        const avatarSrc = state.avatar;
        document.getElementById('profile-avatar-display').src = avatarSrc;
        document.getElementById('profile-avatar-main').src = avatarSrc;
        document.getElementById('lb-my-avatar').src = avatarSrc;
        document.getElementById('quiz-buddy-img').src = avatarSrc;

        // Stats
        document.getElementById('home-lvl').innerText = state.level;
        document.getElementById('home-xp').innerText = state.xp;
        document.getElementById('profile-lvl').innerText = state.level;
        document.getElementById('p-lvl').innerText = state.level;
        document.getElementById('p-xp').innerText = state.xp;
        document.getElementById('lb-my-lvl').innerText = `Seviye ${state.level}`;
        document.getElementById('lb-my-score').innerText = `${state.xp + (state.level-1)*100} XP`;
        
        // XP Bar
        document.getElementById('home-xp-bar').style.width = `${state.xp}%`;

        // Tema
        pickColor(state.theme);

        // Rozetleri Render Et
        renderBadges();
    }

    function renderBadges() {
        const container = document.getElementById('badge-container');
        container.innerHTML = "";
        
        state.badges.forEach(b => {
            const div = document.createElement('div');
            div.className = `badge-item ${b.unlocked ? 'unlocked' : ''}`;
            div.onclick = () => openBadgeModal(b.title, b.desc, b.icon, b.unlocked ? 'Kazanƒ±ldƒ±' : 'Kilitli');
            div.innerHTML = `
                <span class="badge-icon">${b.icon}</span>
                <small>${b.title}</small>
            `;
            container.appendChild(div);
        });
    }

    // Modal ƒ∞≈ülemleri
    function openBadgeModal(t, d, i, s) {
        document.getElementById('m-badge-title').innerText = t;
        document.getElementById('m-badge-desc').innerText = d;
        document.getElementById('m-badge-icon').innerText = i;
        document.getElementById('m-badge-status').innerText = s;
        document.getElementById('badge-modal').style.display = 'flex';
    }
    
    function openFriendModal(n, l, img) {
        document.getElementById('m-friend-name').innerText = n;
        document.getElementById('m-friend-level').innerText = l;
        document.getElementById('m-friend-img').src = img;
        document.getElementById('friend-modal').style.display = 'flex';
    }

    function closeModal(id) {
        document.getElementById(id).style.display = 'none';
    }

    function launchConfetti() {
        confetti({
            particleCount: 100,
            spread: 70,
            origin: { y: 0.6 }
        });
    }

</script>

</body>
</html>
