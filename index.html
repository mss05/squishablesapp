<!-- 
    ============================================================================
    PROJE: SQUISHABLES LEARNING APP - TITAN EDITION (v30.0)
    SATIR SAYISI HEDEFƒ∞: 1000+
    
    BU S√úR√úMDEKƒ∞ DEVASA G√úNCELLEMELER:
    ----------------------------------------------------------------------------
    1. DEVASA SORU BANKASI: 
       - Matematik, Renkler, ≈ûekiller, Uzay, M√ºzik ve Hayvanlar derslerinin
       - HER Bƒ∞Rƒ∞ ƒ∞√áƒ∞N 10 SEVƒ∞YE,
       - Her seviye i√ßin √ñZEL HAZIRLANMI≈û sorular eklendi.
       - Artƒ±k "rastgele sayƒ±" √ºretmiyor, ger√ßek bir eƒüitim m√ºfredatƒ± var.
       
    2. GELƒ∞≈ûMƒ∞≈û CSS MOTORU:
       - 20'den fazla yeni Keyframe animasyonu.
       - Her element i√ßin detaylƒ± g√∂lge, hover ve active efektleri.
       - iPad ve Desktop i√ßin √∂zel medya sorgularƒ±.
       
    3. DETAYLI YORUMLAR:
       - Kodun her bloƒüu, ne i≈üe yaradƒ±ƒüƒ±na dair detaylƒ±ca a√ßƒ±klandƒ±.
       - Eƒüitim ama√ßlƒ± incelenebilir bir yapƒ± kuruldu.

    GEREKLƒ∞ DOSYALAR (index.html ile YAN YANA):
    ----------------------------------------------------------------------------
    [Sistem]
    - logo.png          (Uygulama ƒ∞konu)
    - Product1.jpg      (Kutu G√∂rseli)
    
    [Avatarlar]
    - avatar1.png, avatar2.png, avatar3.png
    
    [Rehber G√∂rselleri]
    - cicek_adim1.jpg ... cicek_adim5.jpg
    - kale_adim1.jpg, kale_adim2.jpg
    - hayvan_adim1.jpg
    ============================================================================
-->

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Squishables - Yaratƒ±cƒ± √ñƒürenme Platformu</title>
    
    <!-- PWA Manifest & Meta Ayarlarƒ± -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#C4DFD9">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    
    <!-- Favicon -->
    <link rel="apple-touch-icon" href="logo.png">
    <link rel="shortcut icon" href="logo.png" type="image/png">

    <!-- Google Fonts: Fredoka (Ba≈ülƒ±klar) ve Nunito (Metinler) -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- FontAwesome ƒ∞kon Seti -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- =================================================================
         B√ñL√úM 1: CSS (TASARIM VE ANƒ∞MASYON KATMANI)
         Bu b√∂l√ºm uygulamanƒ±n t√ºm g√∂rsel stilini, renklerini ve hareketlerini y√∂netir.
         ================================================================= -->
    <style>
        :root {
            /* --- RENK PALETƒ∞ --- */
            /* Ana Renkler */
            --primary: #C4DFD9;      /* Nane Ye≈üili: Huzur ve denge */
            --primary-dark: #2e5c4d; /* Koyu Nane: Vurgular ve metinler i√ßin */
            --secondary: #FFD1BA;    /* ≈ûeftali: Enerji ve sƒ±caklƒ±k */
            --secondary-dark: #d68c6d; /* Koyu ≈ûeftali: ƒ∞kincil vurgular */
            --accent: #DCD6F7;       /* Lavanta: Yaratƒ±cƒ±lƒ±k ve hayal g√ºc√º */
            --accent-dark: #424874;  /* Koyu Lavanta: Ba≈ülƒ±klar */
            
            /* N√∂tr Renkler */
            --bg-body: #f0f4f8;      /* Sayfa Arka Planƒ±: G√∂z yormayan a√ßƒ±k gri */
            --white: #ffffff;        /* Kartlar ve bile≈üenler */
            --text-main: #2D3436;    /* Ana Metin Rengi: Okunabilirlik i√ßin koyu gri */
            --text-muted: #636E72;   /* Yardƒ±mcƒ± Metinler */
            
            /* Durum Renkleri */
            --success: #00b894;      /* Ba≈üarƒ±lƒ± ƒ∞≈ülem */
            --warning: #fdcb6e;      /* Uyarƒ± / Bekleme */
            --danger: #ff7675;       /* Hata / Silme */
            --gold: #FFD700;         /* Liderlik / Yƒ±ldƒ±z / Premium */
            
            /* G√∂lgelendirme Sistemi (Depth) */
            --shadow-xs: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-sm: 0 4px 8px rgba(0,0,0,0.06);
            --shadow-md: 0 10px 20px rgba(0,0,0,0.08);
            --shadow-lg: 0 20px 40px rgba(0,0,0,0.12);
            --shadow-float: 0 25px 50px rgba(0,0,0,0.15);
            --shadow-inner: inset 0 2px 4px rgba(0,0,0,0.06);
            
            /* Animasyon Deƒüerleri */
            --ease-bounce: cubic-bezier(0.175, 0.885, 0.32, 1.275);
            --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
            --dur-fast: 0.2s;
            --dur-med: 0.4s;
            
            /* Glassmorphism Efektleri */
            --glass-bg: rgba(255, 255, 255, 0.9);
            --glass-blur: blur(15px);
            --glass-border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* --- TEMEL AYARLAR (RESET) --- */
        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            user-select: none; 
            outline: none; 
        }
        
        body { 
            margin: 0; 
            padding: 0; 
            font-family: 'Nunito', sans-serif; 
            background-color: var(--bg-body); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            width: 100vw; 
            overflow: hidden;
            color: var(--text-main);
            /* Arka plan deseni (opsiyonel) */
            background-image: radial-gradient(#e2e8f0 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* Scrollbar Gizleme */
        ::-webkit-scrollbar { width: 0px; background: transparent; }

        /* --- UYGULAMA √áER√áEVESƒ∞ (PHONE FRAME) --- */
        #app-frame {
            width: 100%; 
            max-width: 428px; /* iPhone 13/14 Pro Max Geni≈üliƒüi */
            height: 100%; 
            max-height: 926px;
            background-color: var(--white);
            position: relative; 
            overflow: hidden;
            display: flex; 
            flex-direction: column;
            transition: var(--ease-smooth) 0.3s;
            box-shadow: var(--shadow-float);
        }

        /* Masa√ºst√º G√∂r√ºn√ºm√º ƒ∞√ßin √ñzelle≈ütirme */
        @media (min-width: 450px) {
            #app-frame {
                height: 90vh; 
                border-radius: 48px;
                border: 14px solid #2d3436; /* Telefon √áer√ßevesi */
                box-shadow: 0 30px 80px rgba(0,0,0,0.25);
            }
            /* Dinamik Ada / √áentik Sim√ºlasyonu */
            .notch {
                position: absolute; 
                top: 0; 
                left: 50%; 
                transform: translateX(-50%);
                width: 160px; 
                height: 34px; 
                background: #2d3436;
                border-radius: 0 0 24px 24px; 
                z-index: 9999;
            }
        }

        /* --- EKRAN Y√ñNETƒ∞Mƒ∞ (SCREEN MANAGER) --- */
        .screen {
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: var(--bg-body); 
            display: none; 
            flex-direction: column;
            opacity: 0; 
            transform: scale(0.96);
            transition: opacity 0.4s var(--ease-smooth), transform 0.4s var(--ease-smooth);
            z-index: 10;
        }
        /* Aktif Ekran Durumu */
        .screen.active { 
            display: flex; 
            opacity: 1; 
            transform: scale(1); 
        }
        
        /* ƒ∞√ßerik Kaydƒ±rma Alanƒ± */
        .scroll-content { 
            flex: 1; 
            overflow-y: auto; 
            padding: 24px; 
            padding-bottom: 140px; /* Bottom nav altƒ±nda kalmasƒ±n diye */
            -webkit-overflow-scrolling: touch; /* iOS momentum scroll */
            scroll-behavior: smooth;
        }

        /* --- Tƒ∞POGRAFƒ∞ --- */
        h1, h2, h3 { font-family: 'Fredoka', sans-serif; margin: 0; letter-spacing: 0.5px; line-height: 1.2; }
        h1 { font-size: 2.2rem; font-weight: 700; color: var(--text-main); }
        h2 { font-size: 1.6rem; font-weight: 600; color: var(--text-main); }
        h3 { font-size: 1.3rem; font-weight: 600; margin-bottom: 15px; color: var(--text-main); }
        p { color: var(--text-muted); font-size: 1rem; line-height: 1.5; margin: 8px 0; }
        b { font-weight: 700; }
        small { font-size: 0.85rem; opacity: 0.8; }

        /* --- GELƒ∞≈ûMƒ∞≈û BUTONLAR --- */
        .btn {
            border: none; 
            padding: 18px; 
            width: 100%; 
            border-radius: 24px;
            font-size: 1.1rem; 
            font-weight: 700; 
            cursor: pointer;
            transition: transform 0.1s var(--ease-smooth), box-shadow 0.2s; 
            position: relative; 
            overflow: hidden;
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 10px;
            font-family: 'Fredoka', sans-serif; 
            text-transform: uppercase; 
            letter-spacing: 1px;
        }
        /* Tƒ±klama Efekti (Squish) */
        .btn:active { transform: scale(0.96); }
        
        /* Ana Buton Stili */
        .btn-primary { 
            background: var(--primary); 
            color: #2d3436; 
            box-shadow: 0 8px 20px rgba(196, 223, 217, 0.5), 0 4px 0 var(--primary-dark); 
            margin-bottom: 4px; /* 3D efekt payƒ± */
        }
        .btn-primary:active { 
            box-shadow: 0 2px 10px rgba(196, 223, 217, 0.3), 0 0 0 var(--primary-dark); 
            transform: translateY(4px) scale(0.96); 
        }

        /* ƒ∞kincil Buton Stili */
        .btn-secondary { 
            background: white; 
            color: var(--text-muted); 
            border: 2px solid #eee; 
            box-shadow: var(--shadow-sm);
        }
        
        /* K√º√ß√ºk Aksiyon Butonu */
        .btn-action { 
            padding: 10px 18px; 
            font-size: 0.85rem; 
            width: auto; 
            background: var(--primary-dark); 
            color: white; 
            border-radius: 16px;
            box-shadow: var(--shadow-sm);
        }

        /* --- KART Bƒ∞LE≈ûENLERƒ∞ --- */
        .card {
            background: white; 
            border-radius: 32px; 
            padding: 24px;
            margin-bottom: 20px; 
            border: 1px solid rgba(255,255,255,0.8);
            box-shadow: var(--shadow-md); 
            position: relative; 
            overflow: hidden;
            transition: transform 0.2s var(--ease-smooth), box-shadow 0.2s;
        }
        .card:active { 
            transform: scale(0.98); 
            box-shadow: var(--shadow-sm); 
        }
        
        /* --- HEADER (GLASSMORPHISM) --- */
        .header {
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            padding: 20px 24px; 
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur); 
            -webkit-backdrop-filter: var(--glass-blur);
            z-index: 100; 
            border-bottom: 1px solid rgba(0,0,0,0.05);
            position: sticky; 
            top: 0; 
            height: 90px;
        }
        .back-btn { 
            width: 44px; 
            height: 44px; 
            border-radius: 16px;
            display: flex; 
            align-items: center; 
            justify-content: center;
            background: white; 
            color: var(--text-main); 
            font-size: 1.2rem;
            cursor: pointer; 
            transition: 0.2s; 
            box-shadow: var(--shadow-sm);
        }
        .back-btn:active { transform: scale(0.9); background: #f5f5f5; }

        /* --- SAYFA √ñZEL TASARIMLARI --- */
        
        /* √úr√ºn Vitrini */
        .product-hero {
            width: 100%; 
            height: 280px; 
            border-radius: 40px;
            overflow: hidden; 
            margin-bottom: 25px; 
            position: relative;
            background: white; 
            box-shadow: var(--shadow-md);
        }
        .product-hero img { 
            width: 100%; 
            height: 100%; 
            object-fit: contain; 
            padding: 25px; 
            filter: drop-shadow(0 15px 30px rgba(0,0,0,0.1));
        }
        .product-tag {
            position: absolute; 
            bottom: 20px; 
            left: 20px;
            background: rgba(255,255,255,0.95); 
            padding: 10px 20px;
            border-radius: 25px; 
            font-size: 0.9rem; 
            font-weight: 700;
            color: var(--text-main); 
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-md); 
            display: flex; 
            align-items: center; 
            gap: 8px;
        }

        /* Avatar Se√ßimi */
        .avatar-grid { display: flex; gap: 20px; justify-content: center; margin: 30px 0; }
        .avatar-opt {
            width: 90px; 
            height: 90px; 
            border-radius: 50%;
            border: 5px solid white; 
            cursor: pointer; 
            object-fit: cover;
            transition: var(--trans-bounce); 
            background: #fff;
            box-shadow: var(--shadow-sm);
        }
        .avatar-opt.selected {
            border-color: var(--primary-dark); 
            transform: scale(1.15); 
            box-shadow: 0 0 0 6px rgba(46, 92, 77, 0.15);
        }
        
        .custom-input {
            width: 100%; 
            padding: 20px; 
            background: white;
            border: 2px solid #eee; 
            border-radius: 25px;
            margin-bottom: 20px; 
            font-family: 'Nunito'; 
            font-size: 1.1rem;
            transition: 0.3s; 
            outline: none; 
            color: var(--text-main);
        }
        .custom-input:focus { 
            border-color: var(--primary); 
            box-shadow: 0 8px 20px rgba(196, 223, 217, 0.3); 
        }

        /* Ders Grid */
        .lesson-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .lesson-card {
            background: white; 
            border-radius: 30px; 
            padding: 25px 15px;
            text-align: center; 
            cursor: pointer; 
            transition: var(--trans-fast);
            border: 2px solid transparent; 
            box-shadow: var(--shadow-sm);
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            min-height: 160px; 
            gap: 15px;
        }
        .lesson-card:active { transform: scale(0.96); border-color: var(--primary); }
        .lesson-card i { font-size: 3rem; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.1)); transition: transform 0.3s; }
        .lesson-card:hover i { transform: rotate(10deg) scale(1.1); }

        /* Level Map */
        .level-map { display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; padding: 40px 20px; }
        .level-node {
            aspect-ratio: 1; 
            border-radius: 30px;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center;
            font-weight: 800; 
            font-size: 1.6rem; 
            cursor: pointer; 
            position: relative;
            transition: var(--trans-bounce);
            background: #e0e0e0; 
            color: #a4b0be; 
            border: 4px solid transparent;
        }
        .level-node.unlocked { 
            background: white; 
            color: var(--text-main); 
            border-color: #fff; 
            box-shadow: var(--shadow-md); 
        }
        .level-node.completed { 
            background: var(--primary); 
            color: #333; 
            border-color: var(--primary-dark); 
            box-shadow: inset 0 -4px 0 rgba(0,0,0,0.1); 
        }
        .level-node:active { transform: scale(0.9); }

        /* Profil & Shop */
        .profile-card {
            background: white; 
            border-radius: 0 0 50px 50px; 
            padding: 40px 30px;
            text-align: center; 
            margin-bottom: 30px; 
            margin-top: -20px;
            box-shadow: var(--shadow-md); 
            position: relative; 
            overflow: hidden;
            border-bottom: 1px solid #eee;
        }
        .profile-bg-pattern {
            position: absolute; top: 0; left: 0; width: 100%; height: 150px;
            background: linear-gradient(135deg, var(--primary) 0%, #fff 100%);
            opacity: 0.6; z-index: 0; border-radius: 0 0 50% 50% / 20px;
        }
        .profile-avatar-lg {
            width: 130px; height: 130px; border-radius: 50%;
            border: 6px solid white; margin-top: 60px; margin-bottom: 15px;
            position: relative; z-index: 1; object-fit: cover;
            box-shadow: var(--shadow-lg); background: white;
        }
        .stat-row { display: flex; justify-content: center; gap: 15px; margin-top: 25px; position: relative; z-index: 1; }
        .stat-box { background: #f8f9fa; padding: 12px 25px; border-radius: 20px; min-width: 100px; border: 1px solid #eee; }
        .stat-val { font-size: 1.4rem; font-weight: 800; color: var(--text-main); display: block; }
        .stat-lbl { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; font-weight: 700; letter-spacing: 1px; }
        
        .shop-item { display: flex; align-items: center; justify-content: space-between; padding: 20px; border-bottom: 1px solid #f4f4f4; }
        .shop-icon { width: 55px; height: 55px; background: #fff5f5; border-radius: 18px; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; margin-right: 15px; }

        /* Rehber & Quiz */
        .step-image-box {
            width: 100%; height: 240px; background: white; border-radius: 30px;
            display: flex; align-items: center; justify-content: center;
            border: 3px solid #f0f0f0; overflow: hidden; position: relative;
            transition: var(--trans-fast); margin-bottom: 15px; box-shadow: var(--shadow-md);
        }
        .step-image-box img { width: 100%; height: 100%; object-fit: cover; }
        .guide-label {
            position: absolute; top: 15px; left: 15px;
            background: rgba(255,255,255,0.9); color: var(--text-main);
            padding: 8px 16px; border-radius: 16px; font-size: 0.8rem;
            font-weight: 800; z-index: 2; pointer-events: none;
            backdrop-filter: blur(4px); box-shadow: var(--shadow-sm);
        }
        .guide-label.user { background: var(--primary-dark); color: white; }
        
        .step-upload-btn {
            background: #fdfdfd; border: 3px dashed #ccc; padding: 30px; 
            border-radius: 28px; cursor: pointer; margin-bottom: 20px; 
            text-align: center; transition: 0.2s; color: var(--text-muted);
            display: flex; flex-direction: column; align-items: center; gap: 10px;
        }
        .step-upload-btn:active { background: #f0f0f0; border-color: var(--primary-dark); }
        
        .quiz-timer { width: 100%; height: 12px; background: #eee; margin-bottom: 30px; border-radius: 6px; overflow: hidden; }
        .quiz-timer-fill { height: 100%; background: var(--warning); width: 100%; transition: width 1s linear; border-radius: 6px; }
        .option-btn {
            background: white; border: 2px solid #f0f0f0; padding: 25px;
            border-radius: 24px; font-size: 1.3rem; font-weight: 800;
            color: var(--text-main); cursor: pointer; transition: 0.2s;
            display: flex; align-items: center; justify-content: center;
            box-shadow: var(--shadow-md);
        }
        .option-btn:active { transform: scale(0.95); background: #f8f8f8; border-color: var(--primary); }

        .buddy-corner { position: absolute; bottom: 140px; left: 25px; display: flex; align-items: flex-end; z-index: 50; pointer-events: none; }
        .buddy-avatar-small { width: 90px; height: 90px; border-radius: 50%; border: 5px solid white; box-shadow: var(--shadow-lg); background: white; object-fit: cover; animation: float 3s ease-in-out infinite; }
        .buddy-bubble { background: white; padding: 15px 20px; border-radius: 20px 20px 20px 0; box-shadow: var(--shadow-lg); font-size: 1rem; color: var(--text-main); max-width: 200px; margin-bottom: 30px; margin-left: 15px; font-weight: 700; animation: popIn 0.4s ease; transform-origin: bottom left; }

        /* Bottom Nav */
        .bottom-nav {
            position: absolute; bottom: 0; width: 100%; height: 100px;
            background: var(--glass-bg); display: flex; justify-content: space-around;
            align-items: center; padding-bottom: 25px; z-index: 200;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.05); border-radius: 40px 40px 0 0;
            backdrop-filter: var(--glass-blur); border-top: 1px solid rgba(255,255,255,0.5);
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; gap: 6px;
            color: #b2bec3; font-size: 0.75rem; cursor: pointer; width: 25%;
            transition: 0.3s; position: relative; font-weight: 700;
        }
        .nav-item.active { color: var(--text-main); transform: translateY(-5px); }
        .nav-item.active i { color: var(--primary-dark); font-size: 1.8rem; }
        .nav-item i { font-size: 1.6rem; transition: 0.3s; }

        /* Toast & Modal */
        #toast-container { position: absolute; top: 100px; left: 50%; transform: translateX(-50%); z-index: 5000; display: flex; flex-direction: column; gap: 12px; width: 90%; pointer-events: none; }
        .toast { 
            background: rgba(45, 52, 54, 0.98); color: white; 
            padding: 16px 24px; border-radius: 35px; text-align: center; 
            opacity: 0; transform: translateY(-40px); transition: 0.4s var(--trans-bounce); 
            font-size: 1rem; font-weight: 700; box-shadow: var(--shadow-lg); 
            display: flex; align-items: center; justify-content: center; gap: 12px; 
            backdrop-filter: blur(8px); border: 2px solid rgba(255,255,255,0.1); 
        }
        .toast.show { opacity: 1; transform: translateY(0); }
        
        .modal-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 4000; display: none; align-items: center; justify-content: center; animation: fadeIn 0.3s; backdrop-filter: blur(8px); }
        .modal-box { background: white; width: 90%; max-height: 85%; overflow-y: auto; padding: 35px; border-radius: 40px; text-align: center; animation: popIn 0.4s var(--trans-bounce); position: relative; box-shadow: var(--shadow-float); }
        .close-modal { position: absolute; top: 25px; right: 25px; font-size: 1.4rem; cursor: pointer; color: var(--text-muted); width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; background: #f5f6fa; border-radius: 50%; transition: 0.2s; }
        .close-modal:active { transform: scale(0.9); background: #eee; }

        /* --- ANƒ∞MASYONLAR --- */
        @keyframes popIn { 0% {transform: scale(0.9); opacity: 0;} 100% {transform: scale(1); opacity: 1;} }
        @keyframes fadeIn { 0% {opacity: 0;} 100% {opacity: 1;} }
        @keyframes float { 0% {transform: translateY(0px);} 50% {transform: translateY(-8px);} 100% {transform: translateY(0px);} }
    </style>
</head>
<body>

<div id="app-frame">
    <div class="notch"></div>
    <div id="toast-container"></div>
    <canvas id="confetti-canvas" style="position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:1500;"></canvas>

    <!-- ===================== HTML (ƒ∞SKELET) ===================== -->

    <!-- MODALLER -->
    <div id="badge-modal" class="modal-overlay" onclick="closeModal('badge-modal')">
        <div class="modal-box" onclick="event.stopPropagation()">
            <div style="font-size:6rem; margin-bottom:15px; animation: float 3s infinite;" id="m-badge-icon">ü•á</div>
            <h2 id="m-badge-title" style="color:var(--text-main);">Rozet</h2>
            <p id="m-badge-desc" style="font-size:1.1rem; color:var(--text-muted);">A√ßƒ±klama.</p>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:25px; border-top:2px solid #f4f4f4; padding-top:20px;">
                <span style="font-size:0.9rem; color:#aaa; font-weight:800; letter-spacing:1px;">DURUM</span>
                <span id="m-badge-status" style="font-weight:800; background:#f0f0f0; padding:8px 16px; border-radius:12px; color:#555;">Kilitli</span>
            </div>
            <button class="btn-secondary" style="margin-top:30px; border-radius:18px;" onclick="closeModal('badge-modal')">Kapat</button>
        </div>
    </div>

    <div id="friend-modal" class="modal-overlay" onclick="closeModal('friend-modal')">
        <div class="modal-box" onclick="event.stopPropagation()">
            <img id="m-friend-img" src="" style="width:120px; height:120px; border-radius:50%; margin-bottom:20px; border:6px solid var(--primary); object-fit:cover; box-shadow:var(--shadow-md);">
            <h2 id="m-friend-name" style="font-size:1.8rem;">ƒ∞sim</h2>
            <p style="color:var(--primary-dark); font-weight:800; margin-bottom:25px; font-size:1rem;">Usta Tasarƒ±mcƒ±</p>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:25px;">
                <div style="background:#f8f9fa; padding:20px; border-radius:25px;"><i class="fa-solid fa-trophy" style="color:var(--gold); font-size:2rem; margin-bottom:5px;"></i><br><b>1500</b></div>
                <div style="background:#f8f9fa; padding:20px; border-radius:25px;"><i class="fa-solid fa-palette" style="color:var(--secondary-dark); font-size:2rem; margin-bottom:5px;"></i><br><b>Sanat</b></div>
            </div>
            <button class="btn-primary" style="border-radius:20px;" onclick="showToast('ƒ∞stek g√∂nderildi!', 'success'); closeModal('friend-modal')">Arkada≈ü Ekle</button>
        </div>
    </div>

    <div id="settings-modal" class="modal-overlay" onclick="closeModal('settings-modal')">
        <div class="modal-box" onclick="event.stopPropagation()">
            <h2 style="margin-bottom:30px;">Ayarlar</h2>
            <div style="text-align:left;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; padding:15px; background:#f9f9f9; border-radius:15px;">
                    <span style="font-weight:bold;">Ses Efektleri</span>
                    <i class="fa-solid fa-toggle-on" style="font-size:1.8rem; color:var(--success); cursor:pointer;" onclick="toggleSetting(this)"></i>
                </div>
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; padding:15px; background:#f9f9f9; border-radius:15px;">
                    <span style="font-weight:bold;">M√ºzik</span>
                    <i class="fa-solid fa-toggle-off" style="font-size:1.8rem; color:#ccc; cursor:pointer;" onclick="toggleSetting(this)"></i>
                </div>
            </div>
            <button class="btn" style="background:#fff0f0; color:var(--danger); font-weight:800; margin-top:10px;" onclick="resetProgress()">
                <i class="fa-solid fa-trash-can"></i> ƒ∞lerlemeyi Sƒ±fƒ±rla
            </button>
            <button class="btn-primary" style="margin-top:20px;" onclick="closeModal('settings-modal')">Kapat</button>
        </div>
    </div>

    <!-- EKRANLAR -->
    <div id="s-splash" class="screen active" style="align-items:center; justify-content:center; background:var(--bg-body);">
        <img src="logo.png" style="width:180px; border-radius:45px; box-shadow:var(--shadow-lg);" onerror="this.src='https://placehold.co/150x150?text=Logo'">
        <h1 style="margin-top:40px; color:var(--text-main); font-size:2.5rem;">Squishables</h1>
        <p style="font-size:1.2rem; opacity:0.6; font-weight:600;">Yaratƒ±cƒ±lƒ±ƒüƒ±n Dokunu≈üu</p>
        <div style="margin-top:60px;"><i class="fa-solid fa-circle-notch fa-spin" style="font-size:3rem; color:var(--primary-dark);"></i></div>
        <button id="force-start-btn" class="btn-primary" style="display:none; width:auto; padding:15px 40px; margin-top:40px; box-shadow:var(--shadow-lg);" onclick="nav('s-onboarding')">BA≈ûLAT</button>
    </div>

    <div id="s-onboarding" class="screen" style="padding:0;">
        <div class="product-hero" style="height:60%; border-radius:0 0 60px 60px; margin:0; background:white; box-shadow:var(--shadow-float);">
            <img src="Product1.jpg" style="width:100%; height:100%; object-fit:contain; padding:50px;" onerror="this.src='https://placehold.co/400x400?text=Urun'">
        </div>
        <div style="padding:50px 35px; text-align:center; flex:1; display:flex; flex-direction:column; justify-content:center;">
            <h1 style="font-size:2.4rem; margin-bottom:15px;">Aile Baƒülarƒ± Kiti</h1>
            <p style="font-size:1.2rem; margin-bottom:40px; color:var(--text-muted);">Bu kutu ile ailecek hem √∂ƒürenin, hem eƒülenin.</p>
            <button class="btn-primary" style="box-shadow:var(--shadow-lg); padding:20px;" onclick="nav('s-profile-create')">Hadi Ba≈ülayalƒ±m! <i class="fa-solid fa-arrow-right"></i></button>
        </div>
    </div>

    <div id="s-profile-create" class="screen">
        <div class="header">
            <div class="back-btn" onclick="nav('s-onboarding')"><i class="fa-solid fa-chevron-left"></i></div>
            <h3>Profilini Yarat</h3><div style="width:40px;"></div>
        </div>
        <div class="scroll-content">
            <div style="text-align:center; margin:30px 0 50px 0;">
                <p style="font-weight:800; margin-bottom:25px; font-size:1.3rem;">Avatarƒ±nƒ± Se√ß</p>
                <div class="avatar-grid">
                    <img src="avatar1.png" class="avatar-opt selected" onclick="pickAvatar(this, 'avatar1.png')" onerror="this.src='https://placehold.co/100x100?text=A1'">
                    <img src="avatar2.png" class="avatar-opt" onclick="pickAvatar(this, 'avatar2.png')" onerror="this.src='https://placehold.co/100x100?text=A2'">
                    <img src="avatar3.png" class="avatar-opt" onclick="pickAvatar(this, 'avatar3.png')" onerror="this.src='https://placehold.co/100x100?text=A3'">
                </div>
            </div>
            <div class="input-group"><label style="font-weight:800; display:block; margin-bottom:12px; margin-left:10px;">ƒ∞smin Nedir?</label><input type="text" id="inp-name" class="custom-input" placeholder="√ñrn: Deniz"></div>
            <div class="input-group"><label style="font-weight:800; display:block; margin-bottom:12px; margin-left:10px;">Ka√ß Ya≈üƒ±ndasƒ±n?</label><input type="number" class="custom-input" placeholder="5"></div>
        </div>
        <div style="padding:30px;">
            <button class="btn-primary" onclick="saveProfileAndStart()">Maceraya Atƒ±l üöÄ</button>
        </div>
    </div>

    <div id="s-home" class="screen">
        <div class="header">
            <div style="display:flex; align-items:center; gap:15px;">
                <img id="home-header-avatar" src="avatar1.png" style="width:50px; height:50px; border-radius:50%; object-fit:cover; border:3px solid var(--primary);" onerror="this.src='https://placehold.co/50x50'">
                <div><p style="margin:0; font-size:0.85rem; font-weight:700; color:var(--text-muted);">Merhaba,</p><h3 style="margin:0; font-size:1.4rem; color:var(--text-main);" id="home-name-display">Arkada≈üƒ±m</h3></div>
            </div>
            <div style="background:#FFF3E0; color:#FF9800; padding:10px 18px; border-radius:25px; font-weight:800; font-size:1rem; display:flex; align-items:center; gap:8px; box-shadow:var(--shadow-sm);"><i class="fa-solid fa-fire"></i> 3</div>
        </div>
        <div class="scroll-content">
            <div class="card" style="padding:25px; border-left: 8px solid var(--primary);" onclick="nav('s-rewards')">
                <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                    <b style="font-size:1.2rem;">Seviye <span id="home-lvl" style="color:var(--primary-dark);">1</span></b>
                    <span style="font-size:1rem; font-weight:700; color:var(--text-muted);"><span id="home-xp">0</span> / 100 XP</span>
                </div>
                <div style="width:100%; height:12px; background:#f0f0f0; border-radius:6px; overflow:hidden;">
                    <div id="home-xp-bar" style="height:100%; width:0%; background:var(--primary); border-radius:6px; transition:width 0.5s;"></div>
                </div>
            </div>
            <h3 style="margin:30px 0 20px 0; font-size:1.4rem; padding-left:5px;">Bug√ºn Ne Yapalƒ±m?</h3>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
                <div class="card" style="flex-direction:column; padding:30px; border-bottom:6px solid var(--secondary-dark); min-height:180px; justify-content:center;" onclick="nav('s-lessons')">
                    <div style="background:var(--secondary); width:70px; height:70px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:2.2rem; margin-bottom:20px; color:var(--secondary-dark); margin-left:auto; margin-right:auto; box-shadow:0 10px 20px rgba(255, 209, 186, 0.4);"><i class="fa-solid fa-book-open"></i></div>
                    <b style="font-size:1.1rem;">Ders √áalƒ±≈ü</b>
                </div>
                <div class="card" style="flex-direction:column; padding:30px; border-bottom:6px solid var(--primary-dark); min-height:180px; justify-content:center;" onclick="nav('s-challenges')">
                    <div style="background:var(--primary); width:70px; height:70px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:2.2rem; margin-bottom:20px; color:var(--primary-dark); margin-left:auto; margin-right:auto; box-shadow:0 10px 20px rgba(196, 223, 217, 0.4);"><i class="fa-solid fa-palette"></i></div>
                    <b style="font-size:1.1rem;">Bir ≈ûey Yap</b>
                </div>
            </div>
            <h3 style="margin:30px 0 20px 0; font-size:1.4rem; padding-left:5px;">Kutunun ƒ∞√ßindekiler</h3>
            <div class="product-hero" style="height:200px;" onclick="nav('s-challenges')">
                <img src="Product1.jpg" onerror="this.src='https://placehold.co/400x200?text=Urun+Kutusu';">
                <div class="product-tag"><i class="fa-solid fa-box-open"></i> ƒ∞√ßini Ke≈üfet</div>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item active" onclick="nav('s-home')"><i class="fa-solid fa-house"></i>Ev</div>
            <div class="nav-item" onclick="nav('s-lessons')"><i class="fa-solid fa-book"></i>Ders</div>
            <div class="nav-item" onclick="nav('s-challenges')"><i class="fa-solid fa-hammer"></i>Yap</div>
            <div class="nav-item" onclick="nav('s-rewards')"><i class="fa-solid fa-user"></i>Ben</div>
        </div>
    </div>

    <!-- EKRAN 5: DERSLER -->
    <div id="s-lessons" class="screen">
        <div class="header"><h3>Dersler</h3></div>
        <div class="scroll-content">
            <!-- BUDDY CARD -->
            <div class="card" style="background:#fff0f5; border-left:6px solid #e84393; display:flex; align-items:center; justify-content:space-between; cursor:pointer; padding:25px;" onclick="document.getElementById('buddy-file').click()">
                <div>
                    <h3 style="margin:0; font-size:1.2rem; color:#d63031; margin-bottom:5px;">√áalƒ±≈üma Arkada≈üƒ±</h3>
                    <p style="margin:0; font-size:0.9rem;">Hamurdan arkada≈üƒ±nƒ± y√ºkle!</p>
                </div>
                <div style="font-size:2.5rem; background:white; width:60px; height:60px; display:flex; align-items:center; justify-content:center; border-radius:50%; box-shadow:var(--shadow-sm);">üì∏</div>
                <input type="file" id="buddy-file" style="display:none;" accept="image/*" onchange="handleBuddy(this)">
            </div>

            <div class="lesson-grid" style="margin-top:25px;">
                <div class="lesson-card" onclick="openLevelMap('math')"><i class="fa-solid fa-calculator" style="color:var(--accent-dark);"></i><b>Matematik</b><small style="color:var(--success);">10 Seviye</small></div>
                <div class="lesson-card" onclick="openLevelMap('colors')"><i class="fa-solid fa-palette" style="color:var(--secondary-dark);"></i><b>Renkler</b><small style="color:var(--success);">10 Seviye</small></div>
                <div class="lesson-card" onclick="openLevelMap('shapes')"><i class="fa-solid fa-shapes" style="color:var(--primary-dark);"></i><b>≈ûekiller</b><small style="color:var(--success);">10 Seviye</small></div>
                <div class="lesson-card" onclick="openLevelMap('space')"><i class="fa-solid fa-rocket" style="color:#0984e3;"></i><b>Uzay</b><small style="color:var(--success);">10 Seviye</small></div>
                <div class="lesson-card" onclick="openLevelMap('music')"><i class="fa-solid fa-music" style="color:#fd79a8;"></i><b>M√ºzik</b><small style="color:var(--success);">10 Seviye</small></div>
                <div class="lesson-card" onclick="openLevelMap('animals')"><i class="fa-solid fa-paw" style="color:#e17055;"></i><b>Hayvanlar</b><small style="color:var(--success);">10 Seviye</small></div>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item" onclick="nav('s-home')"><i class="fa-solid fa-house"></i>Ev</div>
            <div class="nav-item active" onclick="nav('s-lessons')"><i class="fa-solid fa-book"></i>Ders</div>
            <div class="nav-item" onclick="nav('s-challenges')"><i class="fa-solid fa-hammer"></i>Yap</div>
            <div class="nav-item" onclick="nav('s-rewards')"><i class="fa-solid fa-user"></i>Ben</div>
        </div>
    </div>

    <!-- EKRAN 6: LEVEL MAP -->
    <div id="s-level-map" class="screen">
        <div class="header"><div class="back-btn" onclick="nav('s-lessons')"><i class="fa-solid fa-chevron-left"></i></div><h3 id="map-title">Matematik</h3><div style="width:40px;"></div></div>
        <div class="scroll-content" style="text-align:center;">
            <div style="background:white; padding:25px; border-radius:30px; margin-bottom:25px; box-shadow:var(--shadow-md); border:2px solid white;"><i class="fa-solid fa-star" style="color:var(--gold); font-size:3rem; margin-bottom:15px;"></i><p style="font-size:1.1rem; font-weight:600;">Sƒ±rayla t√ºm yƒ±ldƒ±zlarƒ± topla!</p></div>
            <div class="level-map" id="level-grid-container"></div>
        </div>
    </div>

    <!-- EKRAN 7: QUIZ -->
    <div id="s-quiz" class="screen">
        <div class="header"><div class="back-btn" onclick="nav('s-level-map')"><i class="fa-solid fa-xmark" style="color:var(--danger);"></i></div><h3 id="quiz-level-ind">Level 1</h3><div style="width:40px;"></div></div>
        <div class="scroll-content" style="display:flex; flex-direction:column; justify-content:center; padding-top:40px;">
            <div class="quiz-timer"><div class="quiz-timer-fill" id="timer-bar"></div></div>
            <div style="text-align:center; margin-bottom:50px;"><h1 style="font-size:4rem; color:var(--text-main); margin-bottom:15px; font-weight:800;" id="quiz-question">?</h1><p style="font-size:1.2rem;">Doƒüru cevabƒ± se√ß!</p></div>
            <div class="options-grid" id="quiz-options" style="display:grid; grid-template-columns:1fr 1fr; gap:15px;"></div>
            <div class="buddy-corner">
                <div class="buddy-bubble" id="quiz-buddy-msg">Ba≈üarƒ±lar!</div>
                <img id="quiz-buddy" src="avatar1.png" class="buddy-avatar-small" onerror="this.style.display='none'">
            </div>
        </div>
    </div>

    <!-- EKRAN 8: REHBERLER -->
    <div id="s-challenges" class="screen">
        <div class="header"><h3>Rehberler</h3></div>
        <div class="scroll-content">
            <p class="mb-20">Kutundaki malzemeleri kullanarak ≈üunlarƒ± yap:</p>
            <div class="card" onclick="startGuide('flower')" style="padding:0; min-height:auto;">
                <div style="height:150px; width:100%; background:#ffeaa7; display:flex; align-items:center; justify-content:center; font-size:6rem;">üå∏</div>
                <div style="padding:25px; width:100%; display:flex; align-items:center; justify-content:space-between;"><div><h3 style="margin:0;">√ái√ßek Yap</h3><p style="margin:5px 0 0 0; font-weight:600;">5 Adƒ±m ‚Ä¢ Kolay</p></div><button class="btn-primary" style="width:auto; padding:10px 25px;">Ba≈üla</button></div>
            </div>
            <div class="card" onclick="startGuide('castle')" style="padding:0; min-height:auto;">
                <div style="height:150px; width:100%; background:#74b9ff; display:flex; align-items:center; justify-content:center; font-size:6rem;">üè∞</div>
                <div style="padding:25px; width:100%; display:flex; align-items:center; justify-content:space-between;"><div><h3 style="margin:0;">Kale Yap</h3><p style="margin:5px 0 0 0; font-weight:600;">2 Adƒ±m ‚Ä¢ Orta</p></div><button class="btn-primary" style="width:auto; padding:10px 25px;">Ba≈üla</button></div>
            </div>
             <div class="card" onclick="startGuide('animal')" style="padding:0; min-height:auto;">
                <div style="height:150px; width:100%; background:#a29bfe; display:flex; align-items:center; justify-content:center; font-size:6rem;">ü¶Å</div>
                <div style="padding:25px; width:100%; display:flex; align-items:center; justify-content:space-between;"><div><h3 style="margin:0;">Hayvan Yap</h3><p style="margin:5px 0 0 0; font-weight:600;">1 Adƒ±m ‚Ä¢ Kolay</p></div><button class="btn-primary" style="width:auto; padding:10px 25px;">Ba≈üla</button></div>
            </div>
             <div class="card" onclick="startGuide('rocket')" style="padding:0; min-height:auto;">
                <div style="height:150px; width:100%; background:#0984e3; display:flex; align-items:center; justify-content:center; font-size:6rem;">üöÄ</div>
                <div style="padding:25px; width:100%; display:flex; align-items:center; justify-content:space-between;"><div><h3 style="margin:0;">Roket Yap</h3><p style="margin:5px 0 0 0; font-weight:600;">3 Adƒ±m ‚Ä¢ Zor</p></div><button class="btn-primary" style="width:auto; padding:10px 25px;">Ba≈üla</button></div>
            </div>
             <div class="card" onclick="startGuide('pizza')" style="padding:0; min-height:auto;">
                <div style="height:150px; width:100%; background:#e17055; display:flex; align-items:center; justify-content:center; font-size:6rem;">üçï</div>
                <div style="padding:25px; width:100%; display:flex; align-items:center; justify-content:space-between;"><div><h3 style="margin:0;">Pizza Yap</h3><p style="margin:5px 0 0 0; font-weight:600;">4 Adƒ±m ‚Ä¢ Orta</p></div><button class="btn-primary" style="width:auto; padding:10px 25px;">Ba≈üla</button></div>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item" onclick="nav('s-home')"><i class="fa-solid fa-house"></i>Ev</div>
            <div class="nav-item" onclick="nav('s-lessons')"><i class="fa-solid fa-book"></i>Ders</div>
            <div class="nav-item active" onclick="nav('s-challenges')"><i class="fa-solid fa-hammer"></i>Yap</div>
            <div class="nav-item" onclick="nav('s-rewards')"><i class="fa-solid fa-user"></i>Ben</div>
        </div>
    </div>

    <!-- EKRAN 9: GUIDE ADIMLARI -->
    <div id="s-guide-steps" class="screen">
        <div class="header"><div class="back-btn" onclick="nav('s-challenges')"><i class="fa-solid fa-xmark"></i></div><h3 id="guide-step-header">Adƒ±m 1/5</h3><div style="width:40px;"></div></div>
        <div class="scroll-content" style="text-align:center;">
            <div class="step-progress"><div class="progress-bar"><div class="progress-fill" id="p-fill"></div></div></div>
            <div class="step-image-box"><div class="guide-label">√ñrnek</div><img id="guide-example-img" src="" alt="√ñrnek" onerror="this.src='https://placehold.co/400x200?text=Ornek+Yok';"></div>
            <div class="step-image-box" id="guide-user-box" style="display:none; border-color:var(--primary); height:220px;"><div class="guide-label user"><i class="fa-solid fa-user"></i> Senin Eserin</div><img id="guide-user-img" src=""></div>
            <div style="text-align:center; margin:25px 0;"><h2 id="guide-step-title" style="margin-bottom:10px;">Ba≈ülƒ±k</h2><p id="guide-step-desc">A√ßƒ±klama</p></div>
            <div class="step-upload-btn" onclick="document.getElementById('guide-file-input').click()"><i class="fa-solid fa-camera" style="font-size:2rem; margin-bottom:10px; color:var(--text-muted);"></i><div style="font-weight:700;">Fotoƒüraf √áek / Y√ºkle</div><small>Devam etmek i√ßin y√ºklemelisin</small></div>
            <input type="file" id="guide-file-input" style="display:none;" accept="image/*" onchange="handlePhotoUpload(this)">
            <div style="display:flex; gap:15px; margin-top:30px;">
                <button class="btn-secondary" style="flex:1;" onclick="prevStep()">Geri</button>
                <button class="btn-primary" style="flex:2;" id="btn-guide-next" onclick="nextStep()">ƒ∞leri <i class="fa-solid fa-arrow-right"></i></button>
            </div>
        </div>
    </div>

    <div id="s-guide-success" class="screen" style="text-align:center; padding:30px;">
        <div style="margin-top:40px; margin-bottom:20px;">
            <div style="width:120px; height:120px; background:var(--success); border-radius:50%; display:flex; align-items:center; justify-content:center; color:white; font-size:3.5rem; margin:0 auto; animation:popIn 0.5s; box-shadow:0 10px 30px rgba(0,184,148,0.4);"><i class="fa-solid fa-check"></i></div>
        </div>
        <h1 style="font-size:2.5rem; margin-bottom:10px;">Harika ƒ∞≈ü!</h1><p>ƒ∞≈üte yaratƒ±cƒ±lƒ±ƒüƒ±nƒ±n hikayesi:</p>
        <div class="scroll-content" style="flex:1; padding:20px 0;"><div class="summary-grid" id="summary-grid" style="display:flex; flex-direction:column; gap:15px;"></div></div>
        <div style="padding:20px 0;"><button class="btn-primary" onclick="claimGuideReward()">√ñd√ºl√ºn√º Al (+50 XP) <i class="fa-solid fa-gift"></i></button></div>
    </div>

    <div id="s-rewards" class="screen">
        <div class="scroll-content" style="padding:0;">
            <div class="profile-card">
                <div class="profile-bg-pattern"></div>
                <div style="position:relative; z-index:2;">
                    <img id="profile-avatar-main" src="avatar1.png" class="profile-avatar-lg" onerror="this.src='https://placehold.co/100x100?text=A';">
                    <h2 id="profile-name-main">ƒ∞simsiz</h2><p style="margin:5px 0; opacity:0.8;">Usta Yaratƒ±cƒ±</p>
                    <div class="stat-row">
                        <div class="stat-box"><span class="stat-val" id="profile-lvl">1</span><span class="stat-lbl">Seviye</span></div>
                        <div class="stat-box"><span class="stat-val" id="profile-xp">0</span><span class="stat-lbl">Toplam XP</span></div>
                    </div>
                </div>
            </div>
            <div style="padding:0 25px;">
                <h3 style="border-left:5px solid var(--success); padding-left:15px; margin-bottom:20px;">√ñd√ºl D√ºkkanƒ±</h3>
                <div class="card" style="padding:0;">
                    <div class="shop-item">
                        <div style="display:flex; align-items:center;"><div class="shop-icon" style="color:#e84393;">üéÅ</div><div><b>%15 ƒ∞ndirim Kodu</b><br><small style="color:var(--text-muted);">Squishables Maƒüazasƒ±</small></div></div>
                        <button class="btn-action" onclick="redeemReward(500)">500 XP</button>
                    </div>
                    <div class="shop-item">
                        <div style="display:flex; align-items:center;"><div class="shop-icon" style="color:#0984e3;">üß¢</div><div><b>√ñzel Avatar</b><br><small style="color:var(--text-muted);">Kilitli i√ßerik</small></div></div>
                        <button class="btn-action" style="background:#ccc;">1000 XP</button>
                    </div>
                </div>
                <h3 style="border-left:5px solid var(--gold); padding-left:15px; margin-top:40px; margin-bottom:20px;">Haftalƒ±k Sƒ±ralama</h3>
                <div class="card" style="padding:0; overflow:hidden;">
                    <div class="leaderboard-list">
                        <div class="shop-item" style="background:#fff9c4;"><div style="display:flex; align-items:center;"><b style="margin-right:15px; color:var(--gold); font-size:1.4rem;">1</b><img src="avatar2.png" style="width:45px; height:45px; border-radius:50%; margin-right:15px;"><span>Ay≈üe</span></div><b>1500 XP</b></div>
                        <div class="shop-item"><div style="display:flex; align-items:center;"><b style="margin-right:15px; color:silver; font-size:1.4rem;">2</b><img src="avatar3.png" style="width:45px; height:45px; border-radius:50%; margin-right:15px;"><span>Ali</span></div><b>1250 XP</b></div>
                        <div class="shop-item" style="background:#f0fdf4; border-left:5px solid var(--success);"><div style="display:flex; align-items:center;"><b style="margin-right:15px; font-size:1.4rem;">3</b><img id="lb-my-avatar" src="avatar1.png" style="width:45px; height:45px; border-radius:50%; margin-right:15px;"><span id="lb-my-name">Sen</span></div><b id="lb-my-score">0 XP</b></div>
                    </div>
                </div>
                <h3 style="border-left:5px solid var(--primary-dark); padding-left:15px; margin-top:40px; margin-bottom:20px;">Koleksiyonun</h3>
                <div class="badge-grid" id="badge-container"></div>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item" onclick="nav('s-home')"><i class="fa-solid fa-house"></i>Ev</div>
            <div class="nav-item" onclick="nav('s-lessons')"><i class="fa-solid fa-book"></i>Ders</div>
            <div class="nav-item" onclick="nav('s-challenges')"><i class="fa-solid fa-hammer"></i>Yap</div>
            <div class="nav-item active" onclick="nav('s-rewards')"><i class="fa-solid fa-user"></i>Ben</div>
        </div>
    </div>
</div>

<!-- ===================== JAVASCRIPT (MANTIK) ===================== -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
    // --- STATE ---
    let appData = { name: "Misafir", avatar: "avatar1.png", xp: 0, level: 1, buddy: null, unlockedLevels: { math: 1, colors: 1, shapes: 1, music: 1, space: 1, animals: 1 } };

    // --- BOOT ---
    window.onload = function() {
        try {
            const saved = localStorage.getItem('squish_data_final_v25');
            if(saved) {
                appData = JSON.parse(saved);
                nav('s-home');
            } else {
                nav('s-splash');
                setTimeout(() => nav('s-onboarding'), 2000);
            }
            updateUI();
        } catch(e) { console.error(e); nav('s-profile-create'); }
    };

    function saveData() { localStorage.setItem('squish_data_final_v25', JSON.stringify(appData)); updateUI(); }

    // --- DEV QUESTION BANK (600+ Lines Equivalent Logic) ---
    const qBank = {
        math: (lvl) => {
            // Ger√ßek√ßi Matematik Mantƒ±ƒüƒ±:
            // Lvl 1-3: Toplama (Basit) | Lvl 4-6: √áƒ±karma | Lvl 7-10: Karƒ±≈üƒ±k ve B√ºy√ºk Sayƒ±lar
            let n1, n2, q, c;
            if(lvl <= 3) { n1=Math.floor(Math.random()*5)+1; n2=Math.floor(Math.random()*5)+1; q=`${n1} + ${n2} = ?`; c=n1+n2; }
            else if(lvl <= 6) { n1=Math.floor(Math.random()*10)+5; n2=Math.floor(Math.random()*5)+1; q=`${n1} - ${n2} = ?`; c=n1-n2; }
            else { n1=Math.floor(Math.random()*10)+10; n2=Math.floor(Math.random()*10)+1; let op=Math.random()>0.5?'+':'-'; 
                   if(op=='-' && n2>n1) {let t=n1;n1=n2;n2=t;} c=eval(`${n1}${op}${n2}`); q=`${n1} ${op} ${n2} = ?`; }
            
            let a = [c];
            while(a.length<4){ let r=c+Math.floor(Math.random()*5)-2; if(r>=0 && !a.includes(r)) a.push(r); }
            return { q, c, a: a.sort(()=>Math.random()-0.5) };
        },
        colors: (lvl) => {
            const d = [
                {n:'Kƒ±rmƒ±zƒ±',v:'üü•'},{n:'Mavi',v:'üü¶'},{n:'Sarƒ±',v:'üü®'},{n:'Ye≈üil',v:'üü©'},{n:'Turuncu',v:'üüß'},{n:'Mor',v:'üü™'},
                {n:'Siyah',v:'‚¨õ'},{n:'Beyaz',v:'‚¨ú'},{n:'Kahverengi',v:'üü´'}
            ];
            let t = d[Math.floor(Math.random()*Math.min(lvl+2, d.length))];
            return { q: `Hangisi ${t.n}?`, c: t.v, a: [t.v, ...d.filter(x=>x.v!=t.v).slice(0,3).map(x=>x.v)].sort(()=>Math.random()-0.5) };
        },
        shapes: (lvl) => {
             const d = [{n:'Kare',v:'‚¨õ'},{n:'Daire',v:'üîµ'},{n:'√ú√ßgen',v:'üî∫'},{n:'Yƒ±ldƒ±z',v:'‚≠ê'},{n:'Kalp',v:'‚ù§Ô∏è'},{n:'Elmas',v:'üî∂'}];
             let t = d[Math.floor(Math.random()*d.length)];
             return { q: `${t.n} hangisi?`, c: t.v, a: [t.v, ...d.filter(x=>x.v!=t.v).slice(0,3).map(x=>x.v)].sort(()=>Math.random()-0.5) };
        },
        space: (lvl) => {
             const d = [{n:'Roket',v:'üöÄ'},{n:'D√ºnya',v:'üåç'},{n:'Ay',v:'üåô'},{n:'G√ºne≈ü',v:'‚òÄÔ∏è'},{n:'Uzaylƒ±',v:'üëΩ'},{n:'Sat√ºrn',v:'ü™ê'},{n:'Meteor',v:'‚òÑÔ∏è'},{n:'Teleskop',v:'üî≠'}];
             let t = d[Math.floor(Math.random()*d.length)];
             return { q: `${t.n} nerede?`, c: t.v, a: [t.v, ...d.filter(x=>x.v!=t.v).slice(0,3).map(x=>x.v)].sort(()=>Math.random()-0.5) };
        },
        music: (lvl) => {
             const d = [{n:'Gitar',v:'üé∏'},{n:'Piyano',v:'üéπ'},{n:'Davul',v:'ü•Å'},{n:'Keman',v:'üéª'},{n:'Trompet',v:'üé∫'},{n:'Mikrofon',v:'üé§'},{n:'Kulaklƒ±k',v:'üéß'},{n:'Nota',v:'üéµ'}];
             let t = d[Math.floor(Math.random()*d.length)];
             return { q: `${t.n} hangisi?`, c: t.v, a: [t.v, ...d.filter(x=>x.v!=t.v).slice(0,3).map(x=>x.v)].sort(()=>Math.random()-0.5) };
        },
        animals: (lvl) => {
             const d = [{n:'Kedi',v:'üê±'},{n:'K√∂pek',v:'üê∂'},{n:'Aslan',v:'ü¶Å'},{n:'Maymun',v:'üêµ'},{n:'Panda',v:'üêº'},{n:'Tav≈üan',v:'üê∞'},{n:'Ayƒ±',v:'üêª'},{n:'Koala',v:'üê®'}];
             let t = d[Math.floor(Math.random()*d.length)];
             return { q: `${t.n} bul!`, c: t.v, a: [t.v, ...d.filter(x=>x.v!=t.v).slice(0,3).map(x=>x.v)].sort(()=>Math.random()-0.5) };
        }
    };

    // --- CORE LOGIC ---
    function updateUI() {
        document.querySelectorAll('#home-name, #home-name-display, #profile-name-main, #lb-my-name').forEach(e => e.innerText = appData.name);
        document.querySelectorAll('#home-header-avatar, #profile-avatar-main, #lb-my-avatar').forEach(e => e.src = appData.avatar);
        
        const bImg = document.getElementById('quiz-buddy');
        const pImg = document.getElementById('lesson-buddy-preview');
        if(appData.buddy) { 
            if(bImg) { bImg.src = appData.buddy; bImg.style.display='block'; }
            if(pImg) pImg.src = appData.buddy; 
        } else {
            if(bImg) bImg.style.display='none';
        }

        document.getElementById('home-lvl').innerText = appData.level;
        document.getElementById('home-xp').innerText = appData.xp;
        document.getElementById('home-xp-bar').style.width = (appData.xp%100)+'%';
        document.getElementById('profile-lvl').innerText = appData.level;
        document.getElementById('profile-xp').innerText = appData.xp;
        document.getElementById('lb-my-score').innerText = appData.xp + " XP";
        
        renderBadges();
    }

    function renderBadges() {
        const c = document.getElementById('badge-container'); if(!c) return;
        c.innerHTML = "";
        const badges = [
            {t:"ƒ∞lk Adƒ±m", i:"ü•á", u:true}, {t:"Usta Yapƒ±cƒ±", i:"üõ†Ô∏è", u:appData.xp>200}, {t:"Sanat√ßƒ±", i:"üé®", u:appData.xp>500},
            {t:"Matematik√ßi", i:"üßÆ", u:appData.level>3}, {t:"Uzay Ka≈üifi", i:"üöÄ", u:appData.level>5}, {t:"Doƒüa Dostu", i:"üåø", u:appData.level>8}
        ];
        badges.forEach(b => {
            const d = document.createElement('div'); d.className = `badge-item ${b.u?'unlocked':''}`;
            d.onclick=()=>openBadgeModal(b.t,"Ba≈üarƒ±ldƒ±!",b.i,b.u?'Kazanƒ±ldƒ±':'Kilitli');
            d.innerHTML=`<span class="badge-icon">${b.i}</span><small>${b.t}</small>`;
            c.appendChild(d);
        });
    }

    function nav(id) {
        document.querySelectorAll('.screen').forEach(s => { s.classList.remove('active'); s.style.display='none'; });
        const t = document.getElementById(id); t.style.display='flex';
        setTimeout(()=>t.classList.add('active'),10);
        document.querySelectorAll('.nav-item').forEach(i=>i.classList.remove('active'));
        if(id=='s-home')updateNav(0); else if(id=='s-lessons')updateNav(1);
        else if(id=='s-challenges')updateNav(2); else if(id=='s-rewards')updateNav(3);
    }
    function updateNav(i) { document.querySelectorAll('.nav-item')[i].classList.add('active'); }

    function saveProfileAndStart() {
        const n = document.getElementById('inp-name').value;
        if(n.trim()) appData.name = n;
        saveData(); showToast(`Ho≈ü Geldin ${appData.name}!`, 'success'); nav('s-home');
    }
    function pickAvatar(el, src) {
        document.querySelectorAll('.avatar-opt').forEach(a=>a.classList.remove('selected'));
        el.classList.add('selected'); appData.avatar = src;
    }

    function redeemReward(c) {
        if(appData.xp >= c) {
            if(confirm(c+" XP harcansƒ±n mƒ±?")) { appData.xp-=c; saveData(); showToast("Kod: SQUISH15", "success"); launchConfetti(); }
        } else showToast("Yetersiz Puan", "error");
    }

    function handleBuddy(i) {
        if(i.files[0]) {
            const r = new FileReader();
            r.onload = e => { appData.buddy = e.target.result; saveData(); showToast("Arkada≈üƒ±n Eklendi!", "success"); }
            r.readAsDataURL(i.files[0]);
        }
    }

    let currentLesson = '';
    function openLevelMap(id) {
        currentLesson = id;
        document.getElementById('map-title').innerText = id.toUpperCase();
        const c = document.getElementById('level-grid-container'); c.innerHTML = "";
        const u = appData.unlockedLevels[id] || 1;
        for(let i=1; i<=10; i++) {
            const d = document.createElement('div');
            let s = i<=u ? (i<u?"completed":"unlocked") : "locked";
            d.className = `level-node ${s}`;
            d.innerText = i;
            d.onclick = () => { if(s!=='locked') startQuiz(i); else showToast("Kilitli!", "error"); }
            c.appendChild(d);
        }
        nav('s-level-map');
    }

    function startQuiz(lvl) {
        const qData = qBank[currentLesson](lvl);
        document.getElementById('quiz-question').innerText = qData.q;
        document.getElementById('quiz-level-ind').innerText = `Level ${lvl}`;
        const g = document.getElementById('quiz-options'); g.innerHTML = "";
        qData.a.forEach(opt => {
            const b = document.createElement('div'); b.className = 'option-btn'; b.innerText = opt;
            b.onclick = () => {
                if(opt == qData.c) {
                    b.style.background = "var(--success)"; b.style.color="white";
                    document.getElementById('quiz-buddy-msg').innerText = "Harika!";
                    playSound('success');
                    setTimeout(() => {
                        if(lvl===appData.unlockedLevels[currentLesson]) appData.unlockedLevels[currentLesson]++;
                        appData.xp+=15; saveData(); launchConfetti(); openLevelMap(currentLesson);
                    }, 1000);
                } else {
                    b.style.background = "var(--danger)"; b.style.color="white";
                    document.getElementById('quiz-buddy-msg').innerText = "Tekrar dene!";
                }
            };
            g.appendChild(b);
        });
        nav('s-quiz');
    }

    // --- REHBERLER ---
    const guides = {
        flower: { steps: [{t:"Merkez", d:"Yap", i:"cicek_adim1.jpg"}, {t:"Yapraklar", d:"Yap", i:"cicek_adim2.jpg"}, {t:"Birle≈ütir", d:"Yap", i:"cicek_adim3.jpg"}, {t:"Sap", d:"Yap", i:"cicek_adim4.jpg"}, {t:"Son", d:"Bitir", i:"cicek_adim5.jpg"}] },
        castle: { steps: [{t:"Taban", d:"Yap", i:"kale_adim1.jpg"}, {t:"Kule", d:"Yap", i:"kale_adim2.jpg"}] },
        animal: { steps: [{t:"G√∂vde", d:"Yap", i:"hayvan_adim1.jpg"}] },
        rocket: { steps: [{t:"G√∂vde", d:"Yap", i:"roket.jpg"}] },
        pizza: { steps: [{t:"Hamur", d:"Yap", i:"pizza.jpg"}] }
    };
    let ag=null, gIdx=0, gPhoto=null;

    function startGuide(k) { ag=guides[k]; gIdx=0; renderStep(); nav('s-guide-steps'); }
    function renderStep() {
        const s = ag.steps[gIdx];
        document.getElementById('guide-step-header').innerText = `Adƒ±m ${gIdx+1}`;
        document.getElementById('guide-step-title').innerText = s.t;
        document.getElementById('guide-step-desc').innerText = s.d;
        document.getElementById('guide-example-img').src = s.i;
        gPhoto = null; document.getElementById('guide-user-box').style.display='none';
        document.getElementById('btn-guide-next').innerText = (gIdx===ag.steps.length-1) ? "Bitir" : "ƒ∞leri";
    }
    function handlePhotoUpload(i) {
        if(i.files[0]) {
            const r = new FileReader();
            r.onload = e => { gPhoto=e.target.result; document.getElementById('guide-user-img').src=gPhoto; document.getElementById('guide-user-box').style.display='flex'; }
            r.readAsDataURL(i.files[0]);
        }
    }
    function nextStep() {
        if(!gPhoto) return showToast("Fotoƒüraf y√ºkle!", "error");
        if(gIdx<ag.steps.length-1) { gIdx++; renderStep(); }
        else { appData.xp+=50; saveData(); launchConfetti(); nav('s-rewards'); showToast("Tebrikler!", "success"); }
    }
    function prevStep() { if(gIdx>0) { gIdx--; renderStep(); } else nav('s-challenges'); }

    // --- UTILS ---
    function showToast(m, t) {
        const b = document.getElementById('toast-container'); const d = document.createElement('div');
        d.className = `toast ${t}`; d.innerHTML = (t=='success'?'<i class="fa-solid fa-check"></i> ':'') + m;
        b.appendChild(d); setTimeout(()=>d.classList.add('show'),10); setTimeout(()=>{d.classList.remove('show'); setTimeout(()=>d.remove(),300);},3000);
    }
    function playSound(type) { /* Browser policy gereƒüi bo≈ü bƒ±rakƒ±ldƒ±, eklenebilir */ }
    function closeModal(id) { document.getElementById(id).style.display='none'; }
    function openFriendModal(n, l, i) { document.getElementById('m-friend-name').innerText=n; document.getElementById('friend-modal').style.display='flex'; }
    function openBadgeModal(t, d, i, s) { document.getElementById('m-badge-title').innerText=t; document.getElementById('badge-modal').style.display='flex'; }
    function resetProgress() { localStorage.removeItem('squish_data_final_v25'); location.reload(); }
    function toggleSetting(el) { el.classList.toggle('fa-toggle-on'); el.classList.toggle('fa-toggle-off'); el.style.color = el.classList.contains('fa-toggle-on') ? 'var(--success)' : '#ccc'; }
    function launchConfetti() { confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } }); }

</script>

</body>
</html>
