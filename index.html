<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Squishables</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#DCD6F7">
    <link rel="apple-touch-icon" href="logo.png">

    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- 1. CSS VARIABLES & RESET --- */
        :root {
            --theme-color: #C4DFD9;
            --mint: #C4DFD9; --dark-mint: #2e5c4d;
            --peach: #FFD1BA; --dark-peach: #d68c6d;
            --purple: #DCD6F7; --dark-purple: #424874;
            --bg-color: #eef2f5;
            --white: #ffffff;
            --gold: #FFD700;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { margin: 0; padding: 0; font-family: 'Nunito', sans-serif; background-color: var(--bg-color); display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }

        /* --- 2. APP FRAME --- */
        #app-frame {
            width: 375px; height: 812px; background-color: var(--white);
            border-radius: 40px; position: relative; overflow: hidden;
            box-shadow: 0 30px 60px rgba(0,0,0,0.3); border: 8px solid #222;
        }
        .notch { position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 150px; height: 30px; background: #222; border-radius: 0 0 20px 20px; z-index: 999; }

        /* --- 3. TOAST & CONFETTI --- */
        #toast-container { position: absolute; top: 50px; left: 50%; transform: translateX(-50%); z-index: 2000; width: 90%; pointer-events: none; }
        .toast {
            background: #333; color: white; padding: 12px 20px; border-radius: 30px; text-align: center; margin-bottom: 10px;
            opacity: 0; transform: translateY(-20px); transition: all 0.3s ease; font-size: 0.9rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .toast.show { opacity: 1; transform: translateY(0); }
        .toast.success { background: var(--dark-mint); }
        .toast.level-up { background: var(--purple); color: var(--dark-purple); font-weight: bold; }

        #confetti-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1500; }

        /* --- 4. SCREENS --- */
        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: white; display: none; flex-direction: column;
            padding-top: 40px; animation: fadeIn 0.3s ease; z-index: 10;
        }
        .screen.active { display: flex; }
        .scroll-content { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 90px; }
        .scroll-content::-webkit-scrollbar { display: none; }

        /* --- 5. COMPONENTS --- */
        h1, h2, h3 { font-family: 'Fredoka', sans-serif; color: #333; margin: 10px 0; }
        p { color: #888; font-size: 0.9rem; line-height: 1.5; margin-top: 0; }

        .btn-primary {
            background: var(--theme-color); color: #333; border: none; padding: 15px; width: 100%;
            border-radius: 30px; font-size: 1.1rem; font-weight: bold; cursor: pointer;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1); margin-top: auto; transition: 0.2s;
        }
        .btn-primary:active { transform: scale(0.98); }
        .btn-secondary { background: #eee; color: #555; box-shadow: none; }

        .btn-action { padding: 8px 15px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; font-size: 0.8rem; margin-left: auto; }
        .btn-green { background: #C1E1C1; color: #2d5a2d; }
        .btn-peach { background: #FFD1BA; color: #8f5e41; }
        .btn-purple { background: #DCD6F7; color: #5a4b8f; }

        .card {
            background: white; border-radius: 20px; padding: 15px; margin-bottom: 15px;
            display: flex; align-items: center; gap: 15px; border: 1px solid #f0f0f0;
            box-shadow: 0 3px 8px rgba(0,0,0,0.03); cursor: pointer; transition: 0.2s;
        }
        .card:active { transform: scale(0.98); background: #fafafa; }
        .icon-box { width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: white; flex-shrink: 0; }

        .header { display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; background:white; border-bottom: 1px solid #f9f9f9; }

        /* --- 6. SPECIFIC SCREENS --- */
        
        /* Onboarding */
        .onboard-img { width: 140px; height: 140px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 4rem; color: white; margin: 40px auto; }
        .dots { display: flex; justify-content: center; gap: 8px; margin-bottom: 20px; }
        .dot { width: 10px; height: 10px; background: #eee; border-radius: 50%; }
        .dot.active { background: #333; }

        /* Profil */
        .input-group { margin-bottom: 15px; }
        .custom-input { width: 100%; padding: 15px; background: #f9f9f9; border: 1px solid #eee; border-radius: 15px; margin-bottom: 10px; font-family: 'Nunito'; font-size: 1rem; }
        .color-picker { display: flex; gap: 15px; margin-top: 5px; }
        .color-opt { width: 50px; height: 50px; border-radius: 50%; cursor: pointer; border: 3px solid transparent; }
        .color-opt.selected { border-color: #333; transform: scale(1.1); }
        .toggle-switch { width: 50px; height: 26px; background: #eee; border-radius: 13px; position: relative; cursor: pointer; transition: 0.3s; }
        .toggle-switch.active { background: var(--theme-color); }
        .toggle-knob { width: 22px; height: 22px; background: white; border-radius: 50%; position: absolute; top: 2px; left: 2px; transition: 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .toggle-switch.active .toggle-knob { left: 26px; }

        /* Home Dashboard (Level Bar) */
        .level-container { width: 100%; background: #eee; height: 8px; border-radius: 4px; margin-top: 5px; overflow: hidden; }
        .level-fill { height: 100%; background: var(--theme-color); width: 0%; transition: width 0.5s ease; }
        
        .dash-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .dash-item { background: white; padding: 15px; border-radius: 20px; text-align: center; border: 1px solid #f0f0f0; box-shadow: 0 3px 8px rgba(0,0,0,0.03); cursor: pointer; }
        .recent-scroll { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; margin-top: 10px; }
        .recent-item { min-width: 80px; background: white; border-radius: 15px; padding: 10px; text-align: center; border: 1px solid #eee; cursor: pointer; transition: 0.2s; }
        .recent-item:active { transform: scale(0.95); background: #f0f0f0; }

        /* Build Guide */
        .progress-bar { width: 100%; height: 6px; background: #eee; border-radius: 3px; margin-bottom: 20px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--theme-color); width: 0%; transition: width 0.3s ease; }
        .step-image-box { 
            width: 100%; height: 220px; background: #f9f9f9; border-radius: 20px; margin-bottom: 20px;
            display: flex; align-items: center; justify-content: center; font-size: 4rem; color: var(--theme-color); border: 2px dashed #eee; overflow: hidden; position: relative;
        }
        .step-image-box img { width: 100%; height: 100%; object-fit: cover; display: none; }
        .step-upload-btn { background: white; border: 2px dashed #ccc; padding: 20px; border-radius: 15px; cursor: pointer; margin-bottom: 20px; text-align: center; transition: 0.2s; }
        .step-upload-btn:active { background: #f0f0f0; }
        
        /* Summary */
        .summary-card { background: white; padding: 10px; border-radius: 15px; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; border: 1px solid #eee; }
        .summary-thumb { width: 50px; height: 50px; border-radius: 10px; background: #eee; object-fit: cover; }

        /* Upload & Buddy */
        .upload-area { border: 2px dashed #ccc; padding: 30px; border-radius: 20px; text-align: center; cursor: pointer; margin-top: 20px; background: #fafafa; position: relative; }
        #buddy-preview { width: 100%; max-height: 150px; object-fit: contain; display: none; margin-top: 10px; border-radius: 10px; }

        /* Quiz */
        .quiz-content { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .quiz-question { font-size: 3rem; color: var(--dark-purple); margin: 20px 0; text-align: center; font-weight: bold; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; }
        .option-btn { background: white; border: 2px solid #eee; padding: 20px; border-radius: 15px; font-size: 1.5rem; font-weight: bold; color: var(--dark-purple); cursor: pointer; text-align: center; transition: 0.2s; }
        .option-btn:active { transform: scale(0.95); }
        .buddy-corner { position: absolute; bottom: 20px; left: 20px; display: flex; align-items: flex-end; width: 100%; z-index: 20; }
        .buddy-avatar { width: 80px; height: 80px; border-radius: 50%; border: 3px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.1); background: white; object-fit: cover; }
        .speech-bubble { background: white; padding: 12px; border-radius: 15px 15px 15px 0; box-shadow: 0 5px 10px rgba(0,0,0,0.05); font-size: 0.9rem; color: var(--dark-purple); max-width: 200px; margin-bottom: 10px; margin-left: 10px; animation: popIn 0.3s ease; }

        /* Rewards */
        .points-banner { background: linear-gradient(135deg, #FF9A9E 0%, #FECFEF 100%); padding: 30px; border-radius: 25px; text-align: center; color: white; margin-bottom: 20px; position: relative; overflow: hidden; }
        .xp-circle { width: 80px; height: 80px; border: 5px solid rgba(255,255,255,0.5); border-radius: 50%; margin: 0 auto 10px auto; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold; }
        .badge { opacity: 0.5; transition: 0.3s; }
        .badge.unlocked { opacity: 1; transform: scale(1.05); border-color: gold; }
        .leaderboard-item { display: flex; align-items: center; justify-content: space-between; padding: 12px; border-bottom: 1px solid #eee; }

        /* Bottom Nav */
        .bottom-nav { position: absolute; bottom: 0; width: 100%; height: 80px; background: white; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #f0f0f0; padding-bottom: 15px; z-index: 100; }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; color: #ccc; font-size: 0.75rem; cursor: pointer; width: 25%; }
        .nav-item.active { color: var(--theme-color); font-weight: bold; filter: brightness(0.7); }
        .nav-item i { font-size: 1.4rem; }

        @keyframes popIn { from {transform: scale(0);} to {transform: scale(1);} }
        @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
    </style>
</head>
<body>

<div id="app-frame">
    <div class="notch"></div>
    
    <!-- TOAST & CONFETTI -->
    <div id="toast-container"></div>
    <canvas id="confetti-canvas"></canvas>

    <!-- *** 1. SPLASH *** -->
    <div id="s-splash" class="screen active" style="align-items:center; justify-content:center;">
        <img src="logo.png" alt="Logo" style="width:120px; animation:popIn 0.5s;">
        <h1 style="margin-top:20px; color:var(--dark-purple);">Squishables</h1>
    </div>

    <!-- *** 2. ONBOARDING *** -->
    <div id="s-on1" class="screen" style="padding:30px; text-align:center;">
        <div class="onboard-img" style="background:var(--mint);"><i class="fa-solid fa-palette"></i></div>
        <h1>Eller Hamura,<br>Ekranlar Kenara.</h1>
        <p>Duyusal oyunun sihrini keÅŸfet!</p>
        <div class="dots" style="margin-top:auto;"><div class="dot active"></div><div class="dot"></div></div>
        <button class="btn-primary" onclick="nav('s-on2')">Ä°leri</button>
    </div>

    <div id="s-on2" class="screen" style="padding:30px; text-align:center;">
        <div class="onboard-img" style="background:var(--purple);"><i class="fa-solid fa-trophy"></i></div>
        <h1>Ã–ÄŸren & Kazan</h1>
        <p>GÃ¶revleri tamamla, rozetlerin kilidini aÃ§!</p>
        <div class="dots" style="margin-top:auto;"><div class="dot"></div><div class="dot active"></div></div>
        <button class="btn-primary" onclick="nav('s-profile')">BaÅŸla</button>
    </div>

    <!-- *** 3. PROFIL *** -->
    <div id="s-profile" class="screen">
        <div class="header"><i class="fa-solid fa-arrow-left" onclick="nav('s-on2')"></i><h3>Profil</h3><div></div></div>
        <div class="scroll-content">
            <div class="input-group">
                <label>Ã‡ocuk Ä°smi</label>
                <input type="text" id="inp-name" class="custom-input" placeholder="KÃ¼Ã§Ã¼k YaratÄ±cÄ±">
            </div>
            <div class="input-group">
                <label>YaÅŸ</label>
                <input type="number" class="custom-input" placeholder="Ã–rn: 5">
            </div>
            <div class="input-group">
                <label>Favori Renk (Tema)</label>
                <div class="color-picker">
                    <div class="color-opt selected" style="background:#C4DFD9;" onclick="pickColor(this, '#C4DFD9')"></div>
                    <div class="color-opt" style="background:#FFD1BA;" onclick="pickColor(this, '#FFD1BA')"></div>
                    <div class="color-opt" style="background:#DCD6F7;" onclick="pickColor(this, '#DCD6F7')"></div>
                </div>
            </div>
            
            <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">
            
            <div class="input-group">
                <label>Ebeveyn AdÄ±</label>
                <input type="text" class="custom-input" placeholder="Anne/Baba AdÄ±">
            </div>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:10px;">
                <label style="margin:0;">GÃ¼nlÃ¼k HatÄ±rlatÄ±cÄ±</label>
                <div class="toggle-switch active" onclick="this.classList.toggle('active'); showToast('Ayarlar gÃ¼ncellendi!', 'success')">
                    <div class="toggle-knob"></div>
                </div>
            </div>
        </div>
        <div style="padding:20px;">
            <button class="btn-primary" onclick="saveProfile()">Profil OluÅŸtur</button>
        </div>
    </div>

    <!-- *** 4. HOME *** -->
    <div id="s-home" class="screen">
        <div class="header">
            <div><p style="margin:0;">Merhaba,</p><h2 style="margin:0;" id="display-name">YaratÄ±cÄ±</h2></div>
            <div style="background:#FFF3E0; color:orange; padding:5px 10px; border-radius:15px; font-weight:bold;">
                <i class="fa-solid fa-fire"></i> <span id="streak-count">1</span> GÃ¼n
            </div>
        </div>
        <div class="scroll-content">
            <!-- Level Bar -->
            <div style="margin-bottom:20px;">
                <div style="display:flex; justify-content:space-between; font-size:0.8rem; color:#888;">
                    <span>Seviye <span id="level-display">1</span></span>
                    <span id="xp-display">0/100 XP</span>
                </div>
                <div class="level-container"><div class="level-fill" id="xp-bar"></div></div>
            </div>

            <!-- BÃ¼yÃ¼k BaÅŸlat -->
            <div onclick="nav('s-challenges')" style="width:160px; height:160px; background:var(--theme-color); border-radius:50%; margin:0 auto; display:flex; flex-direction:column; justify-content:center; align-items:center; box-shadow:0 10px 30px rgba(0,0,0,0.1); cursor:pointer; transition:0.2s;">
                <h2 style="margin:0; color:#333;">BaÅŸla</h2>
                <p style="color:#333; margin:0;">Aktivite</p>
            </div>

            <div class="dash-grid">
                <div class="dash-item" onclick="nav('s-challenges')">
                    <i class="fa-regular fa-calendar" style="font-size:2rem; color:var(--dark-peach); margin-bottom:10px;"></i>
                    <b>Meydan Okumalar</b>
                </div>
                <div class="dash-item" onclick="nav('s-build')">
                    <i class="fa-solid fa-shapes" style="font-size:2rem; color:var(--dark-mint); margin-bottom:10px;"></i>
                    <b>Ä°nÅŸa Et & Ã–ÄŸren</b>
                </div>
            </div>

            <h3 style="margin-top:20px;">Son Aktiviteler</h3>
            <div class="recent-scroll">
                <div class="recent-item" onclick="setupGuide('flower')">ðŸŒ¸<br><small>Ã‡iÃ§ek</small></div>
                <div class="recent-item" onclick="setupGuide('cake')">ðŸŽ‚<br><small>Pasta</small></div>
                <div class="recent-item" onclick="startLesson('math')">âž•<br><small>Matematik</small></div>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item active" onclick="nav('s-home')"><i class="fa-solid fa-house"></i><span>Ana Sayfa</span></div>
            <div class="nav-item" onclick="nav('s-challenges')"><i class="fa-solid fa-bullseye"></i><span>GÃ¶revler</span></div>
            <div class="nav-item" onclick="nav('s-build')"><i class="fa-solid fa-graduation-cap"></i><span>Ä°nÅŸa Et</span></div>
            <div class="nav-item" onclick="nav('s-rewards')"><i class="fa-solid fa-trophy"></i><span>Ã–dÃ¼ller</span></div>
        </div>
    </div>

    <!-- *** 5. CHALLENGES *** -->
    <div id="s-challenges" class="screen">
        <div class="header"><h3>Meydan Okumalar</h3></div>
        <div class="scroll-content">
            <div class="card" onclick="setupGuide('flower')">
                <div class="icon-box" style="background:var(--mint);"><i class="fa-solid fa-seedling"></i></div>
                <div style="flex:1;"><h3>Ã‡iÃ§ek Yap</h3><p>10 dk â€¢ Kolay</p></div>
                <button class="btn-action btn-green">BaÅŸla</button>
            </div>
            
            <div class="card" onclick="setupGuide('castle')">
                <div class="icon-box" style="background:var(--peach);"><i class="fa-brands fa-fort-awesome"></i></div>
                <div style="flex:1;"><h3>Kale Ä°nÅŸa Et</h3><p>15 dk â€¢ Orta</p></div>
                <button class="btn-action btn-peach">BaÅŸla</button>
            </div>

            <div class="card" onclick="setupGuide('animal')">
                <div class="icon-box" style="background:var(--purple);"><i class="fa-solid fa-paw"></i></div>
                <div style="flex:1;"><h3>Hayvan Yarat</h3><p>12 dk â€¢ Kolay</p></div>
                <button class="btn-action btn-purple">BaÅŸla</button>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item" onclick="nav('s-home')"><i class="fa-solid fa-house"></i><span>Ana Sayfa</span></div>
            <div class="nav-item active" onclick="nav('s-challenges')"><i class="fa-solid fa-bullseye"></i><span>GÃ¶revler</span></div>
            <div class="nav-item" onclick="nav('s-build')"><i class="fa-solid fa-graduation-cap"></i><span>Ä°nÅŸa Et</span></div>
            <div class="nav-item" onclick="nav('s-rewards')"><i class="fa-solid fa-trophy"></i><span>Ã–dÃ¼ller</span></div>
        </div>
    </div>

    <!-- *** 6A. GUIDE INTRO *** -->
    <div id="s-guide-intro" class="screen">
        <div class="header">
            <i class="fa-solid fa-arrow-left" onclick="nav('s-challenges')" style="cursor:pointer;"></i>
            <h3>Rehber BaÅŸlÄ±yor</h3>
            <div></div>
        </div>
        <div class="scroll-content" style="text-align:center; display:flex; flex-direction:column; justify-content:center; height:100%;">
            <div style="font-size:5rem; margin-bottom:20px;" id="intro-icon">ðŸŒ¸</div>
            <h1 id="intro-title">Ã‡iÃ§ek YapÄ±mÄ±</h1>
            <p id="intro-desc">Gerekli malzemeler: Turuncu, Pembe ve YeÅŸil oyun hamuru.</p>
            <div style="margin-top:20px; font-size:1.5rem; font-weight:bold; color:var(--theme-color);">
                <i class="fa-regular fa-clock"></i> <span id="intro-time">10:00</span>
            </div>
            <button class="btn-primary" onclick="startActualGuide()">AdÄ±mlarÄ± BaÅŸlat</button>
        </div>
    </div>

    <!-- *** 6B. GUIDE STEPS *** -->
    <div id="s-guide-steps" class="screen">
        <div class="header">
            <i class="fa-solid fa-xmark" onclick="nav('s-challenges')" style="cursor:pointer;"></i>
            <h3 id="step-header">AdÄ±m 1/4</h3>
            <div></div>
        </div>
        <div class="scroll-content" style="text-align:center;">
            <div class="progress-bar"><div class="progress-fill" id="p-fill"></div></div>

            <div class="step-image-box">
                <i class="fa-solid fa-image" id="step-img-icon"></i>
                <img id="step-uploaded-img">
            </div>

            <h2 id="step-title-text">Top Yuvarla</h2>
            <p id="step-desc-text">BÃ¼yÃ¼k bir parÃ§a al ve yuvarla.</p>

            <div class="step-upload-btn" onclick="document.getElementById('step-file').click()">
                <i class="fa-solid fa-camera" style="font-size:1.5rem; color:var(--dark-purple);"></i>
                <div style="margin-top:5px; font-weight:bold; color:#666;">AdÄ±mÄ± YÃ¼kle</div>
            </div>
            <input type="file" id="step-file" style="display:none;" accept="image/*" onchange="handleStepUpload(this)">

            <div style="margin-top:20px; display:flex; gap:10px;">
                <button class="btn-primary btn-secondary" style="flex:1;" onclick="prevGuideStep()">Geri</button>
                <button class="btn-primary" style="flex:2;" onclick="nextGuideStep()" id="btn-guide-next">Ä°leri</button>
            </div>
        </div>
    </div>

    <!-- *** 6C. GUIDE SUMMARY *** -->
    <div id="s-guide-summary" class="screen">
        <div class="scroll-content" style="text-align:center; padding-top:30px;">
            <div style="width:80px; height:80px; background:#C1E1C1; border-radius:50%; margin:0 auto; display:flex; align-items:center; justify-content:center; font-size:2.5rem; color:white;">
                <i class="fa-solid fa-check"></i>
            </div>
            <h1 style="margin-top:15px;">Harika Ä°ÅŸ!</h1>
            <p>Ä°ÅŸte oluÅŸturduÄŸun ÅŸaheserin aÅŸamalarÄ±:</p>
            
            <div id="summary-grid" style="margin-top:20px;"></div>

            <div style="background:#FFF3E0; padding:15px; border-radius:15px; margin-top:20px;">
                <b style="color:orange;">+50 XP KazanÄ±ldÄ±!</b>
            </div>

            <button class="btn-primary" onclick="nav('s-rewards')">Ã–dÃ¼llerimi GÃ¶r</button>
        </div>
    </div>

    <!-- *** 7. BUILD & LEARN *** -->
    <div id="s-build" class="screen">
        <div class="header"><h3>Ä°nÅŸa Et & Ã–ÄŸren</h3></div>
        <div class="scroll-content">
            <div class="card" onclick="setupGuide('cake')">
                <div class="icon-box" style="background:#FFE5D9; color:#D68C6D;"><i class="fa-solid fa-cake-candles"></i></div>
                <div><b>Pasta Yap</b><p>6 adÄ±m</p></div>
                <button class="btn-action btn-peach">AÃ§</button>
            </div>

            <div class="card" onclick="setupGuide('car')">
                <div class="icon-box" style="background:#D4EDDA; color:#3B6B3B;"><i class="fa-solid fa-car"></i></div>
                <div><b>Araba Yap</b><p>8 adÄ±m</p></div>
                <button class="btn-action btn-green">AÃ§</button>
            </div>

            <h3 style="margin-top:20px;">Ã‡alÄ±ÅŸma ArkadaÅŸÄ± ðŸŽ“</h3>
            <p>Derslerin kilidini aÃ§mak iÃ§in hamur karakterini yÃ¼kle!</p>
            
            <div class="upload-area" onclick="document.getElementById('buddy-file').click()">
                <div id="buddy-placeholder">
                    <i class="fa-solid fa-camera" style="font-size:2rem; color:#ccc;"></i>
                    <p>Karakterini YÃ¼kle</p>
                </div>
                <img id="buddy-main-preview" style="width:100%; max-height:150px; object-fit:contain; display:none; border-radius:10px;">
            </div>
            <input type="file" id="buddy-file" style="display:none;" accept="image/*" onchange="loadMainBuddy(this)">

            <!-- DERSLER -->
            <div id="lessons-area" style="display:none; margin-top:20px;">
                <div class="card" onclick="startLesson('math')">
                    <div class="icon-box" style="background:var(--purple);"><i class="fa-solid fa-calculator"></i></div>
                    <div><b>Matematik</b><p>Toplama & Ã‡Ä±karma</p></div>
                    <i class="fa-solid fa-chevron-right" style="margin-left:auto; color:#ccc;"></i>
                </div>
                <div class="card" onclick="startLesson('colors')">
                    <div class="icon-box" style="background:var(--peach);"><i class="fa-solid fa-palette"></i></div>
                    <div><b>Renkler</b><p>TanÄ±mla & KarÄ±ÅŸtÄ±r</p></div>
                    <i class="fa-solid fa-chevron-right" style="margin-left:auto; color:#ccc;"></i>
                </div>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item" onclick="nav('s-home')"><i class="fa-solid fa-house"></i><span>Ana Sayfa</span></div>
            <div class="nav-item" onclick="nav('s-challenges')"><i class="fa-solid fa-bullseye"></i><span>GÃ¶revler</span></div>
            <div class="nav-item active" onclick="nav('s-build')"><i class="fa-solid fa-graduation-cap"></i><span>Ä°nÅŸa Et</span></div>
            <div class="nav-item" onclick="nav('s-rewards')"><i class="fa-solid fa-trophy"></i><span>Ã–dÃ¼ller</span></div>
        </div>
    </div>

    <!-- *** 8. DERS EKRANI *** -->
    <div id="s-lesson" class="screen" style="z-index:200; background:#F8F9FA;">
        <div style="padding:40px 20px 0 20px; display:flex; justify-content:space-between;">
            <i class="fa-solid fa-xmark" onclick="nav('s-build')" style="font-size:1.5rem; cursor:pointer;"></i>
            <span style="background:var(--purple); padding:5px 10px; border-radius:10px; font-weight:bold;" id="lesson-tag">Ders</span>
        </div>
        <div class="quiz-content">
            <h1 class="quiz-question" id="quiz-q">?</h1>
            <div class="options-grid" id="quiz-opts"></div>
        </div>
        <div class="buddy-corner">
            <img id="lesson-buddy-img" src="logo.png" class="buddy-avatar">
            <div class="speech-bubble" id="buddy-bubble">Hadi baÅŸlayalÄ±m!</div>
        </div>
    </div>

    <!-- *** 9. REWARDS *** -->
    <div id="s-rewards" class="screen">
        <div class="header"><h3>Ã–dÃ¼ller</h3></div>
        <div class="scroll-content">
            <div class="points-banner">
                <div class="xp-circle" id="total-xp">0</div>
                <p>Toplam XP</p>
                <small>Seviye atlamak iÃ§in gÃ¶revleri tamamla!</small>
            </div>
            
            <h3>Rozetler</h3>
            <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:10px; margin-bottom:20px;">
                <div class="card" style="flex-direction:column; padding:10px;" id="badge-1">ðŸ¥‡<br><small>Ä°lk</small></div>
                <div class="card badge" style="flex-direction:column; padding:10px;" id="badge-2">ðŸ”¥<br><small>Seri</small></div>
                <div class="card badge" style="flex-direction:column; padding:10px;" id="badge-3">ðŸŽ¨<br><small>SanatÃ§Ä±</small></div>
            </div>

            <h3>Liderlik Tablosu</h3>
            <div class="card" style="flex-direction:column; align-items:stretch; gap:0; padding:0;">
                <div class="leaderboard-item"><b style="color:gold; width:30px;">1</b> <span style="flex:1;">AyÅŸe</span> <b>1500</b></div>
                <div class="leaderboard-item"><b style="color:silver; width:30px;">2</b> <span style="flex:1;">Mehmet</span> <b>1200</b></div>
                <div class="leaderboard-item" style="background:#f0f0f0;"><b style="width:30px;">3</b> <span style="flex:1;">Sen</span> <b id="lb-score">0</b></div>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item" onclick="nav('s-home')"><i class="fa-solid fa-house"></i><span>Ana Sayfa</span></div>
            <div class="nav-item" onclick="nav('s-challenges')"><i class="fa-solid fa-bullseye"></i><span>GÃ¶revler</span></div>
            <div class="nav-item" onclick="nav('s-build')"><i class="fa-solid fa-graduation-cap"></i><span>Ä°nÅŸa Et</span></div>
            <div class="nav-item active" onclick="nav('s-rewards')"><i class="fa-solid fa-trophy"></i><span>Ã–dÃ¼ller</span></div>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
    /* --- 1. DEÄžÄ°ÅžKENLER --- */
    let xp = 0;
    let level = 1;
    let activeGuideKey = null;
    let guideStepIndex = 0;
    let guidePhotos = [];
    let lessonData = [];
    let qIndex = 0;
    let uploadedGuidePhoto = false;

    /* --- 2. VERÄ°LER --- */
    const guideData = {
        flower: { 
            title: "Ã‡iÃ§ek YapÄ±mÄ±", time: "10:00", icon: "ðŸŒ¸", desc: "Renkli bir Ã§iÃ§ek tasarla.",
            steps: [ { t: "Merkezi Yuvarla", d: "Turuncu hamuru top haline getir." }, { t: "YapraklarÄ± HazÄ±rla", d: "5 kÃ¼Ã§Ã¼k pembe top yap." }, { t: "BirleÅŸtir", d: "YapraklarÄ± merkezin etrafÄ±na diz." }, { t: "Sap Ekle", d: "YeÅŸil hamurdan uzun bir sap yap." } ]
        },
        castle: { 
            title: "Kale YapÄ±mÄ±", time: "15:00", icon: "ðŸ°", desc: "KrallÄ±ÄŸÄ±nÄ± inÅŸa et.",
            steps: [ { t: "Zemin", d: "BÃ¼yÃ¼k bir kare taban oluÅŸtur." }, { t: "Kuleler", d: "KÃ¶ÅŸelere 4 silindir ekle." }, { t: "Duvarlar", d: "Kulelerin arasÄ±nÄ± doldur." }, { t: "Bayrak", d: "En tepeye bayraÄŸÄ±nÄ± dik." } ]
        },
        animal: { title: "Hayvan YapÄ±mÄ±", time: "12:00", icon: "ðŸ¦", desc:"VahÅŸi bir hayvan tasarla.", steps: [{t:"GÃ¶vde", d:"BÃ¼yÃ¼k bir oval yap."}, {t:"Kafa", d:"GÃ¶vdeye kafayÄ± ekle."}, {t:"Detaylar", d:"GÃ¶z, kulak ve kuyruk ekle."}]},
        cake: { title: "Pasta YapÄ±mÄ±", time: "15:00", icon: "ðŸŽ‚", desc:"Lezzetli gÃ¶rÃ¼nen bir pasta.", steps: [{t:"Taban", d:"Yuvarlak bir taban yap."}, {t:"Katlar", d:"KatmanlarÄ± Ã¼st Ã¼ste koy."}, {t:"SÃ¼sleme", d:"Ãœzerine mum ve krema ekle."}]},
        car: { title: "Araba YapÄ±mÄ±", time: "20:00", icon: "ðŸš—", desc:"HÄ±zlÄ± bir yarÄ±ÅŸ arabasÄ±.", steps: [{t:"GÃ¶vde", d:"DikdÃ¶rtgen bir blok yap."}, {t:"Tekerlekler", d:"4 siyah tekerlek ekle."}, {t:"Camlar", d:"Mavi hamurdan camlarÄ± yap."}]}
    };

    const quizData = {
        math: [ { q: "2 + 3 = ?", opt: [4, 5, 6, 1], ans: 5 }, { q: "5 + 5 = ?", opt: [10, 9, 11, 8], ans: 10 } ],
        colors: [ { q: "Hangisi KIRMIZI?", opt: ["ðŸŸ¥", "ðŸŸ¦", "ðŸŸ¨", "ðŸŸ©"], ans: "ðŸŸ¥" }, { q: "Mavi + SarÄ± = ?", opt: ["YeÅŸil", "Mor", "Turuncu", "Siyah"], ans: "YeÅŸil" } ]
    };

    /* --- 3. BAÅžLATMA --- */
    setTimeout(() => nav('s-on1'), 1500);

    /* --- 4. NAVÄ°GASYON & TOAST --- */
    function nav(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        if(id === 's-home') document.querySelectorAll('.nav-item')[0].classList.add('active');
        if(id === 's-challenges') document.querySelectorAll('.nav-item')[1].classList.add('active');
        if(id === 's-build') document.querySelectorAll('.nav-item')[2].classList.add('active');
        if(id === 's-rewards') document.querySelectorAll('.nav-item')[3].classList.add('active');
    }

    function showToast(msg, type = 'neutral') {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.innerHTML = type === 'success' ? `<i class="fa-solid fa-check"></i> ${msg}` : msg;
        container.appendChild(toast);
        setTimeout(() => toast.classList.add('show'), 10);
        setTimeout(() => { toast.classList.remove('show'); setTimeout(() => toast.remove(), 300); }, 3000);
    }

    function launchConfetti() { confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } }); }

    /* --- 5. PROFIL --- */
    function pickColor(el, color) {
        document.querySelectorAll('.color-opt').forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
        document.documentElement.style.setProperty('--theme-color', color);
    }
    function saveProfile() {
        const n = document.getElementById('inp-name').value;
        if(n) document.getElementById('display-name').innerText = n;
        showToast('Profil OluÅŸturuldu!', 'success');
        nav('s-home');
    }

    /* --- 6. BUILD GUIDE --- */
    function setupGuide(key) {
        activeGuideKey = key;
        const g = guideData[key];
        document.getElementById('intro-icon').innerText = g.icon;
        document.getElementById('intro-title').innerText = g.title;
        document.getElementById('intro-desc').innerText = g.desc;
        document.getElementById('intro-time').innerText = g.time;
        nav('s-guide-intro');
    }

    function startActualGuide() {
        guideStepIndex = 0;
        guidePhotos = new Array(guideData[activeGuideKey].steps.length).fill(null);
        renderGuideStep();
        nav('s-guide-steps');
    }

    function renderGuideStep() {
        const g = guideData[activeGuideKey];
        const step = g.steps[guideStepIndex];
        
        document.getElementById('step-header').innerText = `AdÄ±m ${guideStepIndex+1}/${g.steps.length}`;
        document.getElementById('step-title-text').innerText = step.t;
        document.getElementById('step-desc-text').innerText = step.d;
        
        const pct = ((guideStepIndex + 1) / g.steps.length) * 100;
        document.getElementById('p-fill').style.width = `${pct}%`;

        const img = document.getElementById('step-uploaded-img');
        const icon = document.getElementById('step-img-icon');
        if(guidePhotos[guideStepIndex]) {
            img.src = guidePhotos[guideStepIndex]; img.style.display = 'block'; icon.style.display = 'none';
            uploadedGuidePhoto = true;
        } else {
            img.style.display = 'none'; icon.style.display = 'block';
            uploadedGuidePhoto = false;
        }

        const btnNext = document.getElementById('btn-guide-next');
        btnNext.innerText = (guideStepIndex === g.steps.length - 1) ? "Bitir" : "Ä°leri";
    }

    function nextGuideStep() {
        if(!uploadedGuidePhoto) { showToast('Ã–nce fotoÄŸraf yÃ¼kle!', 'error'); return; }
        const g = guideData[activeGuideKey];
        if (guideStepIndex < g.steps.length - 1) {
            guideStepIndex++;
            renderGuideStep();
        } else {
            finishGuideProcess();
        }
    }

    function prevGuideStep() {
        if(guideStepIndex > 0) { guideStepIndex--; renderGuideStep(); } else { nav('s-guide-intro'); }
    }

    function handleStepUpload(input) {
        if(input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                guidePhotos[guideStepIndex] = e.target.result;
                renderGuideStep();
                showToast('FotoÄŸraf eklendi!', 'success');
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    function finishGuideProcess() {
        const g = guideData[activeGuideKey];
        const container = document.getElementById('summary-grid');
        container.innerHTML = "";
        g.steps.forEach((step, i) => {
            const imgSrc = guidePhotos[i] || "logo.png";
            container.innerHTML += `<div class="summary-card"><img src="${imgSrc}" class="summary-thumb"><div><b>AdÄ±m ${i+1}:</b> ${step.t}<br><small style="color:green;">TamamlandÄ±</small></div></div>`;
        });
        addXP(50);
        launchConfetti();
        nav('s-guide-summary');
    }

    /* --- 7. STUDY BUDDY & DERSLER --- */
    function loadMainBuddy(input) {
        if(input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('buddy-placeholder').style.display = 'none';
                document.getElementById('buddy-main-preview').src = e.target.result;
                document.getElementById('buddy-main-preview').style.display = 'block';
                document.getElementById('lesson-buddy-img').src = e.target.result;
                document.getElementById('lessons-area').style.display = 'block';
                showToast('ArkadaÅŸÄ±n YÃ¼klendi!', 'success');
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    function startLesson(type) {
        lessonData = quizData[type];
        if(!lessonData) return;
        qIndex = 0;
        document.getElementById('lesson-tag').innerText = type.toUpperCase();
        nav('s-lesson');
        loadQuestion();
    }

    function loadQuestion() {
        const q = lessonData[qIndex];
        document.getElementById('quiz-q').innerText = q.q;
        const grid = document.getElementById('quiz-opts');
        grid.innerHTML = "";
        q.opt.forEach(o => {
            const btn = document.createElement('div');
            btn.className = 'option-btn'; btn.innerText = o;
            btn.onclick = () => checkAns(o, q.ans, btn);
            grid.appendChild(btn);
        });
        buddySay("Hadi yapalÄ±m!");
    }

    function checkAns(sel, corr, btn) {
        if(sel == corr) {
            btn.style.background = "#C1E1C1";
            buddySay("DoÄŸru! HarikasÄ±n!");
            addXP(10);
            setTimeout(() => {
                if(qIndex < lessonData.length - 1) { qIndex++; loadQuestion(); }
                else { showToast('Ders Bitti! +20 XP', 'success'); launchConfetti(); nav('s-rewards'); }
            }, 1000);
        } else {
            btn.style.background = "#FFD1BA";
            buddySay("Tekrar dene!");
        }
    }

    function buddySay(txt) {
        const b = document.getElementById('buddy-bubble');
        b.innerText = txt;
        b.style.animation = 'none'; b.offsetHeight; b.style.animation = 'popIn 0.3s ease';
    }

    /* --- 8. XP & LEVEL --- */
    function addXP(amount) {
        xp += amount;
        document.getElementById('total-xp').innerText = xp;
        document.getElementById('lb-score').innerText = xp;
        
        // Level Hesaplama (Her 100 XP = 1 Level)
        let newLevel = Math.floor(xp / 100) + 1;
        if(newLevel > level) {
            level = newLevel;
            showToast(`Tebrikler! Seviye ${level} oldun!`, 'level-up');
            launchConfetti();
        }
        document.getElementById('level-display').innerText = level;
        
        // Progress Bar
        let progress = xp % 100;
        document.getElementById('xp-bar').style.width = `${progress}%`;
        document.getElementById('xp-display').innerText = `${progress}/100 XP`;

        // Rozet AÃ§ma
        if(xp >= 50) document.getElementById('badge-2').classList.add('unlocked');
        if(xp >= 100) document.getElementById('badge-3').classList.add('unlocked');
    }
</script>

</body>
</html>
