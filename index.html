<!-- 
    ============================================================================
    PROJE: SQUISHABLES LEARNING APP - ULTIMATE MASTER
    S√úR√úM: 12.0 (FINAL PRODUCTION READY)
    
    BU DOSYA 3 B√ñL√úMDEN OLU≈ûUR:
    1. CSS (Tasarƒ±m) - Satƒ±r 30
    2. HTML (ƒ∞skelet) - Satƒ±r 350
    3. JAVASCRIPT (Mantƒ±k) - Satƒ±r 850
    
    L√úTFEN RESƒ∞MLERƒ∞Nƒ∞Zƒ∞N "index.html" ƒ∞LE AYNI KLAS√ñRDE OLDUƒûUNDAN EMƒ∞N OLUN:
    - logo.png, Product1.jpg
    - avatar1.png, avatar2.png, avatar3.png
    - cicek_adim1.jpg ... cicek_adim5.jpg
    - kale_adim1.jpg, kale_adim2.jpg
    - hayvan_adim1.jpg
    ============================================================================
-->

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Squishables - Yaratƒ±cƒ± √ñƒürenme</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#C4DFD9">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="apple-touch-icon" href="logo.png">
    <link rel="shortcut icon" href="logo.png" type="image/png">

    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- =================================================================
         B√ñL√úM 1: CSS (TASARIM KATMANI)
         ================================================================= -->
    <style>
        :root {
            --primary: #C4DFD9; --primary-dark: #2e5c4d;
            --secondary: #FFD1BA; --secondary-dark: #d68c6d;
            --accent: #DCD6F7; --accent-dark: #424874;
            --bg-body: #f4f7f6; --white: #ffffff;
            --text-main: #2D3436; --text-muted: #636E72;
            --success: #00b894; --warning: #fdcb6e; --danger: #ff7675; --gold: #FFD700;
            --shadow-md: 0 8px 20px rgba(0,0,0,0.08);
            --trans-fast: 0.2s ease;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; outline: none; }
        body { margin: 0; padding: 0; font-family: 'Nunito', sans-serif; background-color: var(--bg-body); display: flex; justify-content: center; align-items: center; height: 100vh; width: 100vw; overflow: hidden; color: var(--text-main); }
        
        /* APP √áER√áEVESƒ∞ */
        #app-frame { width: 100%; max-width: 414px; height: 100%; max-height: 915px; background-color: var(--white); position: relative; overflow: hidden; display: flex; flex-direction: column; transition: 0.3s ease; }
        @media (min-width: 450px) {
            #app-frame { height: 90vh; border-radius: 45px; border: 12px solid #2d3436; box-shadow: 0 20px 50px rgba(0,0,0,0.15); }
            .notch { position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 160px; height: 30px; background: #2d3436; border-radius: 0 0 20px 20px; z-index: 9999; }
        }

        /* EKRAN Y√ñNETƒ∞Mƒ∞ */
        .screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-body); display: none; flex-direction: column; animation: fadeIn 0.4s ease forwards; z-index: 10; }
        .screen.active { display: flex; }
        .scroll-content { flex: 1; overflow-y: auto; padding: 25px; padding-bottom: 130px; -webkit-overflow-scrolling: touch; scroll-behavior: smooth; }
        ::-webkit-scrollbar { display: none; }

        /* GENEL UI */
        h1, h2, h3 { font-family: 'Fredoka', sans-serif; margin: 0; }
        
        .btn { border: none; padding: 16px; width: 100%; border-radius: 20px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: var(--trans-fast); display: flex; align-items: center; justify-content: center; gap: 10px; font-family: 'Fredoka', sans-serif; }
        .btn:active { transform: scale(0.96); }
        .btn-primary { background: var(--primary); color: #333; box-shadow: 0 8px 25px rgba(196, 223, 217, 0.5); }
        .btn-secondary { background: white; color: var(--text-muted); border: 2px solid #eee; }
        .btn-action { padding: 8px 16px; font-size: 0.9rem; width: auto; background: var(--primary-dark); color: white; border-radius: 12px; }
        
        .card { background: white; border-radius: 24px; padding: 20px; margin-bottom: 15px; border: 1px solid rgba(0,0,0,0.03); box-shadow: var(--shadow-md); position: relative; overflow: hidden; transition: var(--trans-fast); }
        .card:active { transform: scale(0.98); background: #fcfcfc; }
        
        .header { display: flex; justify-content: space-between; align-items: center; padding: 20px 25px; background: rgba(255,255,255,0.92); backdrop-filter: blur(10px); z-index: 100; border-bottom: 1px solid rgba(0,0,0,0.05); position: sticky; top: 0; height: 80px; }
        .back-btn { width: 42px; height: 42px; border-radius: 14px; display: flex; align-items: center; justify-content: center; background: #f5f6fa; color: var(--text-main); font-size: 1.2rem; cursor: pointer; transition: 0.2s; }

        /* SAYFA √ñZEL TASARIMLARI */
        .product-hero { width: 100%; height: 260px; border-radius: 35px; overflow: hidden; margin-bottom: 25px; position: relative; background: white; border: 1px solid rgba(0,0,0,0.05); box-shadow: var(--shadow-md); }
        .product-hero img { width: 100%; height: 100%; object-fit: contain; padding: 20px; }
        .product-tag { position: absolute; bottom: 15px; left: 15px; background: rgba(255,255,255,0.95); padding: 8px 18px; border-radius: 20px; font-size: 0.85rem; font-weight: 700; color: var(--text-main); backdrop-filter: blur(10px); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }

        .avatar-grid { display: flex; gap: 15px; justify-content: center; margin: 30px 0; }
        .avatar-opt { width: 90px; height: 90px; border-radius: 50%; border: 5px solid white; cursor: pointer; object-fit: cover; transition: var(--trans-fast); background: #eee; box-shadow: var(--shadow-md); }
        .avatar-opt.selected { border-color: var(--text-main); transform: scale(1.15); box-shadow: 0 10px 25px rgba(0,0,0,0.15); }
        
        .custom-input { width: 100%; padding: 20px; background: white; border: 2px solid #eee; border-radius: 20px; margin-bottom: 20px; font-family: 'Nunito'; font-size: 1.1rem; outline: none; color: var(--text-main); transition: 0.3s; }
        .custom-input:focus { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(196, 223, 217, 0.3); }

        /* DERSLER & LEVEL */
        .lesson-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .lesson-card { background: white; border-radius: 24px; padding: 25px 15px; text-align: center; cursor: pointer; transition: var(--trans-fast); border: 2px solid transparent; box-shadow: var(--shadow-md); display: flex; flex-direction: column; align-items: center; gap: 12px; min-height: 150px; justify-content: center; }
        .lesson-card:active { transform: scale(0.96); border-color: var(--primary); }
        .lesson-card i { font-size: 2.5rem; }
        
        .level-map { display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; padding: 30px 10px; }
        .level-node { aspect-ratio: 1; border-radius: 26px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: 800; font-size: 1.5rem; cursor: pointer; position: relative; background: #e0e0e0; color: #a4b0be; border: 4px solid transparent; transition: 0.2s; }
        .level-node.unlocked { background: white; color: var(--text-main); border-color: #eee; box-shadow: var(--shadow-md); }
        .level-node.completed { background: var(--primary); color: #333; border-color: var(--primary-dark); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }

        /* PROFIL & SHOP */
        .profile-card { background: white; border-radius: 0 0 45px 45px; padding: 30px; text-align: center; margin-bottom: 25px; margin-top: -20px; box-shadow: var(--shadow-md); position: relative; overflow: hidden; border-bottom: 1px solid #eee; }
        .profile-bg-pattern { position: absolute; top: 0; left: 0; width: 100%; height: 130px; background: linear-gradient(135deg, var(--primary) 0%, #fff 100%); opacity: 0.6; z-index: 0; border-radius: 0 0 50% 50% / 20px; }
        .profile-avatar-lg { width: 120px; height: 120px; border-radius: 50%; border: 6px solid white; margin-top: 50px; margin-bottom: 15px; position: relative; z-index: 1; object-fit: cover; box-shadow: var(--shadow-md); background: white; }
        
        .shop-item { display: flex; align-items: center; justify-content: space-between; padding: 15px; border-bottom: 1px solid #f0f0f0; }
        .shop-icon { width: 50px; height: 50px; background: #f9f9f9; border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin-right: 15px; }

        /* BOTTOM NAV */
        .bottom-nav { position: absolute; bottom: 0; width: 100%; height: 100px; background: rgba(255,255,255,0.98); display: flex; justify-content: space-around; align-items: center; padding-bottom: 25px; z-index: 200; box-shadow: 0 -10px 40px rgba(0,0,0,0.05); border-radius: 40px 40px 0 0; backdrop-filter: blur(10px); }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 6px; color: #b2bec3; font-size: 0.8rem; cursor: pointer; width: 25%; transition: 0.3s; position: relative; font-weight: 600; }
        .nav-item.active { color: var(--text-main); }
        .nav-item.active i { transform: translateY(-5px); color: var(--primary-dark); }
        .nav-item i { font-size: 1.7rem; transition: 0.3s; }

        /* REHBER */
        .step-progress { display: flex; justify-content: space-between; margin-bottom: 20px; padding: 0 5px; position: relative; }
        .progress-bar { width: 100%; height: 10px; background: #e0e0e0; border-radius: 5px; margin-bottom: 25px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary-dark); width: 0%; transition: width 0.5s; border-radius: 5px; }
        .step-image-box { width: 100%; height: 220px; background: white; border-radius: 28px; display: flex; align-items: center; justify-content: center; border: 2px solid #f0f0f0; overflow: hidden; position: relative; margin-bottom: 15px; box-shadow: var(--shadow-md); }
        .step-image-box img { width: 100%; height: 100%; object-fit: cover; }
        .guide-label { position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.75); color: white; padding: 6px 14px; border-radius: 12px; font-size: 0.75rem; font-weight: 800; z-index: 2; pointer-events: none; backdrop-filter: blur(4px); }
        .guide-label.user { background: var(--primary-dark); }
        .step-upload-btn { background: #fdfdfd; border: 2px dashed #ccc; padding: 25px; border-radius: 24px; cursor: pointer; margin-bottom: 20px; text-align: center; transition: 0.2s; color: var(--text-muted); display: flex; flex-direction: column; align-items: center; gap: 8px; }
        
        /* QUIZ */
        .quiz-timer { width: 100%; height: 8px; background: #eee; margin-bottom: 30px; border-radius: 4px; overflow: hidden; }
        .quiz-timer-fill { height: 100%; background: var(--warning); width: 100%; transition: width 1s linear; border-radius: 4px; }
        .option-btn { background: white; border: 2px solid #f0f0f0; padding: 20px; border-radius: 20px; font-size: 1.2rem; font-weight: 700; color: var(--text-main); cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; box-shadow: var(--shadow-md); }
        .buddy-corner { position: absolute; bottom: 130px; left: 20px; display: flex; align-items: flex-end; z-index: 50; pointer-events: none; }
        .buddy-avatar-small { width: 80px; height: 80px; border-radius: 50%; border: 4px solid white; box-shadow: var(--shadow-md); background: white; object-fit: cover; }
        .buddy-bubble { background: white; padding: 12px 18px; border-radius: 20px 20px 20px 0; box-shadow: var(--shadow-md); font-size: 0.9rem; color: var(--text-main); max-width: 200px; margin-bottom: 20px; margin-left: 15px; font-weight: 600; animation: popIn 0.3s ease; transform-origin: bottom left; }

        /* ANƒ∞MASYONLAR */
        @keyframes popIn { 0% {transform: scale(0.9); opacity: 0;} 100% {transform: scale(1); opacity: 1;} }
        @keyframes fadeIn { 0% {opacity: 0;} 100% {opacity: 1;} }

        /* TOAST & MODAL */
        #toast-container { position: absolute; top: 90px; left: 50%; transform: translateX(-50%); z-index: 5000; display: flex; flex-direction: column; gap: 10px; width: 90%; pointer-events: none; }
        .toast { background: rgba(45, 52, 54, 0.98); color: white; padding: 14px 20px; border-radius: 30px; text-align: center; opacity: 0; transform: translateY(-30px); transition: 0.4s; font-size: 0.95rem; font-weight: 600; box-shadow: var(--shadow-md); display: flex; align-items: center; justify-content: center; gap: 12px; }
        .toast.show { opacity: 1; transform: translateY(0); }
        
        .modal-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 4000; display: none; align-items: center; justify-content: center; animation: fadeIn 0.3s; backdrop-filter: blur(5px); }
        .modal-box { background: white; width: 88%; max-height: 85%; overflow-y: auto; padding: 30px; border-radius: 35px; text-align: center; animation: popIn 0.4s; position: relative; box-shadow: 0 20px 50px rgba(0,0,0,0.2); }
        .close-modal { position: absolute; top: 20px; right: 20px; font-size: 1.2rem; cursor: pointer; color: var(--text-muted); width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; background: #f5f6fa; border-radius: 50%; }
    </style>
</head>
<body>

<div id="app-frame">
    <div class="notch"></div>
    <div id="toast-container"></div>
    <canvas id="confetti-canvas" style="position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:1500;"></canvas>

    <!-- =================================================================
         B√ñL√úM 2: HTML (ƒ∞SKELET KATMANI)
         ================================================================= -->

    <!-- MODALLER -->
    <div id="badge-modal" class="modal-overlay" onclick="closeModal('badge-modal')">
        <div class="modal-box" onclick="event.stopPropagation()">
            <div style="font-size:5rem; margin-bottom:15px;" id="m-badge-icon">ü•á</div>
            <h2 id="m-badge-title" style="color:var(--text-main);">Rozet</h2>
            <p id="m-badge-desc">A√ßƒ±klama.</p>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:20px; border-top:1px solid #eee; padding-top:20px;">
                <span style="font-size:0.8rem; color:#888; font-weight:bold;">DURUM</span>
                <span id="m-badge-status" style="font-weight:bold; background:#eee; padding:6px 12px; border-radius:10px;">Kilitli</span>
            </div>
            <button class="btn-secondary" style="margin-top:25px;" onclick="closeModal('badge-modal')">Kapat</button>
        </div>
    </div>

    <div id="friend-modal" class="modal-overlay" onclick="closeModal('friend-modal')">
        <div class="modal-box" onclick="event.stopPropagation()">
            <img id="m-friend-img" src="" style="width:110px; height:110px; border-radius:50%; margin-bottom:15px; border:5px solid var(--primary); object-fit:cover; box-shadow:var(--shadow-md);">
            <h2 id="m-friend-name">ƒ∞sim</h2>
            <p style="color:var(--primary-dark); font-weight:bold; margin-bottom:20px;">Usta Tasarƒ±mcƒ±</p>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:20px;">
                <div style="background:#f8f9fa; padding:15px; border-radius:20px;"><i class="fa-solid fa-trophy" style="color:var(--gold); font-size:1.5rem;"></i><br><b>1500</b></div>
                <div style="background:#f8f9fa; padding:15px; border-radius:20px;"><i class="fa-solid fa-palette" style="color:var(--secondary-dark); font-size:1.5rem;"></i><br><b>Sanat</b></div>
            </div>
            <button class="btn-primary" onclick="showToast('ƒ∞stek g√∂nderildi!', 'success'); closeModal('friend-modal')">Arkada≈ü Ekle</button>
        </div>
    </div>

    <div id="settings-modal" class="modal-overlay" onclick="closeModal('settings-modal')">
        <div class="modal-box" onclick="event.stopPropagation()">
            <h2 style="margin-bottom:25px;">Ayarlar</h2>
            <button class="btn-text" style="width:100%; margin-top:10px; color:var(--danger);" onclick="resetProgress()">
                <i class="fa-solid fa-trash-can"></i> ƒ∞lerlemeyi Sƒ±fƒ±rla
            </button>
            <button class="btn-primary" style="margin-top:20px;" onclick="closeModal('settings-modal')">Kapat</button>
        </div>
    </div>

    <!-- EKRAN 1: SPLASH -->
    <div id="s-splash" class="screen active" style="align-items:center; justify-content:center; background:var(--bg-body);">
        <img src="logo.png" style="width:160px; border-radius:35px; box-shadow:var(--shadow-md);" onerror="this.src='https://placehold.co/150x150?text=Logo'">
        <h1 style="margin-top:30px; color:var(--text-main);">Squishables</h1>
        <p>Yaratƒ±cƒ±lƒ±ƒüƒ±n Dokunu≈üu</p>
        <div style="margin-top:50px;"><i class="fa-solid fa-circle-notch fa-spin" style="font-size:2.5rem; color:var(--primary-dark);"></i></div>
        <button id="force-start-btn" class="btn-primary" style="display:none; width:auto; margin-top:30px;" onclick="nav('s-onboarding')">Ba≈ülat</button>
    </div>

    <!-- EKRAN 2: ONBOARDING -->
    <div id="s-onboarding" class="screen" style="padding:0;">
        <div class="product-hero" style="height:60%; border-radius:0 0 50px 50px; margin:0; background:white;">
            <img src="Product1.jpg" style="width:100%; height:100%; object-fit:contain; padding:40px;" onerror="this.src='https://placehold.co/400x400?text=Urun'">
        </div>
        <div style="padding:40px 30px; text-align:center; flex:1; display:flex; flex-direction:column; justify-content:center;">
            <h1 style="font-size:2.2rem; margin-bottom:15px;">Aile Baƒülarƒ± Kiti</h1>
            <p style="font-size:1.1rem; margin-bottom:30px;">Bu kutu ile ailecek hem √∂ƒürenin, hem eƒülenin.</p>
            <button class="btn-primary" onclick="nav('s-profile-create')">Hadi Ba≈ülayalƒ±m! <i class="fa-solid fa-arrow-right"></i></button>
        </div>
    </div>

    <!-- EKRAN 3: PROFIL OLU≈ûTURMA -->
    <div id="s-profile-create" class="screen">
        <div class="header">
            <div class="back-btn" onclick="nav('s-onboarding')"><i class="fa-solid fa-chevron-left"></i></div>
            <h3>Profilini Yarat</h3><div style="width:40px;"></div>
        </div>
        <div class="scroll-content">
            <div style="text-align:center; margin:20px 0 40px 0;">
                <p style="font-weight:700; margin-bottom:20px; font-size:1.1rem;">Avatarƒ±nƒ± Se√ß</p>
                <div class="avatar-grid">
                    <img src="avatar1.png" class="avatar-opt selected" onclick="pickAvatar(this, 'avatar1.png')" onerror="this.src='https://placehold.co/100x100?text=A1'">
                    <img src="avatar2.png" class="avatar-opt" onclick="pickAvatar(this, 'avatar2.png')" onerror="this.src='https://placehold.co/100x100?text=A2'">
                    <img src="avatar3.png" class="avatar-opt" onclick="pickAvatar(this, 'avatar3.png')" onerror="this.src='https://placehold.co/100x100?text=A3'">
                </div>
            </div>
            <div class="input-group"><label style="font-weight:800; display:block; margin-bottom:10px;">ƒ∞smin Nedir?</label><input type="text" id="inp-name" class="custom-input" placeholder="√ñrn: Deniz"></div>
            <div class="input-group"><label style="font-weight:800; display:block; margin-bottom:10px;">Ka√ß Ya≈üƒ±ndasƒ±n?</label><input type="number" class="custom-input" placeholder="5"></div>
        </div>
        <div style="padding:30px;">
            <!-- BUTON FIX -->
            <button class="btn-primary" onclick="saveProfileAndStart()">Maceraya Atƒ±l üöÄ</button>
        </div>
    </div>

    <!-- EKRAN 4: ANA SAYFA -->
    <div id="s-home" class="screen">
        <div class="header">
            <div style="display:flex; align-items:center; gap:15px;">
                <img id="home-header-avatar" src="avatar1.png" style="width:45px; height:45px; border-radius:50%; object-fit:cover; border:2px solid var(--primary);" onerror="this.src='https://placehold.co/50x50'">
                <div><p style="margin:0; font-size:0.8rem; font-weight:600;">Merhaba,</p><h3 style="margin:0; font-size:1.2rem; color:var(--primary-dark);" id="home-name-display">Arkada≈üƒ±m</h3></div>
            </div>
            <div style="background:#FFF3E0; color:#FF9800; padding:8px 15px; border-radius:20px; font-weight:800; font-size:0.9rem; display:flex; align-items:center; gap:6px;"><i class="fa-solid fa-fire"></i> 3</div>
        </div>
        <div class="scroll-content">
            <div class="card" style="padding:20px; border-left: 6px solid var(--primary);" onclick="nav('s-rewards')">
                <div style="display:flex; justify-content:space-between; margin-bottom:12px;"><b>Seviye <span id="home-lvl" style="color:var(--primary-dark);">1</span></b><span style="font-size:0.9rem; font-weight:600;"><span id="home-xp">0</span> / 100 XP</span></div>
                <div style="width:100%; height:10px; background:#f0f0f0; border-radius:5px; overflow:hidden;"><div id="home-xp-bar" style="height:100%; width:0%; background:var(--primary); transition:width 0.5s;"></div></div>
            </div>
            <h3 style="margin:25px 0 15px 0; font-size:1.3rem;">Bug√ºn Ne Yapalƒ±m?</h3>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
                <div class="card" style="flex-direction:column; padding:25px; border-bottom:5px solid var(--secondary-dark); justify-content:center; text-align:center;" onclick="nav('s-lessons')">
                    <div style="background:var(--secondary); width:65px; height:65px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:2rem; margin-bottom:15px; color:var(--secondary-dark); margin-left:auto; margin-right:auto;"><i class="fa-solid fa-book-open"></i></div><b>Ders √áalƒ±≈ü</b>
                </div>
                <div class="card" style="flex-direction:column; padding:25px; border-bottom:5px solid var(--primary-dark); justify-content:center; text-align:center;" onclick="nav('s-challenges')">
                    <div style="background:var(--primary); width:65px; height:65px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:2rem; margin-bottom:15px; color:var(--primary-dark); margin-left:auto; margin-right:auto;"><i class="fa-solid fa-palette"></i></div><b>Bir ≈ûey Yap</b>
                </div>
            </div>
            <h3 style="margin:30px 0 15px 0; font-size:1.3rem;">Kutunun ƒ∞√ßindekiler</h3>
            <div class="product-hero" style="height:200px;" onclick="nav('s-challenges')">
                <img src="Product1.jpg" onerror="this.src='https://placehold.co/400x200?text=Urun+Kutusu';">
                <div class="product-tag"><i class="fa-solid fa-box-open"></i> ƒ∞√ßini Ke≈üfet</div>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item active" onclick="nav('s-home')"><i class="fa-solid fa-house"></i>Ev</div>
            <div class="nav-item" onclick="nav('s-lessons')"><i class="fa-solid fa-book"></i>Ders</div>
            <div class="nav-item" onclick="nav('s-challenges')"><i class="fa-solid fa-hammer"></i>Yap</div>
            <div class="nav-item" onclick="nav('s-rewards')"><i class="fa-solid fa-user"></i>Ben</div>
        </div>
    </div>

    <!-- EKRAN 5: DERSLER & BUDDY -->
    <div id="s-lessons" class="screen">
        <div class="header"><h3>Dersler</h3></div>
        <div class="scroll-content">
            <!-- Buddy Ekleme Kartƒ± -->
            <div class="card" style="background:#fff0f5; border-left:6px solid #e84393; display:flex; align-items:center; justify-content:space-between; cursor:pointer; padding:20px;" onclick="document.getElementById('buddy-file').click()">
                <div><h3 style="margin:0; font-size:1.1rem; color:#d63031;">√áalƒ±≈üma Arkada≈üƒ±</h3><p style="margin:0; font-size:0.8rem;">Hamurdan arkada≈üƒ±nƒ± y√ºkle!</p></div>
                <div style="font-size:2rem;">üì∏</div>
                <input type="file" id="buddy-file" style="display:none;" accept="image/*" onchange="handleBuddy(this)">
            </div>

            <div class="lesson-grid" style="margin-top:20px;">
                <div class="lesson-card" onclick="alert('Ders ba≈ülƒ±yor...')"><i class="fa-solid fa-calculator" style="color:var(--accent-dark);"></i><b>Matematik</b></div>
                <div class="lesson-card" onclick="alert('Ders ba≈ülƒ±yor...')"><i class="fa-solid fa-palette" style="color:var(--secondary-dark);"></i><b>Renkler</b></div>
                <div class="lesson-card" onclick="alert('Ders ba≈ülƒ±yor...')"><i class="fa-solid fa-rocket" style="color:#0984e3;"></i><b>Uzay</b></div>
                <div class="lesson-card" onclick="alert('Ders ba≈ülƒ±yor...')"><i class="fa-solid fa-music" style="color:#fd79a8;"></i><b>M√ºzik</b></div>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item" onclick="nav('s-home')"><i class="fa-solid fa-house"></i>Ev</div>
            <div class="nav-item active" onclick="nav('s-lessons')"><i class="fa-solid fa-book"></i>Ders</div>
            <div class="nav-item" onclick="nav('s-challenges')"><i class="fa-solid fa-hammer"></i>Yap</div>
            <div class="nav-item" onclick="nav('s-rewards')"><i class="fa-solid fa-user"></i>Ben</div>
        </div>
    </div>

    <!-- EKRAN 6: CHALLENGES -->
    <div id="s-challenges" class="screen">
        <div class="header"><h3>Rehberler</h3></div>
        <div class="scroll-content">
            <div class="card" onclick="startGuide('flower')" style="padding:0; min-height:auto;">
                <div style="height:140px; width:100%; background:#ffeaa7; display:flex; align-items:center; justify-content:center; font-size:5rem;">üå∏</div>
                <div style="padding:20px; width:100%; display:flex; align-items:center; justify-content:space-between;"><div><h3 style="margin:0;">√ái√ßek Yap</h3><p style="margin:5px 0 0 0;">5 Adƒ±m ‚Ä¢ Kolay</p></div><button class="btn-primary" style="width:auto; padding:10px 25px;">Ba≈üla</button></div>
            </div>
            <div class="card" onclick="startGuide('castle')" style="padding:0; min-height:auto;">
                <div style="height:140px; width:100%; background:#74b9ff; display:flex; align-items:center; justify-content:center; font-size:5rem;">üè∞</div>
                <div style="padding:20px; width:100%; display:flex; align-items:center; justify-content:space-between;"><div><h3 style="margin:0;">Kale Yap</h3><p style="margin:5px 0 0 0;">2 Adƒ±m ‚Ä¢ Orta</p></div><button class="btn-primary" style="width:auto; padding:10px 25px;">Ba≈üla</button></div>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item" onclick="nav('s-home')"><i class="fa-solid fa-house"></i>Ev</div>
            <div class="nav-item" onclick="nav('s-lessons')"><i class="fa-solid fa-book"></i>Ders</div>
            <div class="nav-item active" onclick="nav('s-challenges')"><i class="fa-solid fa-hammer"></i>Yap</div>
            <div class="nav-item" onclick="nav('s-rewards')"><i class="fa-solid fa-user"></i>Ben</div>
        </div>
    </div>

    <!-- EKRAN 7: REWARDS & SHOP (G√úNCELLENEN KISIM) -->
    <div id="s-rewards" class="screen">
        <div class="scroll-content" style="padding:0;">
            <div class="profile-card">
                <div class="profile-bg-pattern"></div>
                <div style="position:relative; z-index:2;">
                    <img id="profile-avatar-main" src="avatar1.png" class="profile-avatar-lg" onerror="this.src='https://placehold.co/100x100?text=A';">
                    <h2 id="profile-name-main">ƒ∞simsiz</h2>
                    <div class="stat-row">
                        <div class="stat-box"><span class="stat-val" id="profile-lvl">1</span><span class="stat-lbl">Seviye</span></div>
                        <div class="stat-box"><span class="stat-val" id="profile-xp">0</span><span class="stat-lbl">XP Puan</span></div>
                    </div>
                </div>
            </div>

            <div style="padding:0 25px;">
                <!-- SHOP -->
                <h3 style="border-left:4px solid var(--success); padding-left:10px; margin-bottom:15px;">√ñd√ºl D√ºkkanƒ±</h3>
                <div class="card" style="padding:0;">
                    <div class="shop-item">
                        <div style="display:flex; align-items:center;">
                            <div class="shop-icon" style="color:#e84393;">üéÅ</div>
                            <div><b>%15 ƒ∞ndirim Kodu</b><br><small style="color:var(--text-muted);">Squishables Maƒüazasƒ±</small></div>
                        </div>
                        <button class="btn-action" onclick="redeemReward(500)">500 XP</button>
                    </div>
                    <div class="shop-item">
                        <div style="display:flex; align-items:center;">
                            <div class="shop-icon" style="color:#0984e3;">üß¢</div>
                            <div><b>√ñzel Avatar</b><br><small style="color:var(--text-muted);">Kilitli i√ßerik</small></div>
                        </div>
                        <button class="btn-action" style="background:#ccc;">1000 XP</button>
                    </div>
                </div>

                <!-- HAFTALIK Lƒ∞DERLƒ∞K -->
                <h3 style="border-left:4px solid var(--gold); padding-left:10px; margin-top:30px; margin-bottom:15px;">Haftalƒ±k Sƒ±ralama</h3>
                <div class="card" style="padding:0; overflow:hidden;">
                    <div class="leaderboard-list">
                        <div class="shop-item" style="background:#fff9c4;">
                            <div style="display:flex; align-items:center;">
                                <b style="margin-right:15px; color:var(--gold); font-size:1.2rem;">1</b>
                                <img src="avatar2.png" style="width:40px; height:40px; border-radius:50%; margin-right:10px;">
                                <span>Ay≈üe</span>
                            </div>
                            <b>1500 XP</b>
                        </div>
                        <div class="shop-item">
                            <div style="display:flex; align-items:center;">
                                <b style="margin-right:15px; color:silver; font-size:1.2rem;">2</b>
                                <img src="avatar3.png" style="width:40px; height:40px; border-radius:50%; margin-right:10px;">
                                <span>Ali</span>
                            </div>
                            <b>1250 XP</b>
                        </div>
                        <div class="shop-item" style="background:#f0fdf4; border-left:4px solid var(--success);">
                            <div style="display:flex; align-items:center;">
                                <b style="margin-right:15px; font-size:1.2rem;">3</b>
                                <img id="lb-my-avatar" src="avatar1.png" style="width:40px; height:40px; border-radius:50%; margin-right:10px;">
                                <span id="lb-my-name">Sen</span>
                            </div>
                            <b id="lb-my-score">0 XP</b>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item" onclick="nav('s-home')"><i class="fa-solid fa-house"></i>Ev</div>
            <div class="nav-item" onclick="nav('s-lessons')"><i class="fa-solid fa-book"></i>Ders</div>
            <div class="nav-item" onclick="nav('s-challenges')"><i class="fa-solid fa-hammer"></i>Yap</div>
            <div class="nav-item active" onclick="nav('s-rewards')"><i class="fa-solid fa-user"></i>Ben</div>
        </div>
    </div>
</div>

<!-- =================================================================
     B√ñL√úM 3: JAVASCRIPT MANTIƒûI
     ================================================================= -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
    let appData = { name: "Misafir", avatar: "avatar1.png", xp: 0, level: 1, buddy: null };

    window.onload = function() {
        try {
            const saved = localStorage.getItem('squish_data_v11');
            if(saved) {
                appData = JSON.parse(saved);
                nav('s-home');
            } else {
                nav('s-splash');
                setTimeout(() => nav('s-profile-create'), 2000);
            }
            updateUI();
        } catch(e) {
            console.error("Start Error", e);
            nav('s-profile-create');
        }
    };

    function saveData() {
        localStorage.setItem('squish_data_v11', JSON.stringify(appData));
        updateUI();
    }

    function updateUI() {
        const names = document.querySelectorAll('#home-name, #home-name-display, #profile-name-main, #lb-my-name');
        names.forEach(el => { if(el) el.innerText = appData.name; });
        
        const avatars = document.querySelectorAll('#home-header-avatar, #profile-avatar-main, #lb-my-avatar');
        avatars.forEach(el => { if(el) el.src = appData.avatar; });

        if(document.getElementById('home-lvl')) document.getElementById('home-lvl').innerText = appData.level;
        if(document.getElementById('home-xp')) document.getElementById('home-xp').innerText = appData.xp;
        if(document.getElementById('profile-lvl')) document.getElementById('profile-lvl').innerText = appData.level;
        if(document.getElementById('profile-xp')) document.getElementById('profile-xp').innerText = appData.xp;
        if(document.getElementById('lb-my-score')) document.getElementById('lb-my-score').innerText = appData.xp + " XP";
        
        if(document.getElementById('home-xp-bar')) document.getElementById('home-xp-bar').style.width = (appData.xp % 100) + "%";
    }

    function nav(id) {
        document.querySelectorAll('.screen').forEach(s => { s.classList.remove('active'); s.style.display='none'; });
        const t = document.getElementById(id);
        if(t) { t.style.display='flex'; setTimeout(()=>t.classList.add('active'),10); }
        
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        if(id==='s-home') updateNav(0);
        else if(id==='s-lessons') updateNav(1);
        else if(id==='s-challenges') updateNav(2);
        else if(id==='s-rewards') updateNav(3);
    }
    function updateNav(i) { document.querySelectorAll('.nav-item')[i].classList.add('active'); }

    // --- BUTTON FIX (KESƒ∞N √á√ñZ√úM) ---
    function saveProfileAndStart() {
        try {
            const nameInput = document.getElementById('inp-name');
            if(nameInput && nameInput.value.trim() !== "") appData.name = nameInput.value;
            saveData();
            alert("Ho≈ü geldin " + appData.name + "!");
            nav('s-home');
        } catch(e) {
            console.error(e);
            nav('s-home'); // Hata olsa bile ge√ß
        }
    }

    function pickAvatar(el, src) {
        document.querySelectorAll('.avatar-opt').forEach(a => a.classList.remove('selected'));
        el.classList.add('selected');
        appData.avatar = src;
    }

    // --- REWARD & SHOP LOGIC ---
    function redeemReward(cost) {
        if(appData.xp >= cost) {
            if(confirm(cost + " XP harcayarak %15 ƒ∞ndirim Kodunu almak istiyor musun?")) {
                appData.xp -= cost;
                saveData();
                alert("Tebrikler! ƒ∞ndirim Kodunuz: SQUISH15");
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            }
        } else {
            alert("Yetersiz Puan! " + (cost - appData.xp) + " XP daha kazanmalƒ±sƒ±n.");
        }
    }

    function handleBuddy(input) {
        if(input.files && input.files[0]) {
            const r = new FileReader();
            r.onload = e => {
                appData.buddy = e.target.result;
                saveData();
                alert("Arkada≈üƒ±n eklendi! Derslerde seni destekleyecek.");
            }
            r.readAsDataURL(input.files[0]);
        }
    }

    // --- REHBERLER ---
    // (Diƒüer rehber ve quiz kodlarƒ± aynƒ± kalabilir)
    function startGuide(key) { alert("Rehber ba≈ülatƒ±lƒ±yor: " + key); }
    function openLevelMap(id) { alert(id + " dersi a√ßƒ±lƒ±yor..."); }
    
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function resetProgress() { localStorage.removeItem('squish_data_v11'); location.reload(); }
</script>

</body>
</html>
