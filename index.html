<!-- 
    ============================================================================
    PROJE: SQUISHABLES LEARNING APP - PLATINUM EDITION
    S√úR√úM: 25.0 (FULL FIX & UI OVERHAUL)
    
    D√úZELTƒ∞LENLER:
    1. "Maceraya Atƒ±l" butonu artƒ±k kesinlikle √ßalƒ±≈üƒ±yor (Hata korumalƒ±).
    2. Profil olu≈üturma ekranƒ± geri getirildi ve zorunlu yapƒ±ldƒ±.
    3. Buddy Sistemi: Kullanƒ±cƒ± hamurdan yaptƒ±ƒüƒ± arkada≈üƒ±nƒ± "Dersler" ekranƒ±nda y√ºkler,
       Quiz ekranƒ±nda bu fotoƒüraf ona tezah√ºrat yapar.
    4. Ders Motoru: 
       - Her ders (M√ºzik, Uzay vb.) kendi konusuna √∂zel sorular sorar.
       - Matematik artƒ±k 4 ≈üƒ±klƒ±.
       - Seviye zorluƒüu (1-10) kademeli artar.
    5. UI Tasarƒ±mƒ±: Kare kutular gitti, yuvarlak hatlƒ±, g√∂lgeli, modern kartlar geldi.
    
    GEREKLƒ∞ DOSYALAR (index.html ile aynƒ± yerde):
    - logo.png, Product1.jpg
    - avatar1.png, avatar2.png, avatar3.png
    - cicek_adim1...5.jpg, kale_adim1...2.jpg, hayvan_adim1.jpg
    ============================================================================
-->

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Squishables - Yaratƒ±cƒ± √ñƒürenme</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#C4DFD9">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <link rel="apple-touch-icon" href="logo.png">
    <link rel="shortcut icon" href="logo.png" type="image/png">

    <!-- Fontlar -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- CSS AYARLARI (Modern & Squishy) --- */
        :root {
            --primary: #C4DFD9; --primary-dark: #2e5c4d;
            --secondary: #FFD1BA; --secondary-dark: #d68c6d;
            --accent: #DCD6F7; --accent-dark: #424874;
            --bg-body: #f0f4f8; --white: #ffffff;
            --text-main: #2D3436; --text-muted: #636E72;
            --success: #00b894; --warning: #fdcb6e; --danger: #ff7675; --gold: #FFD700;
            
            /* G√∂lgeler */
            --shadow-sm: 0 4px 6px rgba(0,0,0,0.04);
            --shadow-md: 0 10px 20px rgba(0,0,0,0.08);
            --shadow-float: 0 20px 40px rgba(0,0,0,0.12);
            --shadow-btn: 0 8px 15px rgba(196, 223, 217, 0.4);
            
            --radius-lg: 28px;
            --radius-md: 20px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; outline: none; }
        body { margin: 0; padding: 0; font-family: 'Nunito', sans-serif; background-color: var(--bg-body); display: flex; justify-content: center; align-items: center; height: 100vh; width: 100vw; overflow: hidden; color: var(--text-main); }
        ::-webkit-scrollbar { width: 0px; background: transparent; }

        /* Telefon √áer√ßevesi */
        #app-frame { width: 100%; max-width: 428px; height: 100%; max-height: 926px; background-color: var(--bg-body); position: relative; overflow: hidden; display: flex; flex-direction: column; transition: 0.3s ease; }
        @media (min-width: 450px) {
            #app-frame { height: 90vh; border-radius: 45px; border: 14px solid #2d3436; box-shadow: var(--shadow-float); background-color: #fff; }
            .notch { position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 160px; height: 34px; background: #2d3436; border-radius: 0 0 24px 24px; z-index: 9999; }
        }

        /* Ekranlar */
        .screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-body); display: none; flex-direction: column; animation: fadeIn 0.4s ease forwards; z-index: 10; }
        .screen.active { display: flex; }
        
        /* ƒ∞√ßerik Alanƒ± (Alt men√ºn√ºn arkasƒ±nda kalmasƒ±n diye padding arttƒ±rƒ±ldƒ±) */
        .scroll-content { flex: 1; overflow-y: auto; padding: 24px; padding-bottom: 140px; -webkit-overflow-scrolling: touch; scroll-behavior: smooth; }

        /* Tipografi */
        h1, h2, h3 { font-family: 'Fredoka', sans-serif; margin: 0; }
        p { color: var(--text-muted); font-size: 0.95rem; line-height: 1.5; margin: 8px 0; }

        /* Butonlar */
        .btn { border: none; padding: 18px; width: 100%; border-radius: var(--radius-md); font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: 0.2s; position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; gap: 10px; font-family: 'Fredoka', sans-serif; }
        .btn:active { transform: scale(0.95); }
        .btn-primary { background: var(--primary); color: #333; box-shadow: var(--shadow-btn); border-bottom: 4px solid rgba(0,0,0,0.1); }
        .btn-primary:active { border-bottom-width: 0; transform: translateY(4px); }
        .btn-secondary { background: white; color: var(--text-muted); border: 2px solid #eee; }
        .btn-action { padding: 8px 16px; font-size: 0.85rem; width: auto; background: var(--text-main); color: white; border-radius: 14px; }

        /* Kartlar (Modern & Yuvarlak) */
        .card { background: white; border-radius: var(--radius-lg); padding: 20px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.6); box-shadow: var(--shadow-sm); position: relative; overflow: hidden; transition: 0.2s; }
        .card:active { transform: scale(0.98); background: #fdfdfd; }

        /* Header */
        .header { display: flex; justify-content: space-between; align-items: center; padding: 20px 25px; background: rgba(255,255,255,0.92); backdrop-filter: blur(12px); z-index: 100; border-bottom: 1px solid rgba(0,0,0,0.05); position: sticky; top: 0; height: 90px; }
        .back-btn { width: 42px; height: 42px; border-radius: 14px; display: flex; align-items: center; justify-content: center; background: white; color: var(--text-main); font-size: 1.2rem; cursor: pointer; box-shadow: var(--shadow-sm); transition: 0.2s; }
        .back-btn:active { transform: scale(0.9); }

        /* √ñzel Bile≈üenler */
        .product-hero { width: 100%; height: 260px; border-radius: 35px; overflow: hidden; margin-bottom: 25px; position: relative; background: white; box-shadow: var(--shadow-md); }
        .product-hero img { width: 100%; height: 100%; object-fit: contain; padding: 25px; }
        
        .avatar-grid { display: flex; gap: 15px; justify-content: center; margin: 30px 0; }
        .avatar-opt { width: 85px; height: 85px; border-radius: 50%; border: 5px solid white; cursor: pointer; object-fit: cover; transition: 0.3s; background: #eee; box-shadow: var(--shadow-sm); }
        .avatar-opt.selected { border-color: var(--primary-dark); transform: scale(1.15); box-shadow: var(--shadow-md); }
        .custom-input { width: 100%; padding: 20px; background: white; border: 2px solid #eee; border-radius: 20px; margin-bottom: 20px; font-family: 'Nunito'; font-size: 1.1rem; transition: 0.3s; outline: none; color: var(--text-main); }
        .custom-input:focus { border-color: var(--primary); box-shadow: 0 5px 15px rgba(196, 223, 217, 0.3); }

        /* Ders Kartlarƒ± */
        .lesson-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .lesson-card { background: white; border-radius: 28px; padding: 20px; text-align: center; cursor: pointer; transition: 0.2s; border: 2px solid transparent; box-shadow: var(--shadow-sm); display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 150px; gap: 12px; }
        .lesson-card:active { transform: scale(0.96); border-color: var(--primary); }
        .lesson-card i { font-size: 2.8rem; transition: transform 0.3s; }
        .lesson-card:hover i { transform: rotate(10deg) scale(1.1); }

        /* Profil Header */
        .profile-card { background: white; border-radius: 0 0 45px 45px; padding: 30px; text-align: center; margin-bottom: 25px; margin-top: -20px; box-shadow: var(--shadow-md); position: relative; overflow: hidden; border-bottom: 1px solid #eee; }
        .profile-bg-pattern { position: absolute; top: 0; left: 0; width: 100%; height: 140px; background: linear-gradient(135deg, var(--primary) 0%, #fff 100%); opacity: 0.6; z-index: 0; border-radius: 0 0 50% 50% / 20px; }
        .profile-avatar-lg { width: 120px; height: 120px; border-radius: 50%; border: 6px solid white; margin-top: 50px; margin-bottom: 15px; position: relative; z-index: 1; object-fit: cover; box-shadow: var(--shadow-float); background: white; }

        /* Shop & Leaderboard */
        .shop-item { display: flex; align-items: center; justify-content: space-between; padding: 15px; border-bottom: 1px solid #f0f0f0; }
        .shop-icon { width: 50px; height: 50px; background: #fff5f5; border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 1.6rem; margin-right: 15px; }
        .leaderboard-list .shop-item:last-child { border-bottom: none; }

        /* Quiz UI (4 ≈ûƒ±k) */
        .quiz-timer { width: 100%; height: 8px; background: #eee; margin-bottom: 30px; border-radius: 4px; overflow: hidden; }
        .quiz-timer-fill { height: 100%; background: var(--warning); width: 100%; transition: width 1s linear; border-radius: 4px; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .option-btn { background: white; border: 2px solid #f0f0f0; padding: 25px; border-radius: 22px; font-size: 1.3rem; font-weight: 700; color: var(--text-main); cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; box-shadow: var(--shadow-sm); }
        .option-btn:active { transform: scale(0.95); background: #f8f8f8; border-color: var(--primary); }
        
        /* Buddy (Hamur Arkada≈ü) */
        .buddy-corner { position: absolute; bottom: 130px; left: 20px; display: flex; align-items: flex-end; z-index: 50; pointer-events: none; }
        .buddy-avatar-small { width: 85px; height: 85px; border-radius: 50%; border: 4px solid white; box-shadow: var(--shadow-float); background: white; object-fit: cover; animation: float 3s ease-in-out infinite; }
        .buddy-bubble { background: white; padding: 12px 18px; border-radius: 20px 20px 20px 0; box-shadow: var(--shadow-float); font-size: 0.9rem; color: var(--text-main); max-width: 180px; margin-bottom: 20px; margin-left: 15px; font-weight: 700; animation: popIn 0.4s ease; transform-origin: bottom left; }

        /* Bottom Nav */
        .bottom-nav { position: absolute; bottom: 0; width: 100%; height: 95px; background: rgba(255,255,255,0.95); display: flex; justify-content: space-around; align-items: center; padding-bottom: 25px; z-index: 200; box-shadow: 0 -10px 40px rgba(0,0,0,0.05); border-radius: 40px 40px 0 0; backdrop-filter: blur(10px); border-top: 1px solid rgba(0,0,0,0.02); }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 6px; color: #b2bec3; font-size: 0.75rem; cursor: pointer; width: 25%; transition: 0.3s; position: relative; font-weight: 700; }
        .nav-item.active { color: var(--text-main); transform: translateY(-5px); }
        .nav-item.active i { color: var(--primary-dark); font-size: 1.8rem; }
        .nav-item i { font-size: 1.6rem; transition: 0.3s; }

        /* Animasyonlar */
        @keyframes popIn { 0% {transform: scale(0.9); opacity: 0;} 100% {transform: scale(1); opacity: 1;} }
        @keyframes fadeIn { 0% {opacity: 0;} 100% {opacity: 1;} }
        @keyframes float { 0% {transform: translateY(0px);} 50% {transform: translateY(-8px);} 100% {transform: translateY(0px);} }

        /* Toast (Custom Alert) */
        #toast-container { position: absolute; top: 100px; left: 50%; transform: translateX(-50%); z-index: 5000; display: flex; flex-direction: column; gap: 12px; width: 90%; pointer-events: none; }
        .toast { background: rgba(45, 52, 54, 0.98); color: white; padding: 16px 24px; border-radius: 35px; text-align: center; opacity: 0; transform: translateY(-40px); transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); font-size: 1rem; font-weight: 700; box-shadow: var(--shadow-lg); display: flex; align-items: center; justify-content: center; gap: 12px; backdrop-filter: blur(8px); border: 2px solid rgba(255,255,255,0.1); }
        .toast.show { opacity: 1; transform: translateY(0); }
    </style>
</head>
<body>

<div id="app-frame">
    <div class="notch"></div>
    <div id="toast-container"></div>
    <canvas id="confetti-canvas" style="position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:1500;"></canvas>

    <!-- MODAL: AYARLAR -->
    <div id="settings-modal" class="modal-overlay" onclick="closeModal('settings-modal')" style="display:none;">
        <div class="modal-box" onclick="event.stopPropagation()">
            <h2 style="margin-bottom:25px;">Ayarlar</h2>
            <button class="btn" style="background:#fff0f0; color:var(--danger); font-weight:800; margin-top:10px;" onclick="resetProgress()">
                <i class="fa-solid fa-trash-can"></i> ƒ∞lerlemeyi Sƒ±fƒ±rla
            </button>
            <button class="btn-primary" style="margin-top:20px;" onclick="closeModal('settings-modal')">Kapat</button>
        </div>
    </div>

    <!-- 1. SPLASH SCREEN -->
    <div id="s-splash" class="screen active" style="align-items:center; justify-content:center; background:var(--bg-body);">
        <img src="logo.png" style="width:160px; border-radius:40px; box-shadow:var(--shadow-float);" onerror="this.src='https://placehold.co/150x150?text=Logo'">
        <h1 style="margin-top:30px; color:var(--text-main);">Squishables</h1>
        <div style="margin-top:40px;"><i class="fa-solid fa-spinner fa-spin" style="font-size:2.5rem; color:var(--primary-dark);"></i></div>
        <!-- G√ºvenlik Butonu -->
        <button id="force-start-btn" class="btn-primary" style="display:none; width:auto; margin-top:40px; box-shadow:var(--shadow-lg);" onclick="nav('s-profile-create')">BA≈ûLAT</button>
    </div>

    <!-- 2. PROFIL OLU≈ûTURMA (ZORUNLU Gƒ∞Rƒ∞≈û) -->
    <div id="s-profile-create" class="screen">
        <div class="header">
            <div class="header-title" style="width:100%; text-align:center;">Profilini Yarat</div>
        </div>
        <div class="scroll-content">
            <div style="text-align:center; margin:20px 0 40px 0;">
                <p style="font-weight:800; margin-bottom:20px; font-size:1.2rem;">Seni en iyi yansƒ±tan hangisi?</p>
                <div class="avatar-grid">
                    <img src="avatar1.png" class="avatar-opt selected" onclick="pickAvatar(this, 'avatar1.png')" onerror="this.src='https://placehold.co/100x100?text=A1'">
                    <img src="avatar2.png" class="avatar-opt" onclick="pickAvatar(this, 'avatar2.png')" onerror="this.src='https://placehold.co/100x100?text=A2'">
                    <img src="avatar3.png" class="avatar-opt" onclick="pickAvatar(this, 'avatar3.png')" onerror="this.src='https://placehold.co/100x100?text=A3'">
                </div>
            </div>
            <div class="input-group"><label style="font-weight:800; display:block; margin-bottom:10px;">ƒ∞smin Nedir?</label><input type="text" id="inp-name" class="custom-input" placeholder="√ñrn: Deniz"></div>
            <div class="input-group"><label style="font-weight:800; display:block; margin-bottom:10px;">Ya≈üƒ±n</label><input type="number" class="custom-input" placeholder="5"></div>
        </div>
        <div style="padding:30px;">
            <button class="btn-primary" onclick="saveProfileAndStart()">Maceraya Atƒ±l üöÄ</button>
        </div>
    </div>

    <!-- 3. ANA SAYFA -->
    <div id="s-home" class="screen">
        <div class="header">
            <div style="display:flex; align-items:center; gap:15px;">
                <img id="home-header-avatar" src="avatar1.png" style="width:50px; height:50px; border-radius:50%; object-fit:cover; border:3px solid var(--primary);" onerror="this.src='https://placehold.co/50x50'">
                <div><p style="margin:0; font-size:0.85rem; font-weight:700; color:var(--text-muted);">Merhaba,</p><h3 style="margin:0; font-size:1.4rem; color:var(--text-main);" id="home-name-display">Arkada≈üƒ±m</h3></div>
            </div>
            <div style="display:flex; gap:10px;">
                <div style="background:#FFF3E0; color:#FF9800; padding:8px 16px; border-radius:20px; font-weight:800; font-size:0.95rem; display:flex; align-items:center; gap:6px; box-shadow:var(--shadow-sm);"><i class="fa-solid fa-fire"></i> 3</div>
                <div class="back-btn" onclick="document.getElementById('settings-modal').style.display='flex'"><i class="fa-solid fa-gear"></i></div>
            </div>
        </div>
        <div class="scroll-content">
            <!-- Level Bar -->
            <div class="card" style="padding:25px; border-left: 8px solid var(--primary);" onclick="nav('s-rewards')">
                <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                    <b style="font-size:1.2rem;">Seviye <span id="home-lvl" style="color:var(--primary-dark);">1</span></b>
                    <span style="font-size:1rem; font-weight:700; color:var(--text-muted);"><span id="home-xp">0</span> / 100 XP</span>
                </div>
                <div style="width:100%; height:12px; background:#f0f0f0; border-radius:6px; overflow:hidden;">
                    <div id="home-xp-bar" style="height:100%; width:0%; background:var(--primary); border-radius:6px; transition:width 0.5s;"></div>
                </div>
            </div>

            <h3 style="margin:30px 0 20px 0; font-size:1.4rem; padding-left:5px;">Kutunun ƒ∞√ßindekiler</h3>
            <div class="product-hero" style="height:220px;" onclick="nav('s-challenges')">
                <img src="Product1.jpg" onerror="this.src='https://placehold.co/400x200?text=Urun+Kutusu';">
                <div class="product-tag"><i class="fa-solid fa-box-open"></i> Aktivite Yap</div>
            </div>

            <h3 style="margin:20px 0 15px 0; font-size:1.4rem; padding-left:5px;">Hƒ±zlƒ± Eri≈üim</h3>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
                <div class="card" style="flex-direction:column; padding:30px; border-bottom:6px solid var(--secondary-dark); min-height:180px; justify-content:center;" onclick="nav('s-lessons')">
                    <div style="background:var(--secondary); width:70px; height:70px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:2.2rem; margin-bottom:20px; color:var(--secondary-dark); margin-left:auto; margin-right:auto;"><i class="fa-solid fa-book-open"></i></div>
                    <b style="font-size:1.1rem;">Ders √áalƒ±≈ü</b>
                </div>
                <div class="card" style="flex-direction:column; padding:30px; border-bottom:6px solid var(--primary-dark); min-height:180px; justify-content:center;" onclick="nav('s-challenges')">
                    <div style="background:var(--primary); width:70px; height:70px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:2.2rem; margin-bottom:20px; color:var(--primary-dark); margin-left:auto; margin-right:auto;"><i class="fa-solid fa-palette"></i></div>
                    <b style="font-size:1.1rem;">Bir ≈ûey Yap</b>
                </div>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item active" onclick="nav('s-home')"><i class="fa-solid fa-house"></i>Ev</div>
            <div class="nav-item" onclick="nav('s-lessons')"><i class="fa-solid fa-book"></i>Ders</div>
            <div class="nav-item" onclick="nav('s-challenges')"><i class="fa-solid fa-hammer"></i>Yap</div>
            <div class="nav-item" onclick="nav('s-rewards')"><i class="fa-solid fa-user"></i>Ben</div>
        </div>
    </div>

    <!-- 4. DERSLER (LESSONS) & BUDDY UPLOAD -->
    <div id="s-lessons" class="screen">
        <div class="header"><h3>Dersler</h3></div>
        <div class="scroll-content">
            <!-- BUDDY KARTI -->
            <div class="card" style="background:#fff0f5; border-left:6px solid #e84393; display:flex; align-items:center; justify-content:space-between; cursor:pointer; padding:25px;" onclick="document.getElementById('buddy-file').click()">
                <div>
                    <h3 style="margin:0; font-size:1.2rem; color:#d63031; margin-bottom:5px;">√áalƒ±≈üma Arkada≈üƒ±</h3>
                    <p style="margin:0; font-size:0.9rem; color:#636e72;">Hamurdan yaptƒ±ƒüƒ±n fig√ºr√º y√ºkle!</p>
                </div>
                <div style="position:relative;">
                    <img id="lesson-buddy-preview" src="https://placehold.co/70x70?text=?" style="width:70px; height:70px; border-radius:50%; object-fit:cover; border:3px solid white; box-shadow:var(--shadow-sm);">
                    <div style="position:absolute; bottom:0; right:0; background:white; border-radius:50%; padding:8px; box-shadow:var(--shadow-sm); font-size:1rem;">üì∏</div>
                </div>
                <input type="file" id="buddy-file" style="display:none;" accept="image/*" onchange="handleBuddy(this)">
            </div>

            <h3 style="margin:30px 0 20px 0; padding-left:5px;">Konular</h3>
            <div class="lesson-grid">
                <div class="lesson-card" onclick="openLevelMap('math')"><i class="fa-solid fa-calculator" style="color:var(--accent-dark);"></i><b>Matematik</b><small style="color:var(--success);">10 Seviye</small></div>
                <div class="lesson-card" onclick="openLevelMap('colors')"><i class="fa-solid fa-palette" style="color:var(--secondary-dark);"></i><b>Renkler</b><small style="color:var(--success);">10 Seviye</small></div>
                <div class="lesson-card" onclick="openLevelMap('shapes')"><i class="fa-solid fa-shapes" style="color:var(--primary-dark);"></i><b>≈ûekiller</b><small style="color:var(--success);">10 Seviye</small></div>
                <div class="lesson-card" onclick="openLevelMap('space')"><i class="fa-solid fa-rocket" style="color:#0984e3;"></i><b>Uzay</b><small style="color:var(--success);">10 Seviye</small></div>
                <div class="lesson-card" onclick="openLevelMap('music')"><i class="fa-solid fa-music" style="color:#fd79a8;"></i><b>M√ºzik</b><small style="color:var(--success);">10 Seviye</small></div>
                <div class="lesson-card" onclick="openLevelMap('animals')"><i class="fa-solid fa-paw" style="color:#e17055;"></i><b>Hayvanlar</b><small style="color:var(--success);">10 Seviye</small></div>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item" onclick="nav('s-home')"><i class="fa-solid fa-house"></i>Ev</div>
            <div class="nav-item active" onclick="nav('s-lessons')"><i class="fa-solid fa-book"></i>Ders</div>
            <div class="nav-item" onclick="nav('s-challenges')"><i class="fa-solid fa-hammer"></i>Yap</div>
            <div class="nav-item" onclick="nav('s-rewards')"><i class="fa-solid fa-user"></i>Ben</div>
        </div>
    </div>

    <!-- 5. LEVEL HARƒ∞TASI -->
    <div id="s-level-map" class="screen">
        <div class="header"><div class="back-btn" onclick="nav('s-lessons')"><i class="fa-solid fa-chevron-left"></i></div><h3 id="map-title">Matematik</h3><div style="width:40px;"></div></div>
        <div class="scroll-content" style="text-align:center;">
            <div style="background:white; padding:25px; border-radius:30px; margin-bottom:25px; box-shadow:var(--shadow-md); border:2px solid white;"><i class="fa-solid fa-star" style="color:var(--gold); font-size:3rem; margin-bottom:15px;"></i><p style="font-size:1.1rem; font-weight:600;">Yƒ±ldƒ±zlarƒ± topla, ilerle!</p></div>
            <div class="level-map" id="level-grid-container"></div>
        </div>
    </div>

    <!-- 6. QUIZ EKRANI -->
    <div id="s-quiz" class="screen">
        <div class="header"><div class="back-btn" onclick="nav('s-level-map')"><i class="fa-solid fa-xmark" style="color:var(--danger);"></i></div><h3 id="quiz-level-ind">Level 1</h3><div style="width:40px;"></div></div>
        <div class="scroll-content" style="display:flex; flex-direction:column; justify-content:center; padding-top:40px;">
            <div class="quiz-timer"><div class="quiz-timer-fill" id="timer-bar"></div></div>
            <div style="text-align:center; margin-bottom:50px;"><h1 style="font-size:4rem; color:var(--text-main); margin-bottom:15px; font-weight:800;" id="quiz-question">?</h1><p style="font-size:1.2rem;">Doƒüru cevabƒ± se√ß!</p></div>
            <div class="options-grid" id="quiz-options" style="display:grid; grid-template-columns:1fr 1fr; gap:15px;"></div>
            
            <!-- BUDDY (SENƒ∞N HAMURUN) -->
            <div class="buddy-corner">
                <div class="buddy-bubble" id="quiz-buddy-msg">Ba≈üarƒ±lar!</div>
                <img id="quiz-buddy" src="avatar1.png" class="buddy-avatar-small" onerror="this.style.display='none'">
            </div>
        </div>
    </div>

    <!-- 7. REWARDS & SHOP (YENƒ∞ TASARIM) -->
    <div id="s-rewards" class="screen">
        <div class="scroll-content" style="padding:0;">
            <div class="profile-card">
                <div class="profile-bg-pattern"></div>
                <div style="position:relative; z-index:2;">
                    <img id="profile-avatar-main" src="avatar1.png" class="profile-avatar-lg" onerror="this.src='https://placehold.co/100x100?text=A';">
                    <h2 id="profile-name-main">ƒ∞simsiz</h2>
                    <div class="stat-row">
                        <div class="stat-box"><span class="stat-val" id="profile-lvl">1</span><span class="stat-lbl">Seviye</span></div>
                        <div class="stat-box"><span class="stat-val" id="profile-xp">0</span><span class="stat-lbl">Toplam XP</span></div>
                    </div>
                </div>
            </div>

            <div style="padding:0 25px;">
                <!-- MAƒûAZA -->
                <h3 style="border-left:5px solid var(--success); padding-left:15px; margin-bottom:20px;">√ñd√ºl D√ºkkanƒ±</h3>
                <div class="card" style="padding:0;">
                    <div class="shop-item">
                        <div style="display:flex; align-items:center;"><div class="shop-icon" style="color:#e84393;">üéÅ</div><div><b>%15 ƒ∞ndirim Kodu</b><br><small style="color:var(--text-muted);">500 XP</small></div></div>
                        <button class="btn-action" onclick="redeemReward(500)">Al</button>
                    </div>
                    <div class="shop-item">
                        <div style="display:flex; align-items:center;"><div class="shop-icon" style="color:#0984e3;">üß¢</div><div><b>√ñzel Avatar</b><br><small style="color:var(--text-muted);">1000 XP</small></div></div>
                        <button class="btn-action" style="background:#ccc;">Al</button>
                    </div>
                </div>

                <!-- HAFTALIK Lƒ∞DERLƒ∞K -->
                <h3 style="border-left:5px solid var(--gold); padding-left:15px; margin-top:40px; margin-bottom:20px;">Haftalƒ±k Sƒ±ralama</h3>
                <div class="card" style="padding:0; overflow:hidden;">
                    <div class="leaderboard-list">
                        <div class="shop-item" style="background:#fff9c4;"><div style="display:flex; align-items:center;"><b style="margin-right:15px; color:var(--gold); font-size:1.4rem;">1</b><img src="avatar2.png" style="width:45px; height:45px; border-radius:50%; margin-right:15px;"><span>Ay≈üe</span></div><b>1500 XP</b></div>
                        <div class="shop-item"><div style="display:flex; align-items:center;"><b style="margin-right:15px; color:silver; font-size:1.4rem;">2</b><img src="avatar3.png" style="width:45px; height:45px; border-radius:50%; margin-right:15px;"><span>Ali</span></div><b>1250 XP</b></div>
                        <div class="shop-item" style="background:#f0fdf4; border-left:5px solid var(--success);"><div style="display:flex; align-items:center;"><b style="margin-right:15px; font-size:1.4rem;">3</b><img id="lb-my-avatar" src="avatar1.png" style="width:45px; height:45px; border-radius:50%; margin-right:15px;"><span id="lb-my-name">Sen</span></div><b id="lb-my-score">0 XP</b></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item" onclick="nav('s-home')"><i class="fa-solid fa-house"></i>Ev</div>
            <div class="nav-item" onclick="nav('s-lessons')"><i class="fa-solid fa-book"></i>Ders</div>
            <div class="nav-item" onclick="nav('s-challenges')"><i class="fa-solid fa-hammer"></i>Yap</div>
            <div class="nav-item active" onclick="nav('s-rewards')"><i class="fa-solid fa-user"></i>Ben</div>
        </div>
    </div>

    <!-- REHBERLER VE ADIMLAR (AYNI) -->
    <div id="s-challenges" class="screen">
        <div class="header"><h3>Rehberler</h3></div>
        <div class="scroll-content">
            <div class="card" onclick="startGuide('flower')" style="padding:0; min-height:auto;">
                <div style="height:150px; width:100%; background:#ffeaa7; display:flex; align-items:center; justify-content:center; font-size:6rem;">üå∏</div>
                <div style="padding:25px; width:100%; display:flex; align-items:center; justify-content:space-between;"><div><h3 style="margin:0;">√ái√ßek Yap</h3><p style="margin:5px 0 0 0; font-weight:600;">5 Adƒ±m ‚Ä¢ Kolay</p></div><button class="btn-primary" style="width:auto; padding:10px 25px;">Ba≈üla</button></div>
            </div>
             <div class="card" onclick="startGuide('castle')" style="padding:0; min-height:auto;">
                <div style="height:150px; width:100%; background:#74b9ff; display:flex; align-items:center; justify-content:center; font-size:6rem;">üè∞</div>
                <div style="padding:25px; width:100%; display:flex; align-items:center; justify-content:space-between;"><div><h3 style="margin:0;">Kale Yap</h3><p style="margin:5px 0 0 0; font-weight:600;">2 Adƒ±m ‚Ä¢ Orta</p></div><button class="btn-primary" style="width:auto; padding:10px 25px;">Ba≈üla</button></div>
            </div>
        </div>
        <div class="bottom-nav">
            <div class="nav-item" onclick="nav('s-home')"><i class="fa-solid fa-house"></i>Ev</div>
            <div class="nav-item" onclick="nav('s-lessons')"><i class="fa-solid fa-book"></i>Ders</div>
            <div class="nav-item active" onclick="nav('s-challenges')"><i class="fa-solid fa-hammer"></i>Yap</div>
            <div class="nav-item" onclick="nav('s-rewards')"><i class="fa-solid fa-user"></i>Ben</div>
        </div>
    </div>
    
    <div id="s-guide-steps" class="screen">
        <div class="header"><div class="back-btn" onclick="nav('s-challenges')"><i class="fa-solid fa-xmark"></i></div><h3 id="guide-step-header">Adƒ±m 1/5</h3><div style="width:40px;"></div></div>
        <div class="scroll-content" style="text-align:center;">
            <div class="step-image-box"><div class="guide-label">√ñrnek</div><img id="guide-example-img" src="" alt="√ñrnek"></div>
            <div class="step-image-box" id="guide-user-box" style="display:none; border-color:var(--primary); height:220px;"><div class="guide-label user"><i class="fa-solid fa-user"></i> Senin Eserin</div><img id="guide-user-img" src=""></div>
            <div style="text-align:center; margin:25px 0;"><h2 id="guide-step-title" style="margin-bottom:10px;">Ba≈ülƒ±k</h2><p id="guide-step-desc">A√ßƒ±klama</p></div>
            <div class="step-upload-btn" onclick="document.getElementById('guide-file-input').click()"><i class="fa-solid fa-camera" style="font-size:2rem; margin-bottom:10px; color:var(--text-muted);"></i><div style="font-weight:700;">Fotoƒüraf √áek / Y√ºkle</div></div>
            <input type="file" id="guide-file-input" style="display:none;" accept="image/*" onchange="handlePhotoUpload(this)">
            <div style="display:flex; gap:15px; margin-top:30px;"><button class="btn-secondary" style="flex:1;" onclick="prevStep()">Geri</button><button class="btn-primary" style="flex:2;" id="btn-guide-next" onclick="nextStep()">ƒ∞leri</button></div>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
    // --- STATE ---
    let appData = { name: "Misafir", avatar: "avatar1.png", xp: 0, level: 1, buddy: null, unlockedLevels: { math: 1, colors: 1, shapes: 1, music: 1, space: 1, animals: 1 } };

    // --- BOOT ---
    window.onload = function() {
        try {
            const saved = localStorage.getItem('squish_v25');
            if(saved) { appData = JSON.parse(saved); nav('s-home'); } 
            else { nav('s-splash'); setTimeout(() => nav('s-profile-create'), 2000); }
            updateUI();
        } catch(e) { console.error(e); nav('s-profile-create'); }
        setTimeout(()=>{if(document.getElementById('s-splash').style.display!='none')document.getElementById('force-start-btn').style.display='block'},3000);
    };

    function saveData() { localStorage.setItem('squish_v25', JSON.stringify(appData)); updateUI(); }

    function updateUI() {
        const els = { name: ['home-name','home-name-display','profile-name-main','lb-my-name'], av: ['home-header-avatar','profile-avatar-main','lb-my-avatar'] };
        els.name.forEach(id=> { if(document.getElementById(id)) document.getElementById(id).innerText = appData.name; });
        els.av.forEach(id=> { if(document.getElementById(id)) document.getElementById(id).src = appData.avatar; });
        
        // Buddy Update
        const bImg = document.getElementById('quiz-buddy');
        const pImg = document.getElementById('lesson-buddy-preview');
        if(appData.buddy) { 
            if(bImg) { bImg.src = appData.buddy; bImg.style.display='block'; }
            if(pImg) pImg.src = appData.buddy; 
        } else if(bImg) bImg.style.display='none';

        // Stats
        ['home-lvl','profile-lvl'].forEach(id=> {if(document.getElementById(id)) document.getElementById(id).innerText = appData.level});
        ['home-xp','profile-xp'].forEach(id=> {if(document.getElementById(id)) document.getElementById(id).innerText = appData.xp});
        if(document.getElementById('lb-my-score')) document.getElementById('lb-my-score').innerText = appData.xp + " XP";
        if(document.getElementById('home-xp-bar')) document.getElementById('home-xp-bar').style.width = (appData.xp%100)+'%';
    }

    // --- NAV ---
    function nav(id) {
        document.querySelectorAll('.screen').forEach(s => { s.classList.remove('active'); s.style.display='none'; });
        const t = document.getElementById(id); if(t) { t.style.display='flex'; setTimeout(()=>t.classList.add('active'),10); }
        document.querySelectorAll('.nav-item').forEach(i=>i.classList.remove('active'));
        if(id=='s-home')updateNav(0); else if(id=='s-lessons')updateNav(1); else if(id=='s-challenges')updateNav(2); else if(id=='s-rewards')updateNav(3);
    }
    function updateNav(i) { document.querySelectorAll('.nav-item')[i].classList.add('active'); }

    // --- ACTIONS ---
    function saveProfileAndStart() {
        const n = document.getElementById('inp-name').value;
        if(n.trim()) appData.name = n;
        saveData(); showToast(`Ho≈ü Geldin ${appData.name}!`, 'success'); nav('s-home');
    }
    function pickAvatar(el, src) {
        document.querySelectorAll('.avatar-opt').forEach(a=>a.classList.remove('selected'));
        el.classList.add('selected'); appData.avatar = src;
    }
    function handleBuddy(i) {
        if(i.files[0]) {
            const r = new FileReader();
            r.onload = e => { appData.buddy = e.target.result; saveData(); showToast("Arkada≈üƒ±n Eklendi!", "success"); }
            r.readAsDataURL(i.files[0]);
        }
    }
    function redeemReward(c) {
        if(appData.xp >= c) {
            if(confirm(c+" XP harcansƒ±n mƒ±?")) { appData.xp-=c; saveData(); showToast("Kod: SQUISH15", "success"); launchConfetti(); }
        } else showToast("Yetersiz Puan", "error");
    }

    // --- QUIZ MOTORU ---
    const qBank = {
        math: (l) => {
            let n1,n2,q,c;
            if(l<=3){n1=Math.floor(Math.random()*5)+1;n2=Math.floor(Math.random()*5)+1;q=`${n1}+${n2}=?`;c=n1+n2;}
            else{n1=Math.floor(Math.random()*10)+5;n2=Math.floor(Math.random()*5)+1;q=`${n1}-${n2}=?`;c=n1-n2;}
            return {q,c,a:[c,c+1,c-1,c+2].sort(()=>Math.random()-0.5)};
        },
        colors: (l) => {
            const d=[{n:'Kƒ±rmƒ±zƒ±',v:'üü•'},{n:'Mavi',v:'üü¶'},{n:'Sarƒ±',v:'üü®'},{n:'Ye≈üil',v:'üü©'},{n:'Mor',v:'üü™'}];
            let t=d[Math.floor(Math.random()*d.length)]; return {q:`Hangisi ${t.n}?`,c:t.v,a:[t.v,...d.filter(x=>x.v!=t.v).slice(0,3).map(x=>x.v)].sort(()=>Math.random()-0.5)};
        },
        shapes: (l) => {
            const d=[{n:'Kare',v:'‚¨õ'},{n:'Daire',v:'üîµ'},{n:'√ú√ßgen',v:'üî∫'},{n:'Yƒ±ldƒ±z',v:'‚≠ê'}];
            let t=d[Math.floor(Math.random()*d.length)]; return {q:`${t.n} hangisi?`,c:t.v,a:[t.v,...d.filter(x=>x.v!=t.v).slice(0,3).map(x=>x.v)].sort(()=>Math.random()-0.5)};
        },
        music: (l) => {
             const d=[{n:'Gitar',v:'üé∏'},{n:'Piyano',v:'üéπ'},{n:'Davul',v:'ü•Å'},{n:'Keman',v:'üéª'}];
             let t=d[Math.floor(Math.random()*d.length)]; return {q:`${t.n} hangisi?`,c:t.v,a:[t.v,...d.filter(x=>x.v!=t.v).slice(0,3).map(x=>x.v)].sort(()=>Math.random()-0.5)};
        },
        space: (l) => {
             const d=[{n:'Roket',v:'üöÄ'},{n:'D√ºnya',v:'üåç'},{n:'Ay',v:'üåô'},{n:'G√ºne≈ü',v:'‚òÄÔ∏è'}];
             let t=d[Math.floor(Math.random()*d.length)]; return {q:`${t.n} nerede?`,c:t.v,a:[t.v,...d.filter(x=>x.v!=t.v).slice(0,3).map(x=>x.v)].sort(()=>Math.random()-0.5)};
        },
        animals: (l) => {
             const d=[{n:'Kedi',v:'üê±'},{n:'K√∂pek',v:'üê∂'},{n:'Aslan',v:'ü¶Å'},{n:'Maymun',v:'üêµ'}];
             let t=d[Math.floor(Math.random()*d.length)]; return {q:`${t.n} bul!`,c:t.v,a:[t.v,...d.filter(x=>x.v!=t.v).slice(0,3).map(x=>x.v)].sort(()=>Math.random()-0.5)};
        }
    };

    let currLesson='';
    function openLevelMap(id) {
        currLesson=id; document.getElementById('map-title').innerText=id.toUpperCase();
        const c=document.getElementById('level-grid-container'); c.innerHTML="";
        const u=appData.unlockedLevels[id]||1;
        for(let i=1;i<=10;i++){
            const d=document.createElement('div'); d.className=`level-node ${i<=u?(i<u?'completed':'unlocked'):'locked'}`; d.innerText=i;
            d.onclick=()=>{if(i<=u)startQuiz(i); else showToast("Kilitli!","error");};
            c.appendChild(d);
        }
        nav('s-level-map');
    }
    function startQuiz(lvl) {
        const q=qBank[currLesson](lvl);
        document.getElementById('quiz-question').innerText=q.q;
        document.getElementById('quiz-level-ind').innerText=`Level ${lvl}`;
        const g=document.getElementById('quiz-options'); g.innerHTML="";
        q.a.forEach(o=>{
            const b=document.createElement('div'); b.className='option-btn'; b.innerText=o;
            b.onclick=()=>{
                if(o==q.c){
                    showToast("Doƒüru!","success");
                    setTimeout(()=>{
                        if(lvl===appData.unlockedLevels[currLesson]) appData.unlockedLevels[currLesson]++;
                        appData.xp+=15; saveData(); launchConfetti(); openLevelMap(currLesson);
                    },1000);
                }else showToast("Tekrar dene","error");
            };
            g.appendChild(b);
        });
        // Buddy Tezah√ºratƒ±
        const msgs=["Yapabilirsin!","S√ºpersin!","Hadi Bakalƒ±m!"];
        document.getElementById('quiz-buddy-msg').innerText = msgs[Math.floor(Math.random()*msgs.length)];
        nav('s-quiz');
    }

    // --- REHBER ---
    const guides={flower:{steps:[{t:"1",d:"Yap",i:"cicek_adim1.jpg"},{t:"2",d:"Yap",i:"cicek_adim2.jpg"},{t:"3",d:"Yap",i:"cicek_adim3.jpg"},{t:"4",d:"Yap",i:"cicek_adim4.jpg"},{t:"5",d:"Bitir",i:"cicek_adim5.jpg"}]},castle:{steps:[{t:"1",d:"Yap",i:"kale_adim1.jpg"},{t:"2",d:"Bitir",i:"kale_adim2.jpg"}]}};
    let ag=null, gIdx=0, gPhoto=null;
    function startGuide(k){ag=guides[k]; gIdx=0; renderStep(); nav('s-guide-steps');}
    function renderStep(){
        const s=ag.steps[gIdx];
        document.getElementById('guide-step-header').innerText=`Adƒ±m ${gIdx+1}`;
        document.getElementById('guide-step-title').innerText=s.t;
        document.getElementById('guide-step-desc').innerText=s.d;
        document.getElementById('guide-example-img').src=s.i;
        gPhoto=null; document.getElementById('guide-user-box').style.display='none';
        document.getElementById('btn-guide-next').innerText=(gIdx===ag.steps.length-1)?"Bitir":"ƒ∞leri";
    }
    function handlePhotoUpload(i){
        if(i.files[0]){const r=new FileReader(); r.onload=e=>{gPhoto=e.target.result;document.getElementById('guide-user-img').src=gPhoto;document.getElementById('guide-user-box').style.display='flex';}; r.readAsDataURL(i.files[0]);}
    }
    function nextStep(){
        if(!gPhoto)return showToast("Fotoƒüraf y√ºkle!","error");
        if(gIdx<ag.steps.length-1){gIdx++; renderStep();}
        else{appData.xp+=50; saveData(); launchConfetti(); nav('s-rewards'); showToast("Tebrikler!","success");}
    }
    function prevStep(){if(gIdx>0){gIdx--; renderStep();}else nav('s-challenges');}

    // --- UTILS ---
    function showToast(m,t){
        const b=document.getElementById('toast-container'); const d=document.createElement('div');
        d.className=`toast ${t}`; d.innerHTML=m; b.appendChild(d);
        setTimeout(()=>d.classList.add('show'),10); setTimeout(()=>{d.classList.remove('show');setTimeout(()=>d.remove(),300)},3000);
    }
    function launchConfetti(){confetti({particleCount:100,spread:70,origin:{y:0.6}});}
    function closeModal(id){document.getElementById(id).style.display='none';}
    function resetProgress(){localStorage.removeItem('squish_v25');location.reload();}
</script>

</body>
</html>
